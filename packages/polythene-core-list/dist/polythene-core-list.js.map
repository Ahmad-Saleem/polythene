{"version":3,"file":"polythene-core-list.js","sources":["../src/list.js","../src/vars.js"],"sourcesContent":["import { filterSupportedAttributes } from \"polythene-core\";\nimport classes from \"./classes\";\n\nexport const getElement = vnode =>\n  vnode.attrs.element || \"div\";\n\nconst onSelect = (event, vnode) => {\n  const state = vnode.state;\n  const attrs = vnode.attrs;\n  if (attrs.onSelect) {\n    const highlightIndex = state.highlightIndex();\n    const data = {\n      event,\n      index: highlightIndex,\n      dom: state.tiles[highlightIndex].dom,\n      attrs: state.tiles[highlightIndex].attrs\n    };\n    attrs.onSelect(data);\n  }\n};\n\nexport const getInitialState = (vnode, createStream) => {\n  const attrs = vnode.attrs;\n  const highlightIndex = createStream(attrs.defaultHighlightIndex !== undefined\n    ? attrs.defaultHighlightIndex\n    : -1);\n  const registerTile = state => (index, data) => state.tiles[index] = data;\n  return {\n    tiles: [],\n    highlightIndex,\n    registerTile,\n    redrawOnUpdate: createStream.merge([highlightIndex])\n  };\n};\n\nexport const onMount = vnode => {\n  const state = vnode.state;\n  const attrs = vnode.attrs;\n  if (attrs.keyboardControl) {\n    state.highlightIndex.map(index => {\n      if (state.tiles[index]) {\n        state.tiles[index].dom.focus();\n      }\n    });\n  }\n};\n\nexport const createProps = (vnode, { keys: k }) => {\n  const state = vnode.state;\n  const attrs = vnode.attrs;\n  return Object.assign(\n    {},\n    filterSupportedAttributes(attrs),\n    {\n      className: [\n        classes.component,\n        attrs.borders ? classes.borders : null,\n        attrs.indentedBorders ? classes.indentedBorders : null,\n        attrs.header ? classes.hasHeader : null,\n        attrs.compact ? classes.compact : null,\n        attrs.padding !== false ? classes.padding : null,\n        attrs.tone === \"dark\" ? \"pe-dark-tone\" : null,\n        attrs.tone === \"light\" ? \"pe-light-tone\" : null,\n        attrs.className || attrs[k.class],\n      ].join(\" \"),\n    },\n    attrs.keyboardControl && {\n      [k.onkeydown]: e => {\n        const highlightIndex = state.highlightIndex();\n        if (e.key === \"ArrowDown\" || e.key === \"ArrowRight\") {\n          e.preventDefault(); // prevent scrolling the page\n          const newIndex = Math.min(state.tiles.length - 1, highlightIndex + 1);\n          state.tiles[newIndex].dom.focus();\n        } else if (e.key === \"ArrowUp\" || e.key === \"ArrowLeft\") {\n          e.preventDefault(); // prevent scrolling the page\n          const newIndex = Math.max(0, highlightIndex - 1);\n          state.tiles[newIndex].dom.focus();\n        } else if (e.key === \"Enter\") {\n          onSelect(e, vnode);\n        } else if (e.key === \"Escape\") {\n          state.tiles[highlightIndex].dom.blur();\n          state.highlightIndex(-1);\n        }\n      },\n    }\n  );\n};\n\nexport const createContent = (vnode, { renderer: h, requiresKeys, keys: k, ListTile }) => {\n  const state = vnode.state;\n  const attrs = vnode.attrs;\n  let headerOpts;\n  if (attrs.header) {\n    headerOpts = Object.assign(\n      {},\n      attrs.header\n    );\n    headerOpts[k.class] = [\n      classes.header,\n      headerOpts[k.class] || null\n    ].join(\" \");\n  }\n  const highlightIndex = state.highlightIndex();\n  const tiles = attrs.tiles\n    ? attrs.tiles\n    : attrs.content\n      ? attrs.content\n      : attrs.children || vnode.children;\n  let index = -1;\n  return [\n    headerOpts ? h(ListTile, Object.assign(\n      {},\n      requiresKeys ? { key: \"header\" } : null,\n      attrs.all,\n      headerOpts,\n      {\n        header: true\n      }\n    )) : null,\n    attrs.keyboardControl\n      ? tiles.map(tileOpts => {\n        if (!tileOpts.header) {\n          index++;\n        }\n        return tileOpts.tag !== undefined\n          ? tileOpts\n          : h(ListTile, Object.assign(\n            {},\n            attrs.all,\n            tileOpts,\n            !tileOpts.header && {\n              keyboardControl: true,\n              register: state.registerTile(state),\n              setHighlightIndex: state.highlightIndex,\n              index,\n              defaultHighlight: highlightIndex === index,\n              events: Object.assign(\n                {},\n                tileOpts.events,\n                {\n                  [k.onclick]: e => onSelect(e, vnode)\n                }\n              )\n            }\n          ));\n      })\n      : attrs.all\n        ? tiles.map(tileOpts =>\n          h(ListTile, Object.assign(\n            {},\n            attrs.all,\n            tileOpts\n          ))\n        )\n        : tiles\n  ];\n};\n","import { vars } from \"polythene-theme\";\n\nconst rgba = (colorStr, opacity = 1) =>\n  `rgba(${colorStr}, ${opacity})`;\n\nexport default {\n  padding:                vars.grid_unit_component, // vertical padding\n  padding_compact:        vars.grid_unit_component * 3/4,\n  border_width_stacked:   1,\n  border_width_bordered:  1,\n\n  color_light_border:     rgba(vars.color_light_foreground, vars.blend_light_border_light),\n  color_dark_border:      rgba(vars.color_dark_foreground,  vars.blend_dark_border_light),\n\n  // background color may be set in theme; disabled by default\n  // color_light_background: \"inherit\",\n  // color_dark_background:  \"inherit\"\n};\n"],"names":["getElement","vnode","attrs","element","onSelect","event","state","highlightIndex","data","tiles","dom","getInitialState","createStream","undefined","defaultHighlightIndex","index","merge","onMount","keyboardControl","map","focus","createProps","k","keys","_extends","filterSupportedAttributes","classes","component","borders","indentedBorders","header","hasHeader","compact","padding","tone","className","class","join","onkeydown","e","key","preventDefault","newIndex","Math","min","length","max","blur","createContent","h","renderer","requiresKeys","ListTile","headerOpts","content","children","all","tileOpts","tag","registerTile","events","onclick","rgba","colorStr","vars","grid_unit_component","color_light_foreground","blend_light_border_light","color_dark_foreground","blend_dark_border_light"],"mappings":"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"}