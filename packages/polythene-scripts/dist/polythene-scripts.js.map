{"version":3,"file":"polythene-scripts.js","sources":["../src/write-css.js"],"sourcesContent":["const autoprefixer = require(\"autoprefixer\");\nconst cssbeautify  = require(\"cssbeautify\");\nconst fs           = require(\"fs\");\nconst J2c          = require(\"j2c\");\nconst postcss      = require(\"postcss\");\nconst cssnano      = require(\"cssnano\");\n\nconst j2c = new J2c();\nconst COLOR_RED = \"\\x1b[31m\";\nconst COLOR_WHITE = \"\\x1b[37m\";\n\nconst makeStyleSheet = (...styles) =>\n  styles.reduce((acc, styleList) =>\n    // each style returns a list\n    Object.keys(styleList).length\n      ? (\n        styleList.forEach(style => {\n          const scoped = {\n            \"@global\": style\n          };\n          const sheet = j2c.sheet(scoped);\n          acc += sheet;      \n        }),\n        acc\n      )\n      : acc, \"\");\n\nconst beautifyCSS = cssString =>\n  cssbeautify(cssString, {\n    indent: \"  \"\n  });\n\nconst saveToFile = (path, cssString) => \n  fs.writeFile(path, cssString, \"ascii\", err => {  \n    // throws an error, you could also catch it here\n    if (err) throw err;\n  });\n\nexport const processCSS = ({ styles, path, autoPrefix }) => {\n  const cssString = styles.reduce((acc, current) => (\n    acc + makeStyleSheet(current)\n  ), \"\");\n  return { cssString, path, autoPrefix };\n};\n\nexport const writeCSS = ({ css, styles, path, autoPrefix, beautify }) => {\n  const cssString = css\n    ? css\n    : styles\n      ? styles.reduce((acc, current) => acc + makeStyleSheet(current), \"\")\n      : \"\";\n\n  const mapPath = `${path}.map`;\n  const plugins = [];\n  if (autoPrefix) {\n    plugins.push(autoprefixer());\n  }\n  plugins.push(cssnano({ preset: \"default\" }));\n  postcss(plugins)\n    .process(cssString, {\n      to:  path,\n      map: { inline: false }\n    })\n    .then(result => {\n      result.warnings().forEach(warn => {\n        console.warn(COLOR_RED, \"Warning\", COLOR_WHITE, warn.toString()); // eslint-disable-line no-console\n      });\n      saveToFile(path, beautify ? beautifyCSS(result.css) : result.css);\n      saveToFile(mapPath, result.map);\n    });\n};\n\n"],"names":["autoprefixer","require","cssbeautify","fs","J2c","postcss","cssnano","j2c","makeStyleSheet","styles","reduce","acc","styleList","keys","length","forEach","scoped","style","sheet","beautifyCSS","cssString","saveToFile","path","writeFile","err","writeCSS","css","autoPrefix","beautify","current","mapPath","plugins","push","preset","process","inline","then","warnings","warn","toString","result","map"],"mappings":"2LAAA,IAAMA,GAAeC,QAAQ,gBACvBC,EAAeD,QAAQ,eACvBE,EAAeF,QAAQ,MACvBG,EAAeH,QAAQ,OACvBI,EAAeJ,QAAQ,WACvBK,EAAeL,QAAQ,WAEvBM,EAAM,GAAIH,GAIVI,EAAiB,sCAAIC,+CACzBA,GAAOC,OAAO,SAACC,EAAKC,iBAEXC,KAAKD,GAAWE,QAEnBF,EAAUG,QAAQ,eACVC,cACOC,GAEPC,EAAQX,EAAIW,MAAMF,MACjBE,IAETP,GAEAA,GAAK,KAEPQ,EAAc,kBAClBjB,GAAYkB,UACF,QAGNC,EAAa,SAACC,EAAMF,SACxBjB,GAAGoB,UAAUD,EAAMF,EAAW,QAAS,eAEjCI,EAAK,KAAMA,MAUNC,EAAW,eAAGC,KAAAA,IAAKjB,IAAAA,OAAQa,IAAAA,KAAMK,IAAAA,WAAYC,IAAAA,SAClDR,EAAYM,IAEdjB,EACEA,EAAOC,OAAO,SAACC,EAAKkB,SAAYlB,GAAMH,EAAeqB,IAAU,IAC/D,IAEAC,EAAaR,SACbS,IACFJ,MACMK,KAAKhC,OAEPgC,KAAK1B,GAAU2B,OAAQ,eACvBF,GACLG,QAAQd,MACFE,OACEa,QAAQ,KAEhBC,KAAK,cACGC,WAAWtB,QAAQ,oBAChBuB,KAzDE,QAyDc,UAxDZ,QAwDoCA,EAAKC,gBAE5CjB,EAAMM,EAAWT,EAAYqB,EAAOd,KAAOc,EAAOd,OAClDI,EAASU,EAAOC"}