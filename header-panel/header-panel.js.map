{"version":3,"sources":["header-panel.es6"],"names":["CSS_CLASSES","panel","header","dropShadow","outerContainer","headerContainer","backgroundContainer","condensedBackground","headerBackground","mediaDimmer","mainContainer","headerAnimated","fixed","cascaded","modeCover","modeScroll","modeSeamed","modeStandard","modeTall","modeWaterfallTall","modeWaterfall","toolbar","toolbarTopbar","headerTall","DEFAULT_SHADOW_HEIGTH","DEFAULT_HEADER_HEIGHT","DEFAULT_CONDENSED_HEADER_HEIGHT","SCROLL_WATCH_TIMER","scroller","scrollPositions","modeConfigs","shadowAfterScroll","alwaysShadow","noShadow","tallMode","outerScroll","modeClasses","classForMode","mode","setTransform","document","documentElement","style","transform","webkitTransform","string","translateY","y","t","createHeaderComponent","opts","tall","tallClass","toolbarOpts","class","join","topBar","component","content","animated","createViewHeader","Object","assign","ctrl","headerConfig","initHeaderContainer","inited","headerContainerElem","shadow","createViewContent","initMainContainer","scrollConfig","main","scrollerElem","e","emit","storeScrollPosition","target","scrollTop","createView","configs","init","updateContentOnScroll","isScrolling","handleScroll","bind","tag","scrollerType","id","config","headerPanelElem","el","initOuterContainer","querySelector","headerElem","outerContainerElem","headerTopBarElem","topBarElem","headerBg","condensedHeaderBg","setHeight","clientHeight","outer","restoreScrollPosition","ignoreContent","subtree","props","before","after","controller","condenses","scrollAwayTopbar","noReveal","keepCondensedHeader","noDissolve","backgroundScrollSpeed","headerHeight","shadowHeight","condensedHeaderHeight","standard","showShadow","isScrolled","scrolled","classList","dynamicHeader","scrollInited","initialScrollPosition","initialPositionFixed","sTop","headerMargin","Math","min","max","prevScrollTop","sy","transformHeader","isTouch","enlargeImage","handleScrollFns","scrollWatchId","h","paddingTop","clearTimeout","setTimeout","handleScrollFn","scroll","condenseHeader","hy","hbg","opacity","reset","chbg","height","condensedHeight","abs","restoreScrollPositionId","restore","view"],"mappings":"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","file":"header-panel.js","sourcesContent":["import 'polythene/common/object.assign';\nimport p from 'polythene/polythene/polythene';\nimport events from 'polythene/common/events';\nimport m from 'mithril';\nimport toolbar from 'polythene/toolbar/toolbar';\nimport 'polythene/header-panel/theme/theme';\n\nconst CSS_CLASSES = {\n    panel: 'pe-header-panel',\n    header: 'pe-header',\n    dropShadow: 'pe-header-panel__drop-shadow',\n    outerContainer: 'pe-header-panel__outer-container',\n    headerContainer: 'pe-header-panel__header-container',\n    backgroundContainer: 'pe-header-panel__background-container',\n    condensedBackground: 'pe-header-panel__condensed-background',\n    headerBackground: 'pe-header-panel__header-background',\n    mediaDimmer: 'pe-header-panel__media-dimmer',\n    mainContainer: 'pe-header-panel__main-container',\n\n    headerAnimated: 'pe-header--animated',\n    fixed: 'pe-header-panel--fixed',\n    cascaded: 'pe-header-panel--cascaded',\n    modeCover: 'pe-header-panel--cover',\n    modeScroll: 'pe-header-panel--scroll',\n    modeSeamed: 'pe-header-panel--seamed',\n    modeStandard: 'pe-header-panel--standard',\n    modeTall: 'pe-header-panel--tall',\n    modeWaterfallTall: 'pe-header-panel--waterfall-tall',\n    modeWaterfall: 'pe-header-panel--waterfall',\n\n    // lookups:\n    toolbar: 'pe-toolbar',\n    toolbarTopbar: 'pe-toolbar__bar--top',\n    headerTall: 'pe-header--tall'\n};\n\nconst DEFAULT_SHADOW_HEIGTH = 6;\nconst DEFAULT_HEADER_HEIGHT = 192;\nconst DEFAULT_CONDENSED_HEADER_HEIGHT = DEFAULT_HEADER_HEIGHT / 3;\nconst SCROLL_WATCH_TIMER = 150;\n\nlet scroller; // keep track of scrolling elements on the page\nconst scrollPositions = {};\n\nconst modeConfigs = {\n    shadowAfterScroll: {\n        'waterfall': 1,\n        'waterfall-tall': 1\n    },\n    alwaysShadow: {\n        'standard': 1,\n        'tall': 1\n    },\n    noShadow: {\n        'seamed': 1,\n        'cover': 1,\n        'scroll': 1\n    },\n    tallMode: {\n        'tall': true,\n        'waterfall-tall': true\n    },\n    outerScroll: {\n        'scroll': 1\n    }\n};\n\nconst modeClasses = {\n    'cover': CSS_CLASSES.modeCover,\n    'scroll': CSS_CLASSES.modeScroll,\n    'seamed': CSS_CLASSES.modeSeamed,\n    'standard': CSS_CLASSES.modeStandard,\n    'tall': CSS_CLASSES.modeTall,\n    'waterfall-tall': CSS_CLASSES.modeWaterfallTall,\n    'waterfall': CSS_CLASSES.modeWaterfall\n};\n\nconst classForMode = (mode = 'standard') => {\n    return modeClasses[mode];\n};\n\nconst setTransform = (document.documentElement.style.transform !== undefined) ? ((style, string) => {\n    style.transform = string;\n}) : ((style, string) => {\n    style.webkitTransform = string;\n});\n\nconst translateY = (style, y) => {\n    const t = (y === null) ? '' : 'translate3d(0, ' + y + 'px, 0)';\n    setTransform(style, t);\n};\n\nconst createHeaderComponent = (opts = {}) => {\n    const tall = opts.tall || false;\n    const tallClass = opts.tallClass || '';\n    const toolbarOpts = opts.toolbar;\n    if (toolbarOpts) {\n        toolbarOpts.class = [\n            (toolbarOpts.class || null),\n            tall ? tallClass : null\n        ].join(' ');\n        if (!toolbarOpts.topBar) {\n            toolbarOpts.topBar = m('div');\n        }\n        return m.component(toolbar, toolbarOpts);\n    } else if (opts.content) {\n        return m('div', {\n            class: [\n                CSS_CLASSES.header,\n                (opts.class || null),\n                (tall ? tallClass : null),\n                (opts.animated ? CSS_CLASSES.headerAnimated : '')\n            ].join(' ')\n        }, opts.content);\n    } else {\n        return m('div', opts);\n    }\n};\n\nconst createViewHeader = (ctrl, opts = {}) => {\n    const initHeaderContainer = (headerContainer, inited) => {\n        if (inited) {\n            return;\n        }\n        ctrl.headerContainerElem = headerContainer;\n    };\n    const header = opts.header ? createHeaderComponent(Object.assign({}, opts.header, ctrl.headerConfig)) : null;\n    return m('div', {\n        class: CSS_CLASSES.headerContainer,\n        config: initHeaderContainer\n    }, [\n        m('div', {\n            class: CSS_CLASSES.backgroundContainer\n        }, [\n            m('div', {class: CSS_CLASSES.condensedBackground}),\n            m('div', {class: CSS_CLASSES.headerBackground}),\n            m('div', {class: CSS_CLASSES.mediaDimmer})\n        ]),\n        header,\n        (ctrl.mode === 'seamed' || ctrl.shadow === false) ? null : m('div', {class: CSS_CLASSES.dropShadow})\n    ]);\n};\n\nconst createViewContent = (ctrl, scrollConfig, opts = {}) => {\n    const initMainContainer = (mainContainer, inited) => {\n        if (inited) {\n            return;\n        }\n        if (scrollConfig.main) {\n            ctrl.scrollerElem = mainContainer;\n        }\n    };\n    return [\n        m('div', {\n            class: CSS_CLASSES.mainContainer,\n            config: initMainContainer,\n            onscroll: (e) => {\n                scrollConfig.main(e);\n                events.emit('scroll', e);\n                ctrl.storeScrollPosition(e.target.scrollTop);\n            }\n        },\n        opts.content ? opts.content : null)\n    ];\n};\n\nconst createView = (ctrl, opts = {}) => {\n    opts.header = opts.header || {};\n    opts.configs = opts.configs || [];\n    ctrl.init(ctrl);\n\n    const updateContentOnScroll = opts.updateContentOnScroll || false;\n    const ignoreContent = !updateContentOnScroll && ctrl.isScrolling;\n    const scrollerType = modeConfigs.outerScroll[ctrl.mode] ? 'outer' : 'main';\n    const handleScroll = ctrl.handleScroll.bind(ctrl);\n    const header = createViewHeader(ctrl, opts);\n    const tag = opts.tag || 'div';\n\n    const scrollConfig = {};\n    scrollConfig[scrollerType] = handleScroll;\n\n    const initOuterContainer = (outerContainer, inited) => {\n        const headerElem = outerContainer.querySelector('.' + CSS_CLASSES.header) || outerContainer.querySelector('.' + CSS_CLASSES.toolbar);\n        if (!headerElem) {\n            return;\n        }\n        if (inited && ctrl.headerElem) {\n            return;\n        }\n        const headerContainer = outerContainer.querySelector('.' + CSS_CLASSES.headerContainer);\n        const topBarElem = headerContainer.querySelector('.' + CSS_CLASSES.toolbarTopbar);\n        const headerBg = headerContainer.querySelector('.' + CSS_CLASSES.headerBackground);\n        const condensedHeaderBg = headerContainer.querySelector('.' + CSS_CLASSES.condensedBackground);\n\n        ctrl.outerContainerElem = outerContainer;\n        ctrl.headerElem = headerElem;\n        ctrl.headerTopBarElem = topBarElem;\n        ctrl.headerBg = headerBg;\n        ctrl.condensedHeaderBg = condensedHeaderBg;\n\n        if (!opts.animated) {\n            ctrl.setHeight(headerContainer.clientHeight);\n        }\n        if (scrollConfig.outer) {\n            ctrl.scrollerElem = outerContainer;\n        }\n\n        ctrl.restoreScrollPosition();\n    };\n\n    const props = Object.assign({}, {\n        class: [\n            CSS_CLASSES.panel,\n            ctrl.fixed ? CSS_CLASSES.fixed : null,\n            classForMode(ctrl.mode),\n            opts.class\n        ].join(' '),\n        id: opts.id || '',\n        config: (el, inited) => {\n            if (inited) {\n                return;\n            }\n            ctrl.headerPanelElem = el;\n        }\n    });\n\n    const content = m('div', {\n        class: CSS_CLASSES.outerContainer,\n        config: initOuterContainer,\n        onscroll: (e) => {\n            scrollConfig.outer(e);\n            events.emit('scroll', e);\n        }\n    }, [\n        header,\n        ignoreContent ? {\n            subtree: 'retain'\n        } : createViewContent(ctrl, scrollConfig, opts)\n    ]);\n    return m(tag, props, [opts.before, content, opts.after]);\n};\n\nconst component = {\n    controller: (opts = {}) => {\n        let ctrl,\n            mode,\n            y,\n            scrolled,\n            prevScrollTop,\n            headerMargin,\n            headerHeight;\n\n        if (opts.mode) {\n            mode = opts.mode;\n        } else if (opts.header && opts.header.toolbar) {\n            mode = opts.header.toolbar.mode;\n        } else if (opts.header && opts.header.content) {\n            mode = opts.header.mode;\n        }\n        mode = mode || 'standard';\n        const tall = modeConfigs.tallMode[mode] || false;\n        const tallClass = opts.tallClass || CSS_CLASSES.headerTall;\n        const animated = opts.animated || false;\n        const fixed = opts.fixed || false;\n        const condenses = opts.condenses || false;\n        const scrollAwayTopbar = opts.scrollAwayTopbar || false;\n        const noReveal = opts.noReveal || false;\n        const keepCondensedHeader = opts.keepCondensedHeader || false;\n        const noDissolve = opts.noDissolve || false;\n        const backgroundScrollSpeed = (opts.backgroundScrollSpeed !== undefined) ? opts.backgroundScrollSpeed : 0.5;\n        y = 0;\n        scrolled = false;\n        prevScrollTop = 0;\n        // defaults, finally set with setHeight\n        const shadowHeight = DEFAULT_SHADOW_HEIGTH;\n        headerHeight = (opts.headerHeight || DEFAULT_HEADER_HEIGHT) + shadowHeight;\n        const condensedHeaderHeight = (opts.condensedHeaderHeight || DEFAULT_CONDENSED_HEADER_HEIGHT) + shadowHeight;\n        headerMargin = headerHeight - condensedHeaderHeight;\n\n        const handleScrollFns = {\n            standard: () => {\n                //\n            },\n            fixed: () => {\n                const isScrolled = (ctrl.scrollerElem.scrollTop > 0);\n                ctrl.showShadow(isScrolled);\n                scrolled = isScrolled;\n            },\n            animated: () => {\n                const isScrolled = (ctrl.scrollerElem.scrollTop > 0);\n                if (isScrolled !== scrolled) {\n                    const headerElem = ctrl.headerElem;\n                    if (headerElem && tall) {\n                        headerElem.classList[isScrolled ? 'remove' : 'add'](tallClass);\n                    }\n                    ctrl.showShadow(isScrolled);\n                    scrolled = isScrolled;\n                }\n            },\n            dynamicHeader: () => {\n                let sy,\n                    cascaded = false,\n                    sTop;\n\n                if (!ctrl.scrollInited && opts.initialScrollPosition) {\n                    sTop = opts.initialScrollPosition;\n                } else {\n                    sTop = ctrl.scrollerElem.scrollTop;\n                }\n \n                if (!ctrl.scrollInited && opts.initialPositionFixed) {\n                    prevScrollTop = sTop;\n                    y = 0;\n                    return;\n                }\n\n                if (sTop < headerMargin) {\n                    sy = sTop;\n                } else {\n                    sy = Math.min(keepCondensedHeader\n                            ? headerMargin\n                            : headerHeight,\n                        Math.max(0, ((noReveal || keepCondensedHeader)\n                            ? sTop\n                            : y + sTop - prevScrollTop))\n                    );\n                    if (condenses && prevScrollTop >= sTop && sTop > headerMargin) {\n                        sy = Math.max(sy, headerMargin);\n                    }\n                }\n                if (sTop > 0) {\n                    ctrl.transformHeader(sy);\n                } else if (p.isTouch) {\n                    ctrl.enlargeImage(sy);\n                }\n                if (!modeConfigs.noShadow[opts.mode]) {\n                    if (sTop > sy) {\n                        cascaded = true;\n                    }\n                    ctrl.showShadow(cascaded);\n                }\n                y = sy;\n                prevScrollTop = Math.max(sTop, 0);\n            }\n        };\n\n        let handleScrollFn;\n        if (animated) {\n            handleScrollFn = handleScrollFns.animated;\n        } else if (mode === 'standard') {\n            handleScrollFn = handleScrollFns.standard;\n        } else if (fixed) {\n            handleScrollFn = handleScrollFns.fixed;\n        } else {\n            handleScrollFn = handleScrollFns.dynamicHeader;\n        }\n\n        return {\n            headerPanelElem: undefined,\n            scrollerElem: undefined,\n            outerContainerElem: undefined,\n            headerContainerElem: undefined,\n            headerTopBarElem: undefined,\n            headerElem: undefined,\n            headerBg: undefined,\n            condensedHeaderBg: undefined,\n            mode: mode,\n            fixed: fixed,\n            shadow: (opts.shadow !== undefined && !opts.shadow) ? false : true,\n            scrollWatchId: 0,\n            isScrolling: false,\n            scrollInited: false,\n            headerConfig: {\n                tall: tall,\n                tallClass: tallClass,\n                animated: animated,\n                fixed: fixed\n            },\n\n            init: (controller) => {\n                ctrl = controller;\n            },\n\n            setHeight: (h) => {\n                if (opts.headerHeight === undefined) {\n                    headerHeight = h + shadowHeight;\n                    headerMargin = headerHeight - condensedHeaderHeight;\n                }\n                if (!fixed) {\n                    const mainContainer = ctrl.outerContainerElem.querySelector('.' + CSS_CLASSES.mainContainer);\n                    mainContainer.style.paddingTop = h + 'px';\n                }\n                if (noReveal) {\n                    ctrl.showShadow(false);\n                }\n            },\n\n            handleScroll: (e) => {\n                if (e) {\n                    // this is a real scroll event\n                    // instead of a programmatic call\n                    ctrl.isScrolling = true;\n                    scroller = ctrl;\n                    clearTimeout(ctrl.scrollWatchId);\n                    ctrl.scrollWatchId = setTimeout(() => {\n                        ctrl.isScrolling = false;\n                        scroller = undefined;\n                    }, SCROLL_WATCH_TIMER);\n                }\n\n                if (mode === 'scroll') {\n                    return;\n                }\n                if (modeConfigs.alwaysShadow[mode]) {\n                    ctrl.showShadow(true);\n                }\n\n                handleScrollFn();\n                ctrl.scrollInited = true;\n\n                if (e && opts.scroll) {\n                    opts.scroll(e);\n                }\n            },\n\n            condenseHeader: (hy) => {\n                const reset = (hy === null);\n\n                // adjust top bar in core-header so the top bar stays at the top\n                if (!scrollAwayTopbar) {\n                    if (ctrl.headerTopBarElem) {\n                        translateY(ctrl.headerTopBarElem.style, Math.min(hy, headerMargin));\n                    }\n                }\n\n                // transition header bg\n                const hbg = ctrl.headerBg.style;\n                if (hbg) {\n                    if (!noDissolve) {\n                        hbg.opacity = reset ? '' : (headerMargin - hy) / headerMargin;\n                    }\n\n                    // adjust header bg so it stays at the center\n                    translateY(hbg, reset ? null : hy * backgroundScrollSpeed);\n\n                    // transition condensed header bg\n                    if (!noDissolve) {\n                        const chbg = ctrl.condensedHeaderBg.style;\n                        chbg.opacity = reset ? '' : hy / headerMargin;\n                        // adjust condensed header bg so it stays at the center\n                        translateY(chbg, reset ? null : hy * backgroundScrollSpeed);\n                    }\n                }\n            },\n\n            transformHeader: (hy) => {\n                if (hy < 0) {\n                    return;\n                }\n                translateY(ctrl.headerContainerElem.style, -hy);\n                if (condenses) {\n                    ctrl.condenseHeader(hy);\n                }\n                if (opts.transform) {\n                    opts.transform({\n                        y: hy,\n                        height: headerHeight,\n                        condensedHeight: condensedHeaderHeight\n                    });\n                }\n            },\n\n            enlargeImage: (hy) => {\n                ctrl.headerBg.style.height = 100 / headerHeight * (headerHeight + Math.abs(hy / 2)) + '%';\n            },\n\n            showShadow: (cascaded) => {\n                if (modeConfigs.alwaysShadow[mode]) {\n                    cascaded = true;\n                }\n                ctrl.outerContainerElem.classList[cascaded ? 'add' : 'remove'](CSS_CLASSES.cascaded);\n            },\n\n            storeScrollPosition: (scrollTop) => {\n                if (opts.restoreScrollPositionId) {\n                    scrollPositions[opts.restoreScrollPositionId] = scrollTop;\n                }\n            },\n\n            restoreScrollPosition: () => {\n                if (opts.restoreScrollPositionId) {\n                    const scrollTop = scrollPositions[opts.restoreScrollPositionId];\n                    if (scrollTop !== undefined) {\n                        const restore = () => (ctrl.scrollerElem.scrollTop = scrollTop);\n                        restore();\n                        setTimeout(restore, 0);\n                    }\n                }\n            }\n        };\n    },\n\n    view: (ctrl, opts) => {\n        if (scroller && scroller !== ctrl) {\n            // if we are scrolling,\n            // don't render other header-panels\n            return {\n                subtree: 'retain'\n            };\n        } else {\n            return createView(ctrl, opts);\n        }\n    }\n};\n\nexport default component;\n"]}