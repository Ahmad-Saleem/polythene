"use strict";Object.defineProperty(exports,"__esModule",{value:true});function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{"default":obj}}var _polythenePolythenePolythene=require("polythene/polythene/polythene");var _polythenePolythenePolythene2=_interopRequireDefault(_polythenePolythenePolythene);var _mithril=require("mithril");var _mithril2=_interopRequireDefault(_mithril);var _polytheneShadowShadow=require("polythene/shadow/shadow");var _polytheneShadowShadow2=_interopRequireDefault(_polytheneShadowShadow);require("polythene-theme/dialog/dialog");var FADE_IN_DURATION=150;var FADE_OUT_DURATION=150;var SCROLL_WATCH_TIMER=150;var hide=function hide(ctrl){var opts=arguments.length<=1||arguments[1]===undefined?{}:arguments[1];var el=ctrl.dialogEl;el.style.opacity=0;el.style.transitionDuration=FADE_OUT_DURATION+"ms";if(opts.didHide){setTimeout(function(){el.parentElement.classList.remove("dialog-open");opts.didHide.call()},FADE_OUT_DURATION)}};var updateScrollState=function updateScrollState(ctrl){var scroller=ctrl.scrollEl;if(!scroller){return}ctrl.topOverflow=scroller.scrollTop>0;ctrl.bottomOverflow=scroller.scrollHeight-(scroller.scrollTop+scroller.getBoundingClientRect().height)>0};var createViewContent=function createViewContent(ctrl,opts){return(0,_mithril2["default"])("div",{"class":"dialog-body",config:function config(el,inited){if(inited){return}ctrl.scrollEl=el},onscroll:function onscroll(){ctrl.isScrolling(true);updateScrollState(ctrl);clearTimeout(ctrl.scrollWatchId);ctrl.scrollWatchId=setTimeout(function(){ctrl.isScrolling(false)},SCROLL_WATCH_TIMER)}},opts.body)};var createView=function createView(ctrl){var opts=arguments.length<=1||arguments[1]===undefined?{}:arguments[1];var updateContentOnScroll=opts.updateContentOnScroll||false;var ignoreContent=!updateContentOnScroll&&ctrl.isScrolling();var tag=opts.tag||"form";var props=Object.assign({},{"class":["dialog layout center-center",opts.fullscreen?"fullscreen":null,opts.backdrop?"hasBackdrop":null,ctrl.topOverflow?"topOverflow":null,ctrl.bottomOverflow?"bottomOverflow":null,opts["class"]].join(" "),style:{opacity:0},config:function config(el,inited,context,vdom){if(opts.config){opts.config(el,inited,context,vdom)}if(inited){return}ctrl.dialogEl=el;var onResize=function onResize(){updateScrollState(ctrl);_mithril2["default"].redraw()};_polythenePolythenePolythene2["default"].addListener("resize",onResize);context.onunload=function(){_polythenePolythenePolythene2["default"].removeListener("resize",onResize)};var dialogEl=ctrl.dialogEl;updateScrollState(ctrl);dialogEl.style.transitionDuration=FADE_IN_DURATION+"ms";dialogEl.style.opacity=1;dialogEl.parentElement.classList.add("dialog-open")},onclick:function onclick(e){e.stopPropagation();if(e.target!==ctrl.dialogEl){return}if(opts.modal){return}hide(ctrl,opts)}},opts.formOptions?opts.formOptions:null);var body=opts.body?ignoreContent?{subtree:"retain"}:createViewContent(ctrl,opts):null;var content=(0,_mithril2["default"])(".dialog-content.layout.vertical",[opts.fullscreen?null:_mithril2["default"].component(_polytheneShadowShadow2["default"],{z:ctrl.z(),animated:true}),opts.title?(0,_mithril2["default"])(".dialog-header.layout.start",[(0,_mithril2["default"])(".title",opts.title)]):null,body,opts.footer?(0,_mithril2["default"])(".dialog-footer.layout.end",[(0,_mithril2["default"])(".flex"),(0,_mithril2["default"])(".actions.layout.horizontal.end",opts.footer)]):null]);return(0,_mithril2["default"])(tag,props,_polythenePolythenePolythene2["default"].insertContent(content,opts))};var component={controller:function controller(){var opts=arguments.length<=0||arguments[0]===undefined?{}:arguments[0];var z=opts.z!==undefined?opts.z:3;return{z:_mithril2["default"].prop(z),dialogEl:null,scrollEl:null,topOverflow:false,bottomOverflow:false,scrollWatchId:0,isScrolling:_mithril2["default"].prop(false)}},view:function view(ctrl){var opts=arguments.length<=1||arguments[1]===undefined?{}:arguments[1];if(opts.shouldHide&&opts.shouldHide.call()){hide(ctrl,opts);return{subtree:"retain"}}else{return createView(ctrl,opts)}}};exports["default"]=component;module.exports=exports["default"];