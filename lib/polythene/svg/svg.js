"use strict";Object.defineProperty(exports,"__esModule",{value:true});function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{"default":obj}}var _polythenePolythenePolythene=require("polythene/polythene/polythene");var _polythenePolythenePolythene2=_interopRequireDefault(_polythenePolythenePolythene);var _mithril=require("mithril");var _mithril2=_interopRequireDefault(_mithril);require("polythene-theme/svg/svg");var PLUGIN_EXTENSION="!text";var component=undefined,createView=undefined,getPath=undefined,loadSvg=undefined,preloadNext=undefined,globalCache=undefined;globalCache={};getPath=function(){var opts=arguments[0]===undefined?{}:arguments[0];var components=["polythene/deps/svg"];components.push(opts.iconSet||_polythenePolythenePolythene2["default"].iconSet());if(opts.group){components.push(opts.group)}if(opts.name){components.push(opts.name)}return components.join("/")+".svg"};createView=function(ctrl){var opts=arguments[1]===undefined?{}:arguments[1];var tag=undefined,props=undefined,content=undefined,path=undefined,svg=undefined;tag=opts.tag||"div";props={"class":["svg",opts["class"]].join(" "),config:opts.config};path=opts.src?opts.src:getPath(opts);if(ctrl.path()!==path){svg=globalCache[path];if(svg){content=_mithril2["default"].trust(svg);preloadNext(ctrl)}else{ctrl.path(path);loadSvg(path,ctrl)}}else{svg=ctrl.svg();svg=svg||"";content=_mithril2["default"].trust(svg);preloadNext(ctrl)}return(0,_mithril2["default"])(tag,props,_polythenePolythenePolythene2["default"].insertContent(content,opts))};loadSvg=function(path,ctrl){var preload=arguments[2]===undefined?false:arguments[2];var requireUrl=undefined,deferred=undefined;requireUrl=path+PLUGIN_EXTENSION;deferred=_mithril2["default"].deferred();System["import"](requireUrl).then(function(data){deferred.resolve(data);if(preload){globalCache[path]=data;ctrl.preloadingIndex++}else{ctrl.svg(data);_mithril2["default"].redraw()}})};preloadNext=function(ctrl){var next=undefined,path=undefined;if(!ctrl.preloadingItems){return}if(ctrl.preloadingIndex>=ctrl.preloadingItems.length){return}next=ctrl.preloadingItems[ctrl.preloadingIndex];path=next.src?next.src:getPath(next);if(globalCache[path]){return}loadSvg(path,ctrl,true)};component={controller:function controller(){var opts=arguments[0]===undefined?{}:arguments[0];return{path:_mithril2["default"].prop(""),svg:_mithril2["default"].prop(""),preloadingItems:opts.preload,preloadingIndex:0}},view:function view(ctrl){var opts=arguments[1]===undefined?{}:arguments[1];return createView(ctrl,opts)}};exports["default"]=component;module.exports=exports["default"];