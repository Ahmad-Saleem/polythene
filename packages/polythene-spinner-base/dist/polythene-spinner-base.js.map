{"version":3,"file":"polythene-spinner-base.js","sources":["../src/classes.js","../src/theme/vars.js","../src/theme/layout.js","../src/theme/color.js","../src/theme/index.js","../src/spinner.js"],"sourcesContent":["\nexport default {\n  component:   \"pe-spinner\",\n  placeholder: \"pe-spinner__placeholder\",\n  animation:   \"pe-spinner__animation\",\n  visible:     \"pe-spinner--visible\",\n  small:       \"pe-spinner--small\",\n  regular:     \"pe-spinner--regular\",\n  medium:      \"pe-spinner--medium\",\n  large:       \"pe-spinner--large\",\n  fab:         \"pe-spinner--fab\",\n  raised:      \"pe-spinner--raised\",\n  permanent:   \"pe-spinner--permanent\",\n  singleColor: \"pe-spinner--single-color\",\n  animated:    \"pe-spinner--animated\"\n};\n","import { vars } from \"polythene-theme\";\nconst rgba = vars.rgba;\n\nexport default {\n  size_small:   3 * vars.grid_unit_component,\n  size_regular: 4 * vars.grid_unit_component,\n  size_medium:  5 * vars.grid_unit_component,\n  size_large:   6 * vars.grid_unit_component,\n  size_fab:     7 * vars.grid_unit_component,\n\n  color_light_raised_background: rgba(vars.color_light_background),\n  // also use light background with dark theme\n  color_dark_raised_background: rgba(vars.color_light_background)\n};\n","\nconst sizes = size => ({\n  width: size + \"px\",\n  height: size + \"px\"\n});\n\nconst sizesRaised = size => {\n  const padding = size / 4;\n  const paddedSize = size + padding * 2;\n  return {\n    width:   paddedSize + \"px\",\n    height:  paddedSize + \"px\",\n    padding: padding    + \"px\"\n  };\n};\n\nexport default (selector, componentVars) => [{\n  [selector]: {\n    transitionTimingFunction: \"ease-out\",\n    transitionProperty: \"opacity\",\n    opacity: 0,\n\n    \".pe-spinner--visible, &.pe-spinner--permanent\": {\n      opacity: 1\n    },\n\n    \".pe-spinner--small\":   sizes(componentVars.size_small),\n    \".pe-spinner--regular\": sizes(componentVars.size_regular),\n    \".pe-spinner--medium\":  sizes(componentVars.size_medium),\n    \".pe-spinner--large\":   sizes(componentVars.size_large),\n    \".pe-spinner--fab\":     sizes(componentVars.size_fab),\n\n    \".pe-spinner--raised\": {\n      position: \"relative\",\n      borderRadius: \"50%\",\n\n      \".pe-spinner--small\":   sizesRaised(componentVars.size_small),\n      \".pe-spinner--regular\": sizesRaised(componentVars.size_regular),\n      \".pe-spinner--medium\":  sizesRaised(componentVars.size_medium),\n      \".pe-spinner--large\":   sizesRaised(componentVars.size_large),\n      \".pe-spinner--fab\":     sizesRaised(componentVars.size_fab)\n    }\n  }\n}];\n","\nconst style = (scopes, selector, componentVars, tint) => [{\n  [scopes.map(s => s + selector).join(\",\")]: {\n    \".pe-spinner--raised\": {\n      backgroundColor: componentVars[\"color_\" + tint + \"_raised_background\"],\n    }\n  }\n}];\n\nexport default (selector, componentVars) => [\n  style([\".pe-dark-tone\", \".pe-dark-tone \"], selector, componentVars, \"dark\"), // has/inside dark theme\n  style([\"\", \".pe-light-tone\", \".pe-light-tone \"], selector, componentVars, \"light\"), // normal, has/inside light theme\n];\n","import { styler } from \"polythene-css\";\nimport classes from \"../classes\";\nimport vars from \"./vars\";\nimport layout from \"./layout\";\nimport color from \"./color\";\n\nconst fns = [layout, color];\nconst selector = `.${classes.component}`;\n\nexport const customTheme = (customSelector, customVars) => \n  styler.generateStyles([customSelector, selector], {...vars, ...customVars}, fns);\n\nstyler.generateStyles([selector], vars, fns);\n","import m from \"mithril\";\nimport { filterSupportedAttributes } from \"polythene-core\";\nimport { show, hide } from \"polythene-core\";\nimport shadow from \"polythene-shadow\";\nimport { customTheme } from \"./theme\";\nimport classes from \"./classes\";\n\nconst typeClasses = {\n  small:   classes.small,\n  regular: classes.regular,\n  medium:  classes.medium,\n  large:   classes.large,\n  fab:     classes.fab\n};\n\nconst classForType = (mode = \"regular\") => typeClasses[mode];\n\nconst showSpinner = (state, attrs) => {\n  if (state.isTransitioning) {\n    return;\n  }\n  state.isTransitioning = true;\n  return show(Object.assign(\n    {},\n    attrs, {\n      el: state.el,\n      showClass: classes.visible\n    }\n  )).then(() => {\n    state.isTransitioning = false;\n    state.visible = true;\n  });\n};\n\nconst hideSpinner = (state, attrs) => {\n  if (state.isTransitioning) {\n    return;\n  }\n  state.isTransitioning = true;\n  return hide(Object.assign(\n    {},\n    attrs, {\n      el: state.el,\n      afterHide: () => (state.el.style.display = \"none\"),\n      showClass: classes.visible\n    }\n  )).then(() => {\n    state.isTransitioning = false;\n    state.visible = false;\n    state.hide = false;\n    m.redraw(); // removes remainder of drawn component\n  });\n};\n\nconst delay = (attrs, mode) => {\n  const value = attrs[mode];\n  return ((value !== true) && !isNaN(value))\n    ? parseFloat(value, 10) * 1000\n    : false;\n};\n\nconst notifyState = (state, attrs) => {\n  if (attrs.percentage && attrs.getPercentage) {\n    const percentage = (typeof attrs.percentage === \"function\")\n      ? attrs.percentage()\n      : attrs.percentage;\n    attrs.getPercentage(percentage, state, attrs);\n  }\n};\n\nconst createView = (state, attrs) => {\n  const element = attrs.element || \"div\";\n  const props = Object.assign({},\n    filterSupportedAttributes(attrs),\n    {\n      class: [\n        classes.component,\n        classForType(attrs.type),\n        attrs.singleColor ? classes.singleColor: null,\n        attrs.raised ? classes.raised : null,\n        attrs.animated ? classes.animated : null,\n        attrs.permanent ? classes.permanent : null,\n        attrs.class\n      ].join(\" \"),\n      oncreate: ({ dom }) => {\n        state.el = dom;\n        notifyState(state, attrs);\n        if (!attrs.permanent) {\n          setTimeout(() => showSpinner(state, attrs), 0);\n        }\n      }\n    },\n    attrs.events ? attrs.events : null\n  );\n\n  notifyState(state, attrs);\n\n  if (state.hide) {\n    setTimeout(() => { hideSpinner(state, attrs); }, 0);\n  }\n\n  const content = [\n    attrs.raised && attrs.content\n      ? m(shadow, { z: attrs.z })\n      : null,\n    attrs.content || m(\"div\", { class: classes.animation }, \"Specific spinner missing\")\n  ];\n\n  return m(element, props, [attrs.before, content, attrs.after]);\n};\n\nconst view = ({ state, attrs }) => {\n  if (!state.visible) {\n    if ((attrs.hide !== undefined && !attrs.hide) || attrs.show) {\n      const showDelay = delay(attrs, \"show\");\n      if (showDelay) {\n        setTimeout(() => {\n          state.visible = true;\n          m.redraw();\n        }, showDelay);\n      } else {\n        state.visible = true;\n      }\n    }\n  } else {\n    if ((attrs.show !== undefined && !attrs.show) || attrs.hide) {\n      const hideDelay = delay(attrs, \"hide\");\n      if (hideDelay) {\n        setTimeout(() => {\n          state.hide = true;\n          m.redraw();\n        }, hideDelay);\n      } else {\n        state.hide = true;\n      }\n    }\n  }\n  return state.visible\n    ? createView(state, attrs)\n    : m(\"span\", { class: classes.placeholder });\n};\n\nexport default {\n  theme: customTheme, // accepts (selector, vars)\n  oninit: vnode => {\n    vnode.state = Object.assign(\n      vnode.state, \n      {\n        el: null,\n        isTransitioning: false,\n        visible: vnode.attrs.permanent || false,\n        hide: false,\n        percentage: 0\n      }\n    );\n  },\n  view\n};\n"],"names":["rgba","vars","grid_unit_component","color_light_background","sizes","size","sizesRaised","padding","paddedSize","selector","componentVars","size_small","size_regular","size_medium","size_large","size_fab","style","scopes","tint","map","s","join","fns","layout","color","classes","component","customTheme","customSelector","customVars","styler","generateStyles","typeClasses","small","regular","medium","large","fab","classForType","showSpinner","state","attrs","isTransitioning","show","_extends","el","visible","then","hideSpinner","hide","display","redraw","delay","mode","value","isNaN","parseFloat","notifyState","percentage","getPercentage","createView","element","props","filterSupportedAttributes","type","singleColor","raised","animated","permanent","class","dom","events","content","m","shadow","z","animation","before","after","view","undefined","hideDelay","showDelay","placeholder","vnode"],"mappings":"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"}