{"version":3,"file":"polythene-core-menu.js","sources":["../../polythene-css-classes/list-tile.js","../../polythene-css-classes/menu.js","../src/transitions.js","../src/backdrop-transitions.js","../src/menu.js","../src/vars.js"],"sourcesContent":["\nexport default {\n  component:       \"pe-list-tile\",\n\n  // elements\n  content:         \"pe-list-tile__content\",\n  highSubtitle:    \"pe-list-tile__high-subtitle\",\n  primary:         \"pe-list-tile__primary\",\n  secondary:       \"pe-list-tile__secondary\",\n  subtitle:        \"pe-list-tile__subtitle\",\n  title:           \"pe-list-tile__title\",\n  contentFront:    \"pe-list-tile__content-front\",\n\n  // states\n  compact:         \"pe-list-tile--compact\",\n  compactFront:    \"pe-list-tile--compact-front\",\n  disabled:        \"pe-list-tile--disabled\",\n  hasFront:        \"pe-list-tile--front\",\n  hasHighSubtitle: \"pe-list-tile--high-subtitle\",\n  hasSubtitle:     \"pe-list-tile--subtitle\",\n  header:          \"pe-list-tile--header\",\n  hoverable:       \"pe-list-tile--hoverable\",\n  selectable:      \"pe-list-tile--selectable\",\n  selected:        \"pe-list-tile--selected\",\n  highlight:       \"pe-list-tile--highlight\",\n  sticky:          \"pe-list-tile--sticky\",\n};\n","import listTileClasses from \"./list-tile\";\n\nexport default {\n  component:   \"pe-menu\",\n\n  // elements\n  content:     \"pe-menu__content\",\n  placeholder: \"pe-menu__placeholder\",\n  target:      \"pe-menu__target\",\n  backdrop:    \"pe-menu__backdrop\",\n\n  // states\n  permanent:   \"pe-menu--permanent\",\n  width_auto:  \"pe-menu--width-auto\",\n  width_n:     \"pe-menu--width-\",\n  floating:    \"pe-menu--floating\",\n\n  // lookup\n  listTile:         listTileClasses.component,\n  selectedListTile: listTileClasses.selected,\n};\n","\nconst show = ({ el, showDuration, showDelay }) => ({\n  el,\n  showDuration,\n  showDelay:    showDelay || 0,\n  beforeShow:   () => el.style.opacity = 0,\n  show:         () => el.style.opacity = 1,\n});\n\nconst hide = ({ el, hideDuration, hideDelay }) => ({\n  el,\n  hideDuration,\n  hideDelay:    hideDelay || 0,\n  hide:         () => el.style.opacity = 0\n});\n\nexport default {\n  show,\n  hide\n};\n","\nconst show = ({ el, showDuration, showDelay }) => ({\n  el,\n  showDuration,\n  showDelay:    showDelay || 0,\n  beforeShow:   () => el.style.opacity = 0,\n  show:         () => el.style.opacity = 1,\n});\n\nconst hide = ({ el, hideDuration, hideDelay }) => ({\n  el,\n  hideDuration,\n  hideDelay:    hideDelay || 0,\n  hide:         () => el.style.opacity = 0\n});\n\nexport default {\n  show,\n  hide\n};\n","import { filterSupportedAttributes, subscribe, unsubscribe, show, hide, isServer, isTouch } from \"polythene-core\";\nimport classes from \"polythene-css-classes/menu\";\nimport defaultTransitions from \"./transitions\";\nimport backdropTransitions from \"./backdrop-transitions\";\n\nexport const getElement = vnode =>\n  vnode.attrs.element || \"div\";\n\nconst SHADOW_Z           = 1;\nconst OFFSET_V           = -8;\nconst DEFAULT_OFFSET_H   = 0;\nconst MIN_SIZE           = 1.5;\nconst ANIMATION_DURATION = .220;\n\nconst positionMenu = (state, attrs) => {\n  if (!attrs.target || isServer) {\n    return;\n  }\n  const targetEl = document.querySelector(attrs.target);\n  if (!targetEl) {\n    return;\n  }\n  const offsetH = (attrs.offset !== undefined) ? attrs.offset : DEFAULT_OFFSET_H;\n  const menuEl = state.dom();\n  if (!menuEl) {\n    return;\n  }\n  const contentEl = state.dom().querySelector(\".\" + classes.content);\n  const origin = attrs.origin || \"top-left\";\n  let positionOffset = 0;\n  if (attrs.reposition) {\n    const firstItem = contentEl.querySelectorAll(\".\" + classes.listTile)[0];\n    const selectedItem = contentEl.querySelector(\".\" + classes.selectedListTile);\n    if (firstItem && selectedItem) {\n      // calculate v position: menu should shift upward relative to the first item\n      const firstItemRect = firstItem.getBoundingClientRect();\n      const selectedItemRect = selectedItem.getBoundingClientRect();\n      positionOffset = selectedItemRect.top - firstItemRect.top;\n    }\n    // align to middle of target\n    const alignEl = selectedItem || firstItem;\n    const alignRect = alignEl.getBoundingClientRect();\n    const targetRect = targetEl.getBoundingClientRect();\n    const heightDiff = alignRect.height - targetRect.height;\n    positionOffset += heightDiff / 2;\n  }\n  const targetRect = targetEl.getBoundingClientRect();\n  if (menuEl.parentNode) {\n    const parentRect = menuEl.parentNode.getBoundingClientRect();\n    const alignLeft =   () => menuEl.style.left = targetRect.left - parentRect.left + offsetH + \"px\";\n    const alignRight =  () => menuEl.style.right = targetRect.right - parentRect.right + offsetH + \"px\";\n    const alignTop =    () => menuEl.style.top = targetRect.top - parentRect.top - positionOffset + OFFSET_V + \"px\";\n    const alignBottom = () => menuEl.style.bottom = targetRect.bottom - parentRect.bottom - positionOffset + \"px\";\n    const alignFn = {\n      \"top-left\":       () => alignTop() && alignLeft(),\n      \"top-right\":      () => alignTop() && alignRight(),\n      \"bottom-left\":    () => alignBottom() && alignLeft(),\n      \"bottom-right\":   () => alignBottom() && alignRight()\n    };\n    alignFn[origin].call();\n  }\n};\n\nconst showBackdrop = (state, attrs) => {\n  if (!attrs.backdrop || isServer) {\n    return;\n  }\n  const targetEl = document.querySelector(attrs.backdropTarget);\n  if (!targetEl) {\n    return;\n  }\n  const el = document.createElement(\"div\");\n  el.setAttribute(\"class\", classes.backdrop);\n  targetEl.appendChild(el);\n  state.backdropEl = el;\n  show(Object.assign({},\n    attrs,\n    backdropTransitions.show({ el, showDuration: attrs.showDuration || ANIMATION_DURATION, showDelay: attrs.showDelay })\n  ));\n};\n\nconst hideBackdrop = (state, attrs) => {\n  if (!state.backdropEl) {\n    return;\n  }\n  const el = state.backdropEl;\n  hide(Object.assign({},\n    attrs,\n    backdropTransitions.hide({ el, hideDuration: attrs.hideDuration || ANIMATION_DURATION, hideDelay: attrs.hideDelay })\n  )).then(() => {\n    if (el.parentNode) {\n      el.parentNode.removeChild(el);\n    }\n  });\n};\n\nconst showMenu = (state, attrs) => {\n  if (attrs.onChange) {\n    attrs.onChange({ visible: false, transitioning: true });\n  }\n  positionMenu(state, attrs);\n  showBackdrop(state, attrs);\n  const transitions = attrs.transitions || defaultTransitions;\n  console.log(\"attrs.transitions\", attrs.transitions);\n  const el = state.dom();\n  return show(Object.assign({},\n    attrs,\n    transitions.show({ el, showDuration: attrs.showDuration || ANIMATION_DURATION, showDelay: attrs.showDelay })\n  )).then(() => {\n    if (attrs.onChange) {\n      attrs.onChange({ visible: true, transitioning: false });\n    }\n    if (attrs.didShow) {\n      attrs.didShow(attrs.id);\n    }\n    state.visible(false);\n  });\n};\n\nconst hideMenu = (state, attrs) => {\n  if (attrs.onChange) {\n    attrs.onChange({ visible: true, transitioning: true });\n  }\n  hideBackdrop(state, attrs);\n  const transitions = attrs.transitions || defaultTransitions;\n  const el = state.dom();\n  return hide(Object.assign({},\n    attrs,\n    transitions.hide({ el, hideDuration: attrs.hideDuration || ANIMATION_DURATION, hideDelay: attrs.hideDelay })\n  )).then(() => {\n    if (attrs.onChange) {\n      attrs.onChange({ visible: false, transitioning: false });\n    }\n    if (attrs.didHide) {\n      attrs.didHide(attrs.id);\n    }\n    state.visible(false);\n  });\n};\n\nconst unifySize = size =>\n  size < MIN_SIZE ? MIN_SIZE : size;\n\nconst widthClass = size =>\n  classes.width_n + size.toString().replace(\".\", \"-\");\n\nconst handleSubscriptions = (vnode, which) => {\n  const state = vnode.state;\n  const attrs = vnode.attrs;\n\n  if (which === \"mount\") {\n    subscribe(\"resize\", state.update);\n    subscribe(\"keydown\", state.handleEscape);\n    setTimeout(() => {\n      state.activateDismissTap();\n      showMenu(state, attrs);\n    }, 0);\n  } else {\n    unsubscribe(\"resize\", state.update);\n    unsubscribe(\"keydown\", state.handleEscape);\n    state.deActivateDismissTap();\n  }\n};\n\nexport const onMount = vnode => {\n  if (!vnode.dom) {\n    return;\n  }\n  const state = vnode.state;\n  const attrs = vnode.attrs;\n  state.dom(vnode.dom);\n\n  if (!attrs.permanent) {\n    state.handleDismissTap = e => {\n      if (e.target === state.dom()) {\n        return;\n      }\n      if (e.defaultPrevented) {\n        // clicked on .pe-menu__content\n        hideMenu(state, attrs);\n      } else {\n        hideMenu(state, Object.assign({}, attrs, {\n          hideDelay: 0\n        }));\n      }\n    };\n\n    state.update = () => {\n      positionMenu(state, attrs);\n    };\n\n    state.activateDismissTap = () => {\n      if (isTouch) {\n        document.addEventListener(\"touchstart\", state.handleDismissTap);\n      } else {\n        document.addEventListener(\"click\", state.handleDismissTap);\n      }\n    };\n\n    state.deActivateDismissTap = () => {\n      if (isTouch) {\n        document.removeEventListener(\"touchstart\", state.handleDismissTap);\n      } else {\n        document.removeEventListener(\"click\", state.handleDismissTap);\n      }\n    };\n\n    state.handleEscape = e => {\n      if (e.key === \"Escape\" || e.key === \"Esc\") {\n        hideMenu(state, Object.assign(\n          {},\n          attrs,\n          { hideDelay: 0 }\n        ));\n      }\n    };\n\n    handleSubscriptions(vnode, \"mount\");\n  }\n};\n\nexport const onUnMount = vnode => {\n  const attrs = vnode.attrs;\n  if (!attrs.permanent) {\n    handleSubscriptions(vnode, \"unmount\");\n  }\n};\n\nexport const getInitialState = (vnode, createStream) => {\n  const dom = createStream(null);\n  const visible = createStream(false);\n  return {\n    dom,\n    visible,\n    backdropEl: undefined,\n    activateDismissTap: undefined, // set in onMount\n    deActivateDismissTap: undefined, // set in onMount\n    handleDismissTap: undefined, // set in onMount\n    handleEscape: undefined, // set in onMount\n    update: undefined, // set in onMount\n    redrawOnUpdate: createStream.merge([visible])\n  };\n};\n\nexport const createProps = (vnode, { keys: k }) => {\n  const attrs = vnode.attrs;\n  const type = attrs.type || \"floating\";\n  return Object.assign(\n    {}, \n    filterSupportedAttributes(attrs),\n    {\n      className: [\n        attrs.parentClassName || classes.component,\n        attrs.permanent ? classes.permanent : null,\n        type === \"floating\" ? classes.floating : null,\n        attrs.target ? classes.target : null,\n        attrs.size ? widthClass(unifySize(attrs.size)) : null,\n        attrs.tone === \"dark\" ? \"pe-dark-tone\" : null,\n        attrs.tone === \"light\" ? \"pe-light-tone\" : null,\n        attrs.className || attrs[k.class],\n      ].join(\" \")\n    }\n  );\n};\n\nexport const createContent = (vnode, { renderer: h, keys: k, Shadow }) => {\n  const attrs = vnode.attrs;\n  const z = attrs.z !== undefined ? attrs.z : SHADOW_Z;\n  return h(\"div\",\n    {\n      className: classes.content,\n      [k.onclick]: e => e.preventDefault(),\n      style: attrs.style\n    },\n    [\n      z > 0 && h(Shadow, {\n        z,\n        animated: true\n      }),\n      attrs.content\n        ? attrs.content\n        : vnode.children\n    ]\n  );\n};\n","import { vars } from \"polythene-theme\";\n\nconst rgba = (colorStr, opacity = 1) =>\n  `rgba(${colorStr}, ${opacity})`;\n\nexport default {\n  sizes:                  [1, 1.5, 2, 3, 4, 5, 6, 7],\n  min_size:               1.5,\n  max_size_small_screen:  5,\n  size_factor:            vars.grid_unit_menu,\n  border_radius:          vars.unit_block_border_radius,\n\n  color_light_background: rgba(vars.color_light_background),\n  color_dark_background:  rgba(vars.color_dark_background),\n\n  color_light_backdrop_background: \"rgba(0, 0, 0, .4)\",\n  color_dark_backdrop_background:  \"rgba(0, 0, 0, .5)\",\n  \n  // text colors are set by content, usually list tiles\n};\n"],"names":["listTileClasses","component","selected","show","el","showDuration","showDelay","style","opacity","hide","hideDuration","hideDelay","getElement","vnode","attrs","element","SHADOW_Z","OFFSET_V","DEFAULT_OFFSET_H","MIN_SIZE","ANIMATION_DURATION","positionMenu","state","target","isServer","targetEl","document","querySelector","offsetH","offset","undefined","menuEl","dom","contentEl","classes","content","origin","positionOffset","reposition","firstItem","querySelectorAll","listTile","selectedItem","selectedListTile","firstItemRect","getBoundingClientRect","selectedItemRect","top","alignEl","alignRect","targetRect","heightDiff","height","parentNode","parentRect","alignLeft","left","alignRight","right","alignTop","alignBottom","bottom","alignFn","call","showBackdrop","backdrop","backdropTarget","createElement","setAttribute","appendChild","backdropEl","backdropTransitions","hideBackdrop","then","removeChild","showMenu","onChange","visible","transitioning","transitions","defaultTransitions","log","didShow","id","hideMenu","didHide","unifySize","size","widthClass","width_n","toString","replace","handleSubscriptions","which","update","handleEscape","activateDismissTap","deActivateDismissTap","onMount","permanent","handleDismissTap","e","defaultPrevented","isTouch","addEventListener","removeEventListener","key","onUnMount","getInitialState","createStream","merge","createProps","k","keys","type","filterSupportedAttributes","parentClassName","floating","tone","className","class","join","createContent","h","renderer","Shadow","z","onclick","preventDefault","children","rgba","colorStr","vars","grid_unit_menu","unit_block_border_radius","color_light_background","color_dark_background"],"mappings":"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"}