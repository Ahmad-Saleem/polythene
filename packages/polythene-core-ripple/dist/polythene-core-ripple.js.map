{"version":3,"file":"polythene-core-ripple.js","sources":["../src/animation.js","../src/classes.js","../src/ripple.js","../src/vars.js"],"sourcesContent":["import { isTouch, getAnimationEndEvent } from \"polythene-core\";\nimport { styler } from \"polythene-core-css\";\nimport { vars } from \"polythene-theme\";\n\nconst ANIMATION_END_EVENT =    getAnimationEndEvent();\nconst DEFAULT_START_OPACITY =  0.2;\nconst DEFAULT_END_OPACITY =    0.0;\nconst DEFAULT_START_SCALE =    0.1;\nconst DEFAULT_END_SCALE =      2.0;\nconst OPACITY_DECAY_VELOCITY = 0.35;\n\nexport default ({ e, id, el, attrs, classes }) => {\n  return new Promise(resolve => {\n    const container = document.createElement(\"div\");\n    container.setAttribute(\"class\", classes.mask);\n    el.appendChild(container);\n    const waves = document.createElement(\"div\");\n    waves.setAttribute(\"class\", classes.waves);\n    container.appendChild(waves);\n    const rect = el.getBoundingClientRect();\n    const x = (isTouch && e.touches) ? e.touches[0].pageX : e.clientX;\n    const y = (isTouch && e.touches) ? e.touches[0].pageY : e.clientY;  \n    const w = el.offsetWidth;\n    const h = el.offsetHeight;\n    const waveRadius = Math.sqrt(w * w + h * h);\n    const mx = (attrs.center) ? (rect.left + rect.width / 2) : x;\n    const my = (attrs.center) ? (rect.top + rect.height / 2) : y;\n    const rx = mx - rect.left - waveRadius / 2;\n    const ry = my - rect.top - waveRadius / 2;\n    const startOpacity = attrs.startOpacity !== undefined\n      ? attrs.startOpacity\n      : DEFAULT_START_OPACITY;\n    const opacityDecayVelocity = attrs.opacityDecayVelocity !== undefined\n      ? attrs.opacityDecayVelocity\n      : OPACITY_DECAY_VELOCITY;\n    const endOpacity = attrs.endOpacity || DEFAULT_END_OPACITY;\n    const startScale = attrs.startScale || DEFAULT_START_SCALE;\n    const endScale = attrs.endScale || DEFAULT_END_SCALE;\n    const duration = attrs.duration\n      ? attrs.duration\n      : 1 / opacityDecayVelocity * 0.2;\n    const color = window.getComputedStyle(el).color;\n    \n    const style = waves.style;\n    style.width = style.height = waveRadius + \"px\";\n    style.top = ry + \"px\";\n    style.left = rx + \"px\";\n    style[\"animation-duration\"] =\n      style[\"-webkit-animation-duration\"] =\n      style[\"-moz-animation-duration\"] =\n      style[\"-o-animation-duration\"] = duration + \"s\";\n    style.backgroundColor = color;\n    style.opacity = startOpacity;\n    style.animationName = id;\n    style.animationTimingFunction = attrs.animationTimingFunction || vars.animation_curve_default;\n\n    const keyframeStyle = [{\n      [`@keyframes ${id}`]: {\n        \" 0%\": {\n          transform: \"scale(\" + startScale + \")\",\n          \"opacity\": startOpacity\n        },\n        \" 100%\": {\n          transform: \"scale(\" + endScale + \")\",\n          \"opacity\": endOpacity\n        }\n      }\n    }];\n    styler.add(id, keyframeStyle);\n\n    const animationDone = evt => {\n      styler.remove(id);\n      waves.removeEventListener(ANIMATION_END_EVENT, animationDone, false);\n      if (attrs.persistent) {\n        style.opacity = endOpacity;\n        style.transform = \"scale(\" + endScale + \")\";\n      } else {\n        waves.classList.remove(classes.wavesAnimating);\n        container.removeChild(waves);\n        el.removeChild(container);\n      }\n      resolve(evt);\n    };\n\n    waves.addEventListener(ANIMATION_END_EVENT, animationDone, false);\n    waves.classList.add(classes.wavesAnimating);\n  });\n};\n","\nexport default {\n  component:      \"pe-ripple\",\n\n  // elements\n  mask:           \"pe-ripple__mask\",\n  waves:          \"pe-ripple__waves\",\n\n  // states\n  unconstrained:    \"pe-ripple--unconstrained\",\n  wavesAnimating: \"pe-ripple__waves--animating\",\n};\n","import { pointerEndEvent, filterSupportedAttributes, isServer } from \"polythene-core\";\nimport animation from \"./animation\";\nimport classes from \"./classes\";\n\nexport const getElement = vnode =>\n  vnode.attrs.element || \"div\";\n\nexport const getInitialState = () => {\n  return {\n    animations: {},\n    animating: false,\n    cleanUp: undefined\n  };\n};\n\nexport const createProps = (vnode, { keys: k }) => {\n  const attrs = vnode.attrs;\n  return Object.assign(\n    {},\n    filterSupportedAttributes(attrs),\n    {\n      className: [\n        classes.component,\n        attrs.unconstrained ? classes.unconstrained : null,\n        attrs.tone === \"dark\" ? \"pe-dark-tone\" : null,\n        attrs.tone === \"light\" ? \"pe-light-tone\" : null,\n        attrs.className || attrs[k.class],\n      ].join(\" \")\n    }\n  );\n};\n\nconst updateAnimationState = state =>\n  state.animating = Object.keys(state.animations).length > 0;\n\nexport const onMount = vnode => {\n  if (!vnode.dom && isServer) {\n    return;\n  }\n  const state = vnode.state;\n  const attrs = vnode.attrs;\n\n  const tap = e => {\n    if (attrs.disabled || (!attrs.multi && state.animating)) {\n      return;\n    }\n    if (attrs.start) {\n      attrs.start(e);\n    }\n    const id = `ripple_animation_${new Date().getTime()}`;\n    state.animations[id] = animation({ e, id, el: vnode.dom, attrs, classes })\n      .then(evt => {\n        if (attrs.end) {\n          attrs.end(evt);\n        }\n        delete state.animations[id];\n        updateAnimationState(state);\n      });\n    updateAnimationState(state);\n  };\n  const triggerEl = attrs.target\n    ? attrs.target\n    : vnode.dom && vnode.dom.parentElement;\n  \n  triggerEl.addEventListener(pointerEndEvent, tap, false);\n  state.cleanUp = () =>\n    triggerEl.removeEventListener(pointerEndEvent, tap, false);\n};\n\nexport const onUnMount = ({ state }) =>\n  state.cleanUp && state.cleanUp();\n","export default {\n  color:         \"inherit\" // only specify this variable to get both states\n  // color_light:   \"inherit\",\n  // color_dark:    \"inherit\"\n};"],"names":["ANIMATION_END_EVENT","getAnimationEndEvent","e","id","el","attrs","classes","Promise","container","document","createElement","setAttribute","mask","appendChild","waves","rect","getBoundingClientRect","x","isTouch","touches","pageX","clientX","y","pageY","clientY","w","offsetWidth","h","offsetHeight","waveRadius","Math","sqrt","mx","center","left","width","my","top","height","rx","ry","startOpacity","undefined","opacityDecayVelocity","endOpacity","startScale","endScale","duration","color","window","getComputedStyle","style","backgroundColor","opacity","animationName","animationTimingFunction","vars","animation_curve_default","keyframeStyle","add","animationDone","remove","removeEventListener","persistent","transform","classList","wavesAnimating","removeChild","evt","addEventListener","getElement","vnode","element","getInitialState","createProps","k","keys","_extends","filterSupportedAttributes","component","unconstrained","tone","className","class","join","updateAnimationState","state","animating","Object","animations","length","onMount","dom","isServer","tap","disabled","multi","start","Date","getTime","animation","then","end","triggerEl","target","parentElement","pointerEndEvent","cleanUp","onUnMount"],"mappings":"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"}