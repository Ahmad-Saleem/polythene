{"version":3,"file":"polythene-mithril-base.js","sources":["../src/keys.js","../src/renderer.js","../node_modules/mithril/stream/stream.js","../src/stateComponent.js","../src/viewComponent.js","../src/Toggle.js"],"sourcesContent":["\nexport const keys = {\n  class:       \"class\",\n  className:   \"class\",\n  formaction:  \"formaction\",\n  onblur:      \"onblur\",\n  onclick:     \"onclick\",\n  onchange:    \"onchange\",\n  onfocus:     \"onfocus\",\n  onkeydown:   \"onkeydown\",\n  onkeyup:     \"onkeyup\",\n  onmousedown: \"onmousedown\",\n  onmouseout:  \"onmouseout\",\n  onmouseover: \"onmouseover\",\n  onmouseup:   \"onmouseup\",\n  tabindex:    \"tabindex\",\n};\n\nexport const normalizeKey = key => key.toLowerCase();\n","import m from \"mithril\";\n\nexport const renderer = m;\n","\"use strict\"\n\n;(function() {\n\nvar guid = 0, HALT = {}\nfunction createStream() {\n\tfunction stream() {\n\t\tif (arguments.length > 0 && arguments[0] !== HALT) updateStream(stream, arguments[0])\n\t\treturn stream._state.value\n\t}\n\tinitStream(stream)\n\n\tif (arguments.length > 0 && arguments[0] !== HALT) updateStream(stream, arguments[0])\n\n\treturn stream\n}\nfunction initStream(stream) {\n\tstream.constructor = createStream\n\tstream._state = {id: guid++, value: undefined, state: 0, derive: undefined, recover: undefined, deps: {}, parents: [], endStream: undefined, unregister: undefined}\n\tstream.map = stream[\"fantasy-land/map\"] = map, stream[\"fantasy-land/ap\"] = ap, stream[\"fantasy-land/of\"] = createStream\n\tstream.valueOf = valueOf, stream.toJSON = toJSON, stream.toString = valueOf\n\n\tObject.defineProperties(stream, {\n\t\tend: {get: function() {\n\t\t\tif (!stream._state.endStream) {\n\t\t\t\tvar endStream = createStream()\n\t\t\t\tendStream.map(function(value) {\n\t\t\t\t\tif (value === true) {\n\t\t\t\t\t\tunregisterStream(stream)\n\t\t\t\t\t\tendStream._state.unregister = function(){unregisterStream(endStream)}\n\t\t\t\t\t}\n\t\t\t\t\treturn value\n\t\t\t\t})\n\t\t\t\tstream._state.endStream = endStream\n\t\t\t}\n\t\t\treturn stream._state.endStream\n\t\t}}\n\t})\n}\nfunction updateStream(stream, value) {\n\tupdateState(stream, value)\n\tfor (var id in stream._state.deps) updateDependency(stream._state.deps[id], false)\n\tif (stream._state.unregister != null) stream._state.unregister()\n\tfinalize(stream)\n}\nfunction updateState(stream, value) {\n\tstream._state.value = value\n\tstream._state.changed = true\n\tif (stream._state.state !== 2) stream._state.state = 1\n}\nfunction updateDependency(stream, mustSync) {\n\tvar state = stream._state, parents = state.parents\n\tif (parents.length > 0 && parents.every(active) && (mustSync || parents.some(changed))) {\n\t\tvar value = stream._state.derive()\n\t\tif (value === HALT) return false\n\t\tupdateState(stream, value)\n\t}\n}\nfunction finalize(stream) {\n\tstream._state.changed = false\n\tfor (var id in stream._state.deps) stream._state.deps[id]._state.changed = false\n}\n\nfunction combine(fn, streams) {\n\tif (!streams.every(valid)) throw new Error(\"Ensure that each item passed to stream.combine/stream.merge is a stream\")\n\treturn initDependency(createStream(), streams, function() {\n\t\treturn fn.apply(this, streams.concat([streams.filter(changed)]))\n\t})\n}\n\nfunction initDependency(dep, streams, derive) {\n\tvar state = dep._state\n\tstate.derive = derive\n\tstate.parents = streams.filter(notEnded)\n\n\tregisterDependency(dep, state.parents)\n\tupdateDependency(dep, true)\n\n\treturn dep\n}\nfunction registerDependency(stream, parents) {\n\tfor (var i = 0; i < parents.length; i++) {\n\t\tparents[i]._state.deps[stream._state.id] = stream\n\t\tregisterDependency(stream, parents[i]._state.parents)\n\t}\n}\nfunction unregisterStream(stream) {\n\tfor (var i = 0; i < stream._state.parents.length; i++) {\n\t\tvar parent = stream._state.parents[i]\n\t\tdelete parent._state.deps[stream._state.id]\n\t}\n\tfor (var id in stream._state.deps) {\n\t\tvar dependent = stream._state.deps[id]\n\t\tvar index = dependent._state.parents.indexOf(stream)\n\t\tif (index > -1) dependent._state.parents.splice(index, 1)\n\t}\n\tstream._state.state = 2 //ended\n\tstream._state.deps = {}\n}\n\nfunction map(fn) {return combine(function(stream) {return fn(stream())}, [this])}\nfunction ap(stream) {return combine(function(s1, s2) {return s1()(s2())}, [stream, this])}\nfunction valueOf() {return this._state.value}\nfunction toJSON() {return this._state.value != null && typeof this._state.value.toJSON === \"function\" ? this._state.value.toJSON() : this._state.value}\n\nfunction valid(stream) {return stream._state }\nfunction active(stream) {return stream._state.state === 1}\nfunction changed(stream) {return stream._state.changed}\nfunction notEnded(stream) {return stream._state.state !== 2}\n\nfunction merge(streams) {\n\treturn combine(function() {\n\t\treturn streams.map(function(s) {return s()})\n\t}, streams)\n}\n\nfunction scan(reducer, seed, stream) {\n\tvar newStream = combine(function (s) {\n\t\treturn seed = reducer(seed, s._state.value)\n\t}, [stream])\n\n\tif (newStream._state.state === 0) newStream(seed)\n\n\treturn newStream\n}\n\nfunction scanMerge(tuples, seed) {\n\tvar streams = tuples.map(function(tuple) {\n\t\tvar stream = tuple[0]\n\t\tif (stream._state.state === 0) stream(undefined)\n\t\treturn stream\n\t})\n\n\tvar newStream = combine(function() {\n\t\tvar changed = arguments[arguments.length - 1]\n\n\t\tstreams.forEach(function(stream, idx) {\n\t\t\tif (changed.indexOf(stream) > -1) {\n\t\t\t\tseed = tuples[idx][1](seed, stream._state.value)\n\t\t\t}\n\t\t})\n\n\t\treturn seed\n\t}, streams)\n\n\treturn newStream\n}\n\ncreateStream[\"fantasy-land/of\"] = createStream\ncreateStream.merge = merge\ncreateStream.combine = combine\ncreateStream.scan = scan\ncreateStream.scanMerge = scanMerge\ncreateStream.HALT = HALT\n\nif (typeof module !== \"undefined\") module[\"exports\"] = createStream\nelse if (typeof window.m === \"function\" && !(\"stream\" in window.m)) window.m.stream = createStream\nelse window.m = {stream : createStream}\n\n}());\n","import stream from \"mithril/stream\";\nimport { renderer } from \"./renderer\";\nimport { keys } from \"./keys\";\n\nconst requiresKeys = false;\n\nexport const stateComponent = ({\n  createContent = () => {},\n  createProps = () => {},\n  element = \"div\",\n  component,\n  getInitialState = () => ({}),\n  onMount = () => {},\n  onUnmount = () => {},\n}) => {\n\n  const oninit = vnode => {\n    const protoState = Object.assign(\n      {},\n      vnode\n    );\n    const initialState = getInitialState(protoState, stream);\n    vnode.state = initialState;\n    vnode.state.redrawOnUpdate && vnode.state.redrawOnUpdate.map(() => (\n      setTimeout(renderer.redraw)\n    ));\n  };\n\n  const view = vnode => {\n    return renderer(\n      component || vnode.attrs.element || element,\n      createProps(vnode, { renderer, requiresKeys, keys }),\n      [\n        vnode.attrs.before,\n        createContent(vnode, { renderer, requiresKeys, keys }),\n        vnode.attrs.after\n      ]\n    );\n  };\n\n  return {\n    view,\n    oninit: oninit,\n    oncreate: onMount,\n    onremove: onUnmount\n  };\n};\n","import { renderer } from \"./renderer\";\nimport { keys } from \"./keys\";\n\nconst requiresKeys = false;\n\nexport const viewComponent = ({\n  createContent = () => {},\n  createProps = () => {},\n  element = \"div\",\n  component,\n  renderView,\n  onMount = () => {},\n  onUnmount = () => {},\n}) => {\n\n  const view = vnode => {\n    return renderer(\n      component || vnode.attrs.element || element,\n      createProps(vnode, { renderer, requiresKeys, keys }),\n      [\n        vnode.attrs.before,\n        createContent(vnode, { renderer, requiresKeys, keys }),\n        vnode.attrs.after\n      ]\n    );\n  };\n\n  return {\n    view: renderView || view,\n    oncreate: onMount,\n    onremove: onUnmount\n  };\n};\n","import { renderer as h } from \"./renderer\";\n\nexport const Toggle = {\n  oninit: vnode => {\n    vnode.state = {\n      visible: vnode.attrs.permanent || vnode.attrs.show || false,\n      transitioning: false\n    };\n  },\n  view: vnode => {\n    const attrs = vnode.attrs;\n    const state = vnode.state;\n    if (!attrs.permanent && !state.transitioning) {\n      if (attrs.show) {\n        state.visible = true;\n      } else if (attrs.hide) {\n        state.visible = false;\n      }\n    }\n    const updateState = () => {\n      if (attrs.getState) {\n        attrs.getState({\n          visible: vnode.state.visible,\n          transitioning: vnode.state.transitioning\n        });\n      }\n    };\n    return state.visible\n      ? h(attrs.instance,\n          Object.assign(\n            {},\n            attrs,\n            {\n              setVisible: value => {\n                state.visible = value;\n                updateState();\n                h.redraw();\n              },\n              setTransitioning: value => {\n                state.transitioning = value;\n                updateState();\n                h.redraw();\n              },\n            }\n          )\n        )\n      : h(\"span\", { className: attrs.placeholderClassName });\n  }\n};\n"],"names":["keys","renderer","createStream","stream","arguments","length","HALT","updateStream","_state","value","initStream","constructor","id","guid","undefined","state","derive","recover","deps","parents","endStream","unregister","map","ap","valueOf","toJSON","toString","defineProperties","get","updateState","changed","updateDependency","mustSync","every","active","some","finalize","combine","fn","streams","valid","Error","initDependency","apply","this","concat","filter","dep","notEnded","registerDependency","i","unregisterStream","dependent","index","indexOf","splice","s1","s2","merge","s","scan","reducer","seed","newStream","scanMerge","tuples","tuple","forEach","idx","stateComponent","createContent","createProps","element","component","getInitialState","onMount","onUnmount","vnode","attrs","requiresKeys","before","after","protoState","_extends","initialState","redrawOnUpdate","setTimeout","redraw","viewComponent","renderView","view","Toggle","permanent","show","transitioning","visible","hide","getState","h","instance","className","placeholderClassName"],"mappings":"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"}