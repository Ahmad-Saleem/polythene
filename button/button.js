"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _typeof=typeof Symbol==="function"&&typeof Symbol.iterator==="symbol"?function(obj){return typeof obj}:function(obj){return obj&&typeof Symbol==="function"&&obj.constructor===Symbol?"symbol":typeof obj};require("polythene/common/object.assign");var _polythene=require("polythene/polythene/polythene");var _polythene2=_interopRequireDefault(_polythene);var _mithril=require("mithril");var _mithril2=_interopRequireDefault(_mithril);var _ripple=require("polythene/ripple/ripple");var _ripple2=_interopRequireDefault(_ripple);var _shadow=require("polythene/shadow/shadow");var _shadow2=_interopRequireDefault(_shadow);require("polythene/base-button/base-button");require("polythene/button/theme/theme");function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{"default":obj}}var CSS_CLASSES={block:"pe-button pe-button--text",content:"pe-button__content",label:"pe-button__label",raised:"pe-button--raised",wash:"pe-button__wash",selected:"pe-button--selected",disabled:"pe-button--disabled",borders:"pe-button--borders",inactive:"pe-button--inactive"};var MAX_Z=5;var startType=window.PointerEvent?"pointerdown":"ontouchstart"in window||window.DocumentTouch&&document instanceof DocumentTouch?"touchstart":"mousedown";var endType=window.PointerEvent?"pointerup":"ontouchend"in window||window.DocumentTouch&&document instanceof DocumentTouch?"touchend":"mouseup";var tapStart=undefined,tapEnd=undefined,tapEndAll=undefined,downButtons=[];var animateZ=function animateZ(ctrl,opts,name){var baseZ=ctrl.baseZ();var increase=opts.increase||1;var z=ctrl.z();if(name==="down"&&baseZ!==5){z=z+increase;z=Math.min(z,MAX_Z)}else if(name==="up"){z=z-increase;z=Math.max(z,baseZ)}if(z!==ctrl.z()){ctrl.z(z);_mithril2.default.redraw()}};var inactivate=function inactivate(ctrl,opts){ctrl.inactive=true;_mithril2.default.redraw();setTimeout(function(){ctrl.inactive=false;_mithril2.default.redraw()},opts.inactivate*1e3)};var initTapEvents=function initTapEvents(el,ctrl,opts){var tapHandler=function tapHandler(ctrl,opts,name){if(name==="down"){downButtons.push({ctrl:ctrl,opts:opts})}else if(name==="up"){if(opts.inactivate&&!opts.inactive){inactivate(ctrl,opts)}}if(opts.animateOnTap&&!_polythene2.default.isTouch){animateZ(ctrl,opts,name)}};tapStart=function tapStart(){return tapHandler(ctrl,opts,"down")};tapEnd=function tapEnd(){return tapHandler(ctrl,opts,"up")};tapEndAll=function tapEndAll(){downButtons.map(function(btn){tapHandler(btn.ctrl,btn.opts,"up")});downButtons=[]};el.addEventListener(startType,tapStart);el.addEventListener(endType,tapEnd);window.addEventListener(endType,tapEndAll)};var clearTapEvents=function clearTapEvents(el){el.removeEventListener(startType,tapStart);el.removeEventListener(endType,tapEnd);window.removeEventListener(endType,tapEndAll)};var createView=function createView(ctrl){var opts=arguments.length<=1||arguments[1]===undefined?{}:arguments[1];var noink=opts.ink!==undefined&&!opts.ink;var disabled=opts.disabled;var inactive=ctrl.inactive;var tag=opts.tag||"a";var buttonConfig=function buttonConfig(el,isInited,context){if(isInited){return}if(!disabled&&!inactive){initTapEvents(el,ctrl,Object.assign({},opts,{animateOnTap:opts.animateOnTap!==undefined?opts.animateOnTap:true}));context.onunload=function(){clearTapEvents(el)}}};var optsConfig=opts.config||function(){};var urlConfig=opts.url&&opts.url.config?opts.url.config:function(){};var props=Object.assign({},{"class":[opts.parentClass||CSS_CLASSES.block,opts.selected?CSS_CLASSES.selected:null,disabled?CSS_CLASSES.disabled:null,inactive?CSS_CLASSES.inactive:null,opts.borders?CSS_CLASSES.borders:null,opts.raised?CSS_CLASSES.raised:null,opts.class].join(" "),id:opts.id||""},opts.url?opts.url:null,opts.formaction?{formaction:opts.formaction}:null,opts.type?{type:opts.type}:null,opts.events?opts.events:null,{config:function config(){return[buttonConfig.apply(undefined,arguments),optsConfig.apply(undefined,arguments),urlConfig.apply(undefined,arguments)]}});var label=opts.content?opts.content:opts.label?_typeof(opts.label)==="object"?opts.label:(0,_mithril2.default)("div",{"class":CSS_CLASSES.label},opts.label):null;var content=(0,_mithril2.default)("div",{"class":CSS_CLASSES.content},[opts.raised&&!disabled?_mithril2.default.component(_shadow2.default,{z:ctrl.z(),animated:true}):null,disabled||noink?null:_mithril2.default.component(_ripple2.default,opts.ripple||{}),disabled||opts.wash!==undefined&&!opts.wash?null:(0,_mithril2.default)("div",{"class":CSS_CLASSES.wash}),label]);return(0,_mithril2.default)(tag,props,[opts.before,content,opts.after])};var component={controller:function controller(){var opts=arguments.length<=0||arguments[0]===undefined?{}:arguments[0];var z=opts.z!==undefined?opts.z:1;return{baseZ:_mithril2.default.prop(z),z:_mithril2.default.prop(z),inactive:opts.inactive||false}},view:function view(ctrl){var opts=arguments.length<=1||arguments[1]===undefined?{}:arguments[1];return createView(ctrl,opts)}};exports.default=component;module.exports=exports["default"];