{"version":3,"file":"polythene-core-material-design-progress-spinner.js","sources":["../src/vars.js","../../polythene-css-classes/material-design-progress-spinner.js","../src/spinner.js"],"sourcesContent":["import { vars } from \"polythene-theme\";\nimport { vars as baseVars } from \"polythene-core-base-spinner\";\n\nconst rgba = (colorStr, opacity = 1) =>\n  `rgba(${colorStr}, ${opacity})`;\n  \nexport default Object.assign(\n  {},\n  baseVars,\n  {\n    border_width_small:   baseVars.size_small / baseVars.size_regular * 3,\n    border_width_regular: 3,\n    border_width_medium:  baseVars.size_medium / baseVars.size_regular * 3,\n    border_width_large:   baseVars.size_large / baseVars.size_regular * 3,\n    border_width_fab:     baseVars.size_fab / baseVars.size_regular * 3,\n    animation_duration:   \"1.5s\",\n\n    color_light:          rgba(vars.color_primary),\n    color_dark:           rgba(vars.color_primary)\n  }\n);\n","\nexport default {\n  component:          \"pe-md-progress-spinner\",\n\n  // elements\n  animation:          \"pe-md-progress-spinner__animation\",\n  circle:             \"pe-md-progress-spinner__circle\",\n  circleRight:        \"pe-md-progress-spinner__circle-right\",\n  circleLeft:         \"pe-md-progress-spinner__circle-left\"\n};\n","import { unpackAttrs } from \"polythene-core\";\nimport { easing } from \"polythene-utilities\";\nimport themeVars from \"./vars\";\nimport classes from \"polythene-css-classes/material-design-progress-spinner\";\n\nconst DEFAULT_UPDATE_DURATION = .8;\n\nconst sizeFromName = (size = \"regular\") => themeVars[\"size_\" + size];\n\nconst percentageValue = (min, max, percentage = 0) => min + ((max - min) * percentage);\n\nconst rotateCircle = (el, min, max, percentage) => {\n  const style = el.style;\n  style[\"transform\"] =\n    style[\"-webkit-transform\"] =\n    style[\"-moz-transform\"] =\n    style[\"-ms-transform\"] =\n    style[\"-o-transform\"] = \"rotate(\" + percentageValue(min, max, percentage) + \"deg)\";\n};\n\nconst animate = (stateEl, size, percentage) => {\n  const animationEl = stateEl.querySelector(\".\" + classes.animation);\n  const animationElStyle = animationEl.style;\n  if (percentage < 0.5) {\n    animationElStyle.clip = \"rect(0px, \" + size + \"px, \" + size + \"px, \" + size / 2 + \"px)\";\n  } else {\n    animationElStyle.clip = \"rect(auto, auto, auto, auto)\";\n  }\n  const leftCircle = stateEl.querySelector(\".\" + classes.circleLeft);\n  const rightCircle = stateEl.querySelector(\".\" + classes.circleRight);\n  leftCircle.style.clip = rightCircle.style.clip = \"rect(0px, \" + size / 2 + \"px, \" + size + \"px, \" + \"0px)\";\n  rotateCircle(rightCircle, 0, 180, Math.min(1, percentage * 2));\n  rotateCircle(leftCircle, 0, 360, percentage);\n};\n\nconst handlePercentage = (percentage, state, size, attrs) => {\n  if (!state.dom()) {\n    return;\n  }\n  if (state.animating()) {\n    return;\n  }\n  const previousPercentage = state.percentage();\n  if (attrs.animated && previousPercentage !== percentage) {\n    const animationDuration = (attrs.updateDuration || DEFAULT_UPDATE_DURATION) * 1000;\n    const el = state.dom();\n    let start = null;\n    const step = timestamp => {\n      if (!start) start = timestamp;\n      const progress = timestamp - start;\n      const stepPercentage = 1.0 / animationDuration * progress;\n      const newPercentage = previousPercentage + stepPercentage * (percentage - previousPercentage);\n      animate(el, size, easing.easeInOutQuad(newPercentage));\n      if (start && progress < animationDuration) {\n        window.requestAnimationFrame(step);\n      } else {\n        start = null;\n        state.percentage(percentage);\n        state.animating(false);\n      }\n    };\n    state.animating(true);\n    window.requestAnimationFrame(step);\n  } else {\n    animate(state.dom(), size, percentage);\n    state.percentage(percentage);\n  }\n};\n\nconst notifyState = (state, attrs, size) => {\n  if (attrs.percentage !== undefined) {\n    const percentage = unpackAttrs(attrs.percentage);\n    handlePercentage(percentage, state, size, attrs);\n  }\n};\n\nconst getSize = attrs => {\n  const rawSize = sizeFromName(attrs.size);\n  const { padding, paddedSize } = themeVars.raisedSize(rawSize);\n  return attrs.raised\n    ? paddedSize - 2 * padding\n    : rawSize;\n};\n\nexport const getInitialState = (vnode, createStream) => {\n  const percentage = createStream(0);\n  const dom = createStream(null);\n  const animating = createStream(false);\n  return {\n    dom,\n    percentage,\n    animating\n  };\n};\n\nexport const onMount = vnode => {\n  if (!vnode.dom) {\n    return;\n  }\n  const state = vnode.state;\n  const attrs = vnode.attrs;\n  state.dom(vnode.dom);\n  const size = getSize(attrs);\n  notifyState(state, attrs, size);\n};\n\nexport const createProps = (vnode, { renderer: h }) => {\n  const state = vnode.state;\n  const attrs = vnode.attrs;\n  const size = getSize(attrs);\n  notifyState(state, attrs, size);\n\n  const content = h(\"div\",\n    {\n      key: \"content\",\n      className: classes.animation,\n      style: {\n        width: size + \"px\",\n        height: size + \"px\"\n      }\n    },\n    [\n      h(\"div\", {\n        key: \"left\",\n        className: [classes.circle, classes.circleLeft].join(\" \")\n      }),\n      h(\"div\", {\n        key: \"right\",\n        className: [classes.circle, classes.circleRight].join(\" \")\n      })\n    ]\n  );\n\n  return Object.assign(\n    {},\n    attrs,\n    {\n      className: [classes.component, attrs.className].join(\" \"),\n      content\n    }\n  );\n};\n"],"names":["rgba","colorStr","opacity","_extends","baseVars","size_small","size_regular","size_medium","size_large","size_fab","vars","color_primary","DEFAULT_UPDATE_DURATION","sizeFromName","size","themeVars","percentageValue","min","max","percentage","rotateCircle","el","style","animate","stateEl","animationEl","querySelector","classes","animation","animationElStyle","clip","leftCircle","circleLeft","rightCircle","circleRight","Math","handlePercentage","state","attrs","dom","animating","previousPercentage","animated","animationDuration","updateDuration","start","step","timestamp","progress","stepPercentage","newPercentage","easing","easeInOutQuad","requestAnimationFrame","notifyState","undefined","unpackAttrs","getSize","rawSize","raisedSize","padding","paddedSize","raised","getInitialState","vnode","createStream","onMount","createProps","h","renderer","content","circle","join","component","className"],"mappings":"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"}