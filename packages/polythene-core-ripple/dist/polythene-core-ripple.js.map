{"version":3,"file":"polythene-core-ripple.js","sources":["../src/classes.js","../src/theme/vars.js","../src/theme/layout.js","../src/theme/color.js","../src/theme/index.js","../src/theme/animation.js","../src/ripple.js"],"sourcesContent":["\nexport default {\n  component:      \"pe-ripple\",\n\n  // elements\n  mask:           \"pe-ripple__mask\",\n  waves:          \"pe-ripple__waves\",\n\n  // states\n  unconstrained:    \"pe-ripple--unconstrained\",\n  wavesAnimating: \"pe-ripple__waves--animating\",\n};\n","export default {\n  color:         \"inherit\" // only specify this variable to get both states\n  // color_light:   \"inherit\",\n  // color_dark:    \"inherit\"\n};","import { mixin } from \"polythene-core-css\";\n\nexport default selector => [{\n  [selector]: [\n    mixin.fit(), {\n      color: \"inherit\",\n      borderRadius: \"inherit\",\n      pointerEvents: \"none\",\n      \n      \":not(.pe-ripple--unconstrained)\": {\n        borderRadius: \"inherit\",\n\n        \" .pe-ripple__mask\": {\n          overflow: \"hidden\",\n          borderRadius: \"inherit\"\n        }\n      },\n      \" .pe-ripple__mask\": [\n        mixin.fit(),\n        {\n          transform: \"translate3d(0,0,0)\"\n        }\n      ],\n\n      \" .pe-ripple__waves\": {\n        outline: \"1px solid transparent\", // for IE10\n        position: \"absolute\",\n        borderRadius: \"50%\",\n        pointerEvents: \"none\",\n        display: \"none\"\n      },\n      \" .pe-ripple__waves--animating\": {\n        display: \"block\"\n      }\n    }\n  ]\n}];\n","\nconst style = (scopes, selector, componentVars, tint) => [{\n  [scopes.map(s => s + selector).join(\",\")]: {\n    color: componentVars[\"color_\" + tint] || componentVars[\"color\"] || \"inherit\"\n  }\n}];\n\nexport default (selector, componentVars) => [\n  style([\".pe-dark-tone\", \".pe-dark-tone \"], selector, componentVars, \"dark\"), // has/inside dark tone\n  style([\"\", \".pe-light-tone\", \".pe-light-tone \"], selector, componentVars, \"light\"), // normal, has/inside light tone\n];\n","import { styler } from \"polythene-core-css\";\nimport classes from \"../classes\";\nimport vars from \"./vars\";\nimport layout from \"./layout\";\nimport color from \"./color\";\n\nconst fns = [layout, color];\nconst selector = `.${classes.component}`;\n\nexport const customTheme = (customSelector, customVars) => \n  styler.generateStyles([customSelector, selector], {...vars, ...customVars}, fns);\n\nstyler.generateStyles([selector], vars, fns);\n","import { isTouch, getAnimationEndEvent } from \"polythene-core\";\nimport { styler } from \"polythene-core-css\";\nimport { vars } from \"polythene-theme\";\n\nconst ANIMATION_END_EVENT =    getAnimationEndEvent();\nconst DEFAULT_START_OPACITY =  0.2;\nconst DEFAULT_END_OPACITY =    0.0;\nconst DEFAULT_START_SCALE =    0.1;\nconst DEFAULT_END_SCALE =      2.0;\nconst OPACITY_DECAY_VELOCITY = 0.35;\n\nexport default ({ e, id, el, attrs, classes }) => {\n  return new Promise(resolve => {\n    const container = document.createElement(\"div\");\n    container.setAttribute(\"class\", classes.mask);\n    el.appendChild(container);\n    const waves = document.createElement(\"div\");\n    waves.setAttribute(\"class\", classes.waves);\n    container.appendChild(waves);\n    const rect = el.getBoundingClientRect();\n    const x = (isTouch && e.touches) ? e.touches[0].pageX : e.clientX;\n    const y = (isTouch && e.touches) ? e.touches[0].pageY : e.clientY;  \n    const w = el.offsetWidth;\n    const h = el.offsetHeight;\n    const waveRadius = Math.sqrt(w * w + h * h);\n    const mx = (attrs.center) ? (rect.left + rect.width / 2) : x;\n    const my = (attrs.center) ? (rect.top + rect.height / 2) : y;\n    const rx = mx - rect.left - waveRadius / 2;\n    const ry = my - rect.top - waveRadius / 2;\n    const startOpacity = attrs.startOpacity !== undefined\n      ? attrs.startOpacity\n      : DEFAULT_START_OPACITY;\n    const opacityDecayVelocity = attrs.opacityDecayVelocity !== undefined\n      ? attrs.opacityDecayVelocity\n      : OPACITY_DECAY_VELOCITY;\n    const endOpacity = attrs.endOpacity || DEFAULT_END_OPACITY;\n    const startScale = attrs.startScale || DEFAULT_START_SCALE;\n    const endScale = attrs.endScale || DEFAULT_END_SCALE;\n    const duration = attrs.duration\n      ? attrs.duration\n      : 1 / opacityDecayVelocity * 0.2;\n    const color = window.getComputedStyle(el).color;\n    \n    const style = waves.style;\n    style.width = style.height = waveRadius + \"px\";\n    style.top = ry + \"px\";\n    style.left = rx + \"px\";\n    style[\"animation-duration\"] =\n      style[\"-webkit-animation-duration\"] =\n      style[\"-moz-animation-duration\"] =\n      style[\"-o-animation-duration\"] = duration + \"s\";\n    style.backgroundColor = color;\n    style.opacity = startOpacity;\n    style.animationName = id;\n    style.animationTimingFunction = attrs.animationTimingFunction || vars.animation_curve_default;\n\n    const keyframeStyle = [{\n      [`@keyframes ${id}`]: {\n        \" 0%\": {\n          transform: \"scale(\" + startScale + \")\",\n          \"opacity\": startOpacity\n        },\n        \" 100%\": {\n          transform: \"scale(\" + endScale + \")\",\n          \"opacity\": endOpacity\n        }\n      }\n    }];\n    styler.add(id, keyframeStyle);\n\n    const animationDone = evt => {\n      styler.remove(id);\n      waves.removeEventListener(ANIMATION_END_EVENT, animationDone, false);\n      if (attrs.persistent) {\n        style.opacity = endOpacity;\n        style.transform = \"scale(\" + endScale + \")\";\n      } else {\n        waves.classList.remove(classes.wavesAnimating);\n        container.removeChild(waves);\n        el.removeChild(container);\n      }\n      resolve(evt);\n    };\n\n    waves.addEventListener(ANIMATION_END_EVENT, animationDone, false);\n    waves.classList.add(classes.wavesAnimating);\n  });\n};\n","import { pointerEndEvent, filterSupportedAttributes, isServer } from \"polythene-core\";\nimport { customTheme } from \"./theme\";\nimport animation from \"./theme/animation\";\nimport classes from \"./classes\";\n\nexport const getElement = vnode =>\n  vnode.attrs.element || \"div\";\n\nexport const theme = customTheme;\n\nexport const getInitialState = () => {\n  return {\n    animations: {},\n    animating: false,\n    cleanUp: undefined\n  };\n};\n\nexport const createProps = (vnode, { keys: k }) => {\n  const attrs = vnode.attrs;\n  return Object.assign(\n    {},\n    filterSupportedAttributes(attrs),\n    {\n      className: [\n        classes.component,\n        attrs.unconstrained ? classes.unconstrained : null,\n        attrs.tone === \"dark\" ? \"pe-dark-tone\" : null,\n        attrs.tone === \"light\" ? \"pe-light-tone\" : null,\n        attrs.className || attrs[k.class],\n      ].join(\" \")\n    }\n  );\n};\n\nconst updateAnimationState = state =>\n  state.animating = Object.keys(state.animations).length > 0;\n\nexport const onMount = vnode => {\n  if (!vnode.dom && isServer) {\n    return;\n  }\n  const state = vnode.state;\n  const attrs = vnode.attrs;\n\n  const tap = e => {\n    if (attrs.disabled || (!attrs.multi && state.animating)) {\n      return;\n    }\n    if (attrs.start) {\n      attrs.start(e);\n    }\n    const id = `ripple_animation_${new Date().getTime()}`;\n    state.animations[id] = animation({ e, id, el: vnode.dom, attrs, classes })\n      .then(evt => {\n        if (attrs.end) {\n          attrs.end(evt);\n        }\n        delete state.animations[id];\n        updateAnimationState(state);\n      });\n    updateAnimationState(state);\n  };\n  const triggerEl = attrs.target\n    ? attrs.target\n    : vnode.dom && vnode.dom.parentElement;\n  \n  triggerEl.addEventListener(pointerEndEvent, tap, false);\n  state.cleanUp = () =>\n    triggerEl.removeEventListener(pointerEndEvent, tap, false);\n};\n\nexport const onUnMount = ({ state }) =>\n  state.cleanUp && state.cleanUp();\n"],"names":["selector","mixin","fit","style","scopes","componentVars","tint","map","s","join","fns","layout","color","classes","component","customTheme","customSelector","customVars","styler","generateStyles","vars","ANIMATION_END_EVENT","getAnimationEndEvent","e","id","el","attrs","Promise","container","document","createElement","setAttribute","mask","appendChild","waves","rect","getBoundingClientRect","x","isTouch","touches","pageX","clientX","y","pageY","clientY","w","offsetWidth","h","offsetHeight","waveRadius","Math","sqrt","mx","center","left","width","my","top","height","rx","ry","startOpacity","undefined","opacityDecayVelocity","endOpacity","startScale","endScale","duration","window","getComputedStyle","backgroundColor","opacity","animationName","animationTimingFunction","animation_curve_default","keyframeStyle","add","animationDone","remove","removeEventListener","persistent","transform","classList","wavesAnimating","removeChild","evt","addEventListener","getElement","vnode","element","theme","getInitialState","createProps","k","keys","_extends","filterSupportedAttributes","unconstrained","tone","className","class","updateAnimationState","state","animating","Object","animations","length","onMount","dom","isServer","tap","disabled","multi","start","Date","getTime","animation","then","end","triggerEl","target","parentElement","pointerEndEvent","cleanUp","onUnMount"],"mappings":"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"}