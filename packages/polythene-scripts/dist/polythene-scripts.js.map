{"version":3,"file":"polythene-scripts.js","sources":["../src/write-css.js"],"sourcesContent":["const autoprefixer = require(\"autoprefixer\");\nconst cssbeautify  = require(\"cssbeautify\");\nconst fs           = require(\"fs\");\nconst J2c          = require(\"j2c\");\nconst postcss      = require(\"postcss\");\nconst cssnano      = require(\"cssnano\");\nconst tar          = require(\"tar\");\n\nconst j2c = new J2c();\nconst COLOR_RED = \"\\x1b[31m\";\nconst COLOR_WHITE = \"\\x1b[37m\";\n\nconst makeStyleSheet = (...styles) =>\n  styles.reduce((acc, styleList) =>\n    // each style returns a list\n    Object.keys(styleList).length\n      ? (\n        styleList.forEach(style => {\n          const scoped = {\n            \"@global\": style\n          };\n          const sheet = j2c.sheet(scoped);\n          acc += sheet;      \n        }),\n        acc\n      )\n      : acc, \"\");\n\nconst beautifyCSS = cssString =>\n  cssbeautify(cssString, {\n    indent: \"  \"\n  });\n\nconst saveToFile = (path, cssString) => \n  fs.writeFileSync(path, cssString, \"ascii\", err => {  \n    // throws an error, you could also catch it here\n    if (err) throw err;\n  });\n\nexport const processCSS = ({ styles, path, autoPrefix }) => {\n  const cssString = styles.reduce((acc, current) => (\n    acc + makeStyleSheet(current)\n  ), \"\");\n  return { cssString, path, autoPrefix };\n};\n\nexport const writeCSS = ({ css, styles, path, autoPrefix, beautify, sourceMap=true, gzip }) => {\n  const cssString = css\n    ? css\n    : styles\n      ? styles.reduce((acc, current) => acc + makeStyleSheet(current), \"\")\n      : \"\";\n\n  const mapPath = `${path}.map`;\n\n  const plugins = [];\n  if (autoPrefix) {\n    plugins.push(autoprefixer());\n  }\n  plugins.push(cssnano({\n    preset:       \"default\",\n    reduceIdents: false,\n    zindex:       false,\n  }));\n\n  const options = sourceMap\n    ? {\n      to:  path,\n      map: { inline: false }\n    }\n    : {};\n\n  postcss(plugins)\n    .process(cssString, options)\n    .then(result => {\n      result.warnings().forEach(warn => {\n        console.warn(COLOR_RED, \"Warning\", COLOR_WHITE, warn.toString()); // eslint-disable-line no-console\n      });\n      saveToFile(path, beautify ? beautifyCSS(result.css) : result.css);\n      if (gzip) {\n        tar.c(\n          { gzip: true },\n          [path]\n        ).pipe(fs.createWriteStream(`${path}.gz`));\n      }\n      if (sourceMap) {\n        saveToFile(mapPath, result.map);\n      }\n    });\n};\n\n"],"names":["autoprefixer","require","cssbeautify","fs","J2c","postcss","cssnano","tar","j2c","COLOR_RED","COLOR_WHITE","makeStyleSheet","styles","reduce","acc","styleList","keys","length","forEach","scoped","style","sheet","beautifyCSS","cssString","saveToFile","path","writeFileSync","err","writeCSS","css","autoPrefix","beautify","sourceMap","gzip","current","mapPath","plugins","push","options","inline","process","then","warnings","warn","toString","result","c","pipe","createWriteStream","map"],"mappings":";;;;;;AAAA,IAAMA,eAAeC,QAAQ,cAAR,CAArB;AACA,IAAMC,cAAeD,QAAQ,aAAR,CAArB;AACA,IAAME,KAAeF,QAAQ,IAAR,CAArB;AACA,IAAMG,MAAeH,QAAQ,KAAR,CAArB;AACA,IAAMI,UAAeJ,QAAQ,SAAR,CAArB;AACA,IAAMK,UAAeL,QAAQ,SAAR,CAArB;AACA,IAAMM,MAAeN,QAAQ,KAAR,CAArB;;AAEA,IAAMO,MAAM,IAAIJ,GAAJ,EAAZ;AACA,IAAMK,YAAY,UAAlB;AACA,IAAMC,cAAc,UAApB;;AAEA,IAAMC,iBAAiB,SAAjBA,cAAiB;oCAAIC,MAAJ;UAAA;;;SACrBA,OAAOC,MAAP,CAAc,UAACC,GAAD,EAAMC,SAAN;;;aAELC,IAAP,CAAYD,SAAZ,EAAuBE,MAAvB,IAEIF,UAAUG,OAAV,CAAkB,iBAAS;YACnBC,SAAS;qBACFC;SADb;YAGMC,QAAQb,IAAIa,KAAJ,CAAUF,MAAV,CAAd;eACOE,KAAP;OALF,GAOAP,GATJ,IAWIA;;GAbN,EAaW,EAbX,CADqB;CAAvB;;AAgBA,IAAMQ,cAAc,SAAdA,WAAc;SAClBpB,YAAYqB,SAAZ,EAAuB;YACb;GADV,CADkB;CAApB;;AAKA,IAAMC,aAAa,SAAbA,UAAa,CAACC,IAAD,EAAOF,SAAP;SACjBpB,GAAGuB,aAAH,CAAiBD,IAAjB,EAAuBF,SAAvB,EAAkC,OAAlC,EAA2C,eAAO;;QAE5CI,GAAJ,EAAS,MAAMA,GAAN;GAFX,CADiB;CAAnB;;AAMA;;AAOA,AAAO,IAAMC,WAAW,SAAXA,QAAW,QAAuE;MAApEC,GAAoE,SAApEA,GAAoE;MAA/DjB,MAA+D,SAA/DA,MAA+D;MAAvDa,IAAuD,SAAvDA,IAAuD;MAAjDK,UAAiD,SAAjDA,UAAiD;MAArCC,QAAqC,SAArCA,QAAqC;8BAA3BC,SAA2B;MAA3BA,SAA2B,mCAAjB,IAAiB;MAAXC,IAAW,SAAXA,IAAW;;MACvFV,YAAYM,MACdA,GADc,GAEdjB,SACEA,OAAOC,MAAP,CAAc,UAACC,GAAD,EAAMoB,OAAN;WAAkBpB,MAAMH,eAAeuB,OAAf,CAAxB;GAAd,EAA+D,EAA/D,CADF,GAEE,EAJN;;MAMMC,UAAaV,IAAb,SAAN;;MAEMW,UAAU,EAAhB;MACIN,UAAJ,EAAgB;YACNO,IAAR,CAAarC,cAAb;;UAEMqC,IAAR,CAAa/B,QAAQ;YACL,SADK;kBAEL,KAFK;YAGL;GAHH,CAAb;;MAMMgC,UAAUN,YACZ;QACKP,IADL;SAEK,EAAEc,QAAQ,KAAV;GAHO,GAKZ,EALJ;;UAOQH,OAAR,EACGI,OADH,CACWjB,SADX,EACsBe,OADtB,EAEGG,IAFH,CAEQ,kBAAU;WACPC,QAAP,GAAkBxB,OAAlB,CAA0B,gBAAQ;cACxByB,IAAR,CAAalC,SAAb,EAAwB,SAAxB,EAAmCC,WAAnC,EAAgDiC,KAAKC,QAAL,EAAhD,EADgC;KAAlC;eAGWnB,IAAX,EAAiBM,WAAWT,YAAYuB,OAAOhB,GAAnB,CAAX,GAAqCgB,OAAOhB,GAA7D;QACII,IAAJ,EAAU;UACJa,CAAJ,CACE,EAAEb,MAAM,IAAR,EADF,EAEE,CAACR,IAAD,CAFF,EAGEsB,IAHF,CAGO5C,GAAG6C,iBAAH,CAAwBvB,IAAxB,SAHP;;QAKEO,SAAJ,EAAe;iBACFG,OAAX,EAAoBU,OAAOI,GAA3B;;GAdN;CA1BK;;;;;;;;;;;;"}