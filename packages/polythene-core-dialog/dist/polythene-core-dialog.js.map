{"version":3,"file":"polythene-core-dialog.js","sources":["../src/classes.js","../src/dialog-instance.js","../src/vars.js","../src/transitions.js"],"sourcesContent":["import { classes as coreMenuClasses } from \"polythene-core-menu\";\n\nexport default {\n  component:         \"pe-dialog\",\n\n  // elements\n  placeholder:       \"pe-dialog__placeholder\",\n  holder:            \"pe-dialog__holder\",\n  content:           \"pe-dialog__content\",\n\n  // states\n  fullScreen:        \"pe-dialog--full-screen\",\n  backdrop:          \"pe-dialog--backdrop\",\n  open:              \"pe-dialog--open\",\n\n  // lookup\n  menuContent:       coreMenuClasses.content,\n};\n","import { filterSupportedAttributes, subscribe, unsubscribe, show, hide } from \"polythene-core\";\nimport classes from \"./classes\";\n\nexport const getElement = vnode =>\n  vnode.attrs.element || \"div\";\n\nconst DEFAULT_Z = 3;\n\nconst showDialog = (state, attrs) => {\n  if (state.transitioning()) {\n    return Promise.resolve();\n  }\n  const id = state.instanceId;\n  state.transitioning(true);\n  const transitions = attrs.transitions;\n  return show(Object.assign({},\n    attrs,\n    transitions.show({ el: state.el, showDuration: attrs.showDuration, showDelay: attrs.showDelay })\n  )).then(() => {\n    if (attrs.multipleDidShow) {\n      attrs.multipleDidShow(id); // this will call attrs.didShow\n    }\n    state.transitioning(false);\n  });\n};\n\nconst hideDialog = (state, attrs) => {\n  if (state.transitioning()) {\n    return Promise.resolve();\n  }\n  const id = state.instanceId;\n  state.transitioning(true);\n  const transitions = attrs.transitions;\n  return hide(Object.assign({},\n    attrs,\n    transitions.hide({ el: state.el, hideDuration: attrs.hideDuration, hideDelay: attrs.hideDelay })\n  )).then(() => {\n    if (attrs.multipleDidHide) {\n      attrs.multipleDidHide(id); // this will call attrs.didHide\n    }\n    state.transitioning(false);\n  });\n};\n\nexport const getInitialState = (vnode, createStream) => {\n  const transitioning = createStream(false);\n  return {\n    cleanUp: undefined,\n    el:      undefined,\n    transitioning\n  };\n};\n\nexport const onMount = vnode => {\n  if (!vnode.dom) {\n    return;\n  }\n  const state = vnode.state;\n  const attrs = vnode.attrs;\n  state.el = vnode.dom;\n \n  const handleEscape = e => {\n    if (attrs.fullScreen || attrs.modal) return;\n    if (e.key === \"Escape\") {\n      hideDialog(state, Object.assign({}, attrs, {\n        hideDelay: 0\n      }));\n    }\n  };\n  \n  state.cleanUp = () => (\n    unsubscribe(\"keydown\", handleEscape)\n  );\n\n  subscribe(\"keydown\", handleEscape);\n\n  if (attrs.showInstance) {\n    showDialog(state, attrs);\n  }\n};\n\nexport const onUnMount = vnode => (\n  vnode.state.cleanUp()\n);\n\nexport const createProps = (vnode, { keys: k }) => {\n  const state = vnode.state;\n  const attrs = vnode.attrs;\n  return Object.assign(\n    {},\n    filterSupportedAttributes(attrs, { remove: [\"style\"] }), // style set in content, and set by show/hide transition\n    {\n      className: [\n        classes.component,\n        attrs.fullScreen ? classes.fullScreen : null,\n        attrs.backdrop ? classes.backdrop : null,\n        attrs.tone === \"dark\" ? \"pe-dark-tone\" : null,\n        attrs.tone === \"light\" ? \"pe-light-tone\" : null,\n        attrs.className || attrs[k.class],\n      ].join(\" \"),\n      // click backdrop: close dialog\n      [k.onclick]: e => {\n        if (e.target !== state.el) {\n          return;\n        }\n        if (attrs.modal) {\n          // not allowed\n          return;\n        }\n        hideDialog(state, Object.assign({}, attrs, {\n          hideDelay: 0\n        }));\n      }\n    },\n    attrs.formOptions ? attrs.formOptions : null\n  );\n};\n\nexport const createContent = (vnode, { renderer: h, Shadow, DialogPane }) => {\n  const state = vnode.state;\n  const attrs = vnode.attrs;\n  if (attrs.hideInstance) {\n    hideDialog(state, attrs);\n  }\n  const pane = attrs.panes && attrs.panes.length\n    ? attrs.panes[0]\n    : h(DialogPane,\n      {\n        title: attrs.title,\n        header: attrs.header,\n        body: attrs.content || attrs.body || attrs.menu,\n        footer: attrs.footer,\n        footerButtons: attrs.footerButtons,\n        className: attrs.className,\n        style: attrs.style\n      }\n    );\n  return h(\"div\",\n    {\n      className: [\n        classes.content,\n        attrs.menu ? classes.menuContent : null\n      ].join(\" \"),\n      style: attrs.style\n    },\n    [\n      attrs.fullScreen\n        ? null\n        : h(Shadow, {\n          z: attrs.z !== undefined ? attrs.z : DEFAULT_Z,\n          animated: true\n        }),\n      pane\n    ]\n  );\n};\n","import { vars } from \"polythene-theme\";\n\nconst rgba = (colorStr, opacity = 1) =>\n  `rgba(${colorStr}, ${opacity})`;\n\nexport default {\n  border_radius:                   vars.unit_block_border_radius,\n\n  color_light_backdrop_background: \"rgba(0, 0, 0, .4)\",\n  color_dark_backdrop_background:  \"rgba(0, 0, 0, .5)\",\n\n  color_light_background:          rgba(vars.color_light_background),\n  color_dark_background:           rgba(vars.color_dark_background),\n\n  color_light_text:                rgba(vars.color_light_foreground, vars.blend_light_text_regular),\n  color_dark_text:                 rgba(vars.color_dark_foreground, vars.blend_dark_text_regular),\n};\n","const ANIMATION_DURATION = .220;\n\nconst show = ({ el, showDuration, showDelay }) => ({\n  el,\n  showDuration: showDuration || ANIMATION_DURATION,\n  showDelay:    showDelay || 0,\n  beforeShow:   () => el.style.opacity = 0,\n  show:         () => el.style.opacity = 1,\n});\n\nconst hide = ({ el, hideDuration, hideDelay }) => ({\n  el,\n  hideDuration: hideDuration || ANIMATION_DURATION,\n  hideDelay:    hideDelay || 0,\n  hide:         () => el.style.opacity = 0\n});\n\nexport default {\n  show,\n  hide\n};\n"],"names":["coreMenuClasses","content","getElement","vnode","attrs","element","showDialog","state","transitioning","Promise","resolve","id","instanceId","transitions","show","_extends","el","showDuration","showDelay","then","multipleDidShow","hideDialog","hide","hideDuration","hideDelay","multipleDidHide","getInitialState","createStream","undefined","onMount","dom","handleEscape","fullScreen","modal","e","key","cleanUp","unsubscribe","showInstance","onUnMount","createProps","k","keys","filterSupportedAttributes","remove","classes","component","backdrop","tone","className","class","join","onclick","target","formOptions","createContent","h","renderer","Shadow","DialogPane","hideInstance","pane","panes","length","title","header","body","menu","footer","footerButtons","style","menuContent","z","rgba","colorStr","vars","unit_block_border_radius","color_light_background","color_dark_background","color_light_foreground","blend_light_text_regular","color_dark_foreground","blend_dark_text_regular","opacity"],"mappings":"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"}