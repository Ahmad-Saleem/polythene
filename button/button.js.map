{"version":3,"sources":["button.es6"],"names":["CSS_CLASSES","block","content","label","raised","wash","focus","selected","disabled","borders","inactive","focusState","MAX_Z","startType","window","PointerEvent","DocumentTouch","document","endType","tapStart","tapEnd","tapEndAll","downButtons","animateZ","ctrl","baseZ","opts","increase","z","Math","min","max","redraw","inactivate","setTimeout","initTapEvents","tapHandler","push","animateOnTap","isTouch","name","map","btn","el","addEventListener","clearTapEvents","removeEventListener","createView","ink","tag","tabindex","buttonConfig","isInited","Object","assign","context","onunload","config","url","class","parentClass","join","id","tabIndex","onfocus","mouseover","onblur","onmouseover","onmouseout","onkeydown","which","MouseEvent","view","bubbles","cancelable","dispatchEvent","event","formaction","type","events","optsConfig","urlConfig","ripple","noink","component","animated","rippleOpts","noWash","props","before","after","controller","prop"],"mappings":"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","file":"button.js","sourcesContent":["import 'polythene/common/object.assign';\nimport p from 'polythene/polythene/polythene';\nimport m from 'mithril';\nimport ripple from 'polythene/ripple/ripple';\nimport shadow from 'polythene/shadow/shadow';\nimport 'polythene/base-button/base-button';\nimport 'polythene/button/theme/theme';\n\nconst CSS_CLASSES = {\n    block: 'pe-button pe-button--text',\n    content: 'pe-button__content',\n    label: 'pe-button__label',\n    raised: 'pe-button--raised',\n    wash: 'pe-button__wash',\n    focus: 'pe-button__focus',\n    selected: 'pe-button--selected',\n    disabled: 'pe-button--disabled',\n    borders: 'pe-button--borders',\n    inactive: 'pe-button--inactive',\n    focusState: 'pe-button--focus',\n};\n\nconst MAX_Z = 5;\n\nconst startType = window.PointerEvent ? 'pointerdown' : (('ontouchstart' in window) || window.DocumentTouch && document instanceof DocumentTouch) ? 'touchstart' : 'mousedown';\nconst endType = window.PointerEvent ? 'pointerup' : (('ontouchend' in window) || window.DocumentTouch && document instanceof DocumentTouch) ? 'touchend' : 'mouseup';\n\nlet tapStart,\n    tapEnd,\n    tapEndAll,\n    downButtons = [];\n\nconst animateZ = (ctrl, opts, name) => {\n    const baseZ = ctrl.baseZ();\n    const increase = opts.increase || 1;\n    let z = ctrl.z();\n    if (name === 'down' && baseZ !== 5) {\n        z = z + increase;\n        z = Math.min(z, MAX_Z);\n    } else if (name === 'up') {\n        z = z - increase;\n        z = Math.max(z, baseZ);\n    }\n    if (z !== ctrl.z()) {\n        ctrl.z(z);\n        m.redraw(); // make animation visible\n    }\n};\n\nconst inactivate = (ctrl, opts) => {\n    ctrl.inactive = true;\n    m.redraw();\n    setTimeout(() => {\n        ctrl.inactive = false;\n        m.redraw();\n    }, opts.inactivate * 1000);\n};\n\nconst initTapEvents = (el, ctrl, opts) => {\n    const tapHandler = (ctrl, opts, name) => {\n        if (name === 'down') {\n            downButtons.push({ctrl, opts});\n        } else if (name === 'up') {\n            if (opts.inactivate && !ctrl.inactive) {\n                inactivate(ctrl, opts);\n            }\n        }\n        // no z animation on touch\n        if (opts.animateOnTap && !p.isTouch) {\n            animateZ(ctrl, opts, name);\n        }\n    };\n    tapStart = () => (tapHandler(ctrl, opts, 'down'));\n    tapEnd = () => (tapHandler(ctrl, opts, 'up'));\n    tapEndAll = () => {\n        downButtons.map((btn) => {\n            tapHandler(btn.ctrl, btn.opts, 'up');\n        });\n        downButtons = [];\n    };\n    el.addEventListener(startType, tapStart);\n    el.addEventListener(endType, tapEnd);\n    window.addEventListener(endType, tapEndAll);\n};\n\nconst clearTapEvents = function(el) {\n    el.removeEventListener(startType, tapStart);\n    el.removeEventListener(endType, tapEnd);\n    window.removeEventListener(endType, tapEndAll);\n};\n\nconst createView = (ctrl, opts = {}) => {\n    const noink = (opts.ink !== undefined && opts.ink === false);\n    const disabled = opts.disabled;\n    const tag = opts.tag || 'a';\n    ctrl.inactive = (opts.inactive !== undefined)\n        ? (opts.inactive === false)\n            ? false\n            : true\n        : ctrl.inactive;\n    const tabIndex = (disabled || ctrl.inactive)\n        ? -1\n        : opts.tabindex || 0;\n\n    // handle multiple configs:\n    // - passed as param in the url Object\n    // - passed as opts.config\n    // - the default button config\n    const buttonConfig = (el, isInited, context) => {\n        if (isInited) {\n            return;\n        }\n        ctrl.el = el;\n        if (!disabled && !ctrl.inactive) {\n            initTapEvents(el, ctrl, Object.assign(\n                {},\n                opts,\n                {animateOnTap: (opts.animateOnTap !== false) ? true : false}\n            ));\n            context.onunload = () => {\n                clearTapEvents(el);\n            };\n        }\n    };\n    const optsConfig = opts.config || (() => {});\n    const urlConfig = (opts.url && opts.url.config) ? opts.url.config : (() => {});\n\n    const props = Object.assign(\n        {},\n        {\n            class: [\n                (opts.parentClass || CSS_CLASSES.block),\n                (opts.selected ? CSS_CLASSES.selected : null),\n                (disabled ? CSS_CLASSES.disabled : null),\n                (ctrl.inactive ? CSS_CLASSES.inactive : null),\n                (opts.borders ? CSS_CLASSES.borders : null),\n                (opts.raised ? CSS_CLASSES.raised : null),\n                (ctrl.focus ? CSS_CLASSES.focusState : null),\n                opts.class\n            ].join(' '),\n            id: opts.id || '',\n            tabindex: tabIndex,\n            // handle focus events\n            onfocus: () => ctrl.focus = !ctrl.mouseover,\n            onblur: () => ctrl.focus = false,\n            // don't show focus on click (detected by not being in mouse over state)\n            onmouseover: () => ctrl.mouseover = true,\n            onmouseout: () => ctrl.mouseover = false,\n            // if focus, dispatch click event on ENTER\n            onkeydown: (e) => {\n                if (e.which === 13 && ctrl.focus && ctrl.el) {\n                    // ENTER\n                    const event = new MouseEvent('click', {\n                        view: window,\n                        bubbles: true,\n                        cancelable: true\n                    });\n                    ctrl.el.dispatchEvent(event);\n                }\n            }\n        },\n        opts.url ? opts.url : null,\n        opts.formaction ? {formaction: opts.formaction} : null,\n        opts.type ? {type: opts.type} : null,\n        opts.events ? opts.events : null,\n        {\n            config: (...args) => [\n                buttonConfig(...args),\n                optsConfig(...args),\n                urlConfig(...args)\n            ]\n        },\n        disabled\n            ? {\n                disabled: true\n            }\n            : null\n    );\n\n    const label = opts.content\n        ? opts.content\n        : (opts.label)\n            ? (typeof opts.label === 'object')\n                ? opts.label\n                : m('div', {class: CSS_CLASSES.label}, opts.label)\n            : null;\n\n    const noWash = disabled || (opts.wash !== undefined && !opts.wash);\n    const wash = !noWash;\n    const rippleOpts = Object.assign(\n        {},\n        opts.ripple,\n        {inactive: noink}\n    );\n    const content = m('div', {\n        'class': CSS_CLASSES.content\n    }, [\n        (opts.raised && !disabled)\n            ? m.component(shadow, {\n                z: ctrl.z(),\n                animated: true\n            })\n            : null,\n        // ripple\n        disabled ? null : m.component(ripple, rippleOpts),\n        // hover\n        wash ? m('div', {class: CSS_CLASSES.wash}) : null,\n        // focus\n        disabled ? null : m('div', {class: CSS_CLASSES.focus}),\n        label\n    ]);\n    return m(tag, props, [opts.before, content, opts.after]);\n};\n\nconst component = {\n    controller: (opts = {}) => {\n        let z = (opts.z !== undefined) ? opts.z : 1;\n\n        return {\n            el: undefined,\n            baseZ: m.prop(z),\n            z: m.prop(z),\n            inactive: undefined,\n            focus: false,\n            mouseover: false\n        };\n    },\n    view: (ctrl, opts = {}) => {\n        return createView(ctrl, opts);\n    }\n};\n\nexport default component;\n"]}