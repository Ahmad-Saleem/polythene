define(["polythene/polythene/polythene","mithril","polythene/shadow/shadow","polythene/icon/icon","css!./card"],function(t,n,e,i){"use strict";var r,a,l,o,s,c,u,d,v;return r={landscape:16/9,square:1},a=function(t){var e,i,r;return e=t.text||{},i=["text",e["class"]].join(" "),r="div",n(r,{"class":i},n.trust(e.content))},l=function(t){var e,i,a,l,o,s;return e=t.media||{},l=e.ratio||"landscape",o=e.origin||"center",i=["media",e.type||null,l,e["class"]].join(" "),a="div",s=function(t,n){if(!n){var e=t.querySelector("img");e&&(e.onload=function(){var n,e,i,a;if(n=this.naturalWidth,e=this.naturalHeight,i=n/e,a=i<r[l]?"crop-x":"crop-y",t.className+=" "+a,"start"!==o){var s,c,u,d;if(c=t.clientWidth,s=t.clientHeight,i<r[l]){var v=c/i;u=s-v,d="center"===o?u/2:u,this.style.marginTop=d+"px"}else{var m=s*i;u=c-m,d="center"===o?u/2:u,this.style.marginLeft=d+"px"}}})}},n(a,{"class":i,config:s},[e.content,e.overlay?u(e.overlay):n(".image-dimmer")])},o=function(t){var e,r,a;return e=t.header||{},r=e.tag||(e.url?"a[layout][horizontal][center]":"div[layout][horizontal][center]"),a=Object.assign({"class":["header",e["class"]].join(" "),config:e.config},e.url?e.url:null,e.events?e.events:null),n(r,a,[e.icon?n(".content-icon",n.component(i,e.icon)):null,n(".title[flex]",[e.title?n.trust(e.title):null,e.subtitle?n(".subtitle",n.trust(e.subtitle)):null])])},s=function(t){var e,i,r,a,o,s,u,d;return e=t.primary||{},i=["primary",e.media?"has-media":null,e["class"]].join(" "),r="[layout][horizontal]",d=!1,o={title:function(t){return t.attrs?t:n(".title[flex]",[t.title?n.trust(t.title):null,t.subtitle?n(".subtitle",n.trust(t.subtitle)):null])},media:function(t){return d=!0,n("div",{"class":["primary-media",t.type].join(" ")},l({media:t}))},actions:function(t){return c({actions:t})}},a=Array.isArray(e.content)?e.content.map(function(t){return s=Object.keys(t)[0],u=t[s],o[s]?o[s](u):t}):[e.title?o.title({title:e.title,subtitle:e.subtitle}):null,e.media?o.media(e.media):null,e.actions?o.actions(e.actions):null],d&&(i+=" has-media"),n(r,{"class":i},a)},c=function(t){var e,i,r;return e=t.actions||{},i=e.tag||"[layout][horizontal][center]",r=["actions",e["class"]].join(" "),n(i,{"class":r},e.content)},u=function(t){var e,i,r,a;return t=t||{},e=t.tag||"div",i=["overlay-content",t["class"]].join(" "),r=t.content.map(function(t){return a=Object.keys(t)[0],d[a](t)}),n(".overlay",[n(e,{"class":i},r),n(".image-dimmer")])},d={text:a,media:l,header:o,primary:s,actions:c},v=function(i,r){var a,l,o,s;return r=r||{},a=r.tag||(r.url?"a":"div"),l=Object.assign({"class":["card",r["class"]].join(" "),config:r.config},r.url?r.url:null,r.events?r.events:null),o=r.content.map(function(t){return s=Object.keys(t)[0],d[s](t)}),o.unshift(n.component(e,{z:i.z(),animated:!0})),n(a,l,t.insertContent(o,r))},{controller:function(t){var e=void 0!==t.z?t.z:1;return{view:n.prop(),z:n.prop(e)}},view:function(t,n){n=n||{};var e=t.view();return(!e||n.refresh)&&(e=v(t,n),t.view(e)),e}}});