define(["polythene/polythene/polythene","mithril","polythene/toolbar/toolbar","css!./header-panel"],function(e,o,a){"use strict";var r,n,l,t,d,i=6,s=192,c=s/3;return r={shadowAfterScroll:{waterfall:1,"waterfall-tall":1},alwaysShadow:{standard:1,tall:1},noShadow:{seamed:1,cover:1,scroll:1},tallMode:{tall:!0,"waterfall-tall":!0},outerScroll:{scroll:1}},l=void 0!==document.documentElement.style.transform?function(e,o){e.transform=o}:function(e,o){e.webkitTransform=o},n=function(e,o){var a=null===o?"":"translate3d(0, "+o+"px, 0)";l(e,a)},d=function(e){var r,n;return e=e||{},r=e.tall||!1,n=e.tallClass||"",e.toolbar?(e.toolbar["class"]=[e.toolbar["class"]||null,r?n:null].join(" "),o.component(a,e.toolbar)):e.content?o([".header",e.animated?" .animate":""].join(" "),{"class":[e["class"]||null,r?n:null].join(" ")},e.content):o("div",e)},t=function(a,n){var l,t,i,s,c,h,m,u,p,f,g;return n=n||{},n.header=n.header||{},n.configs=n.configs||[],s=a.mode(),p=r.outerScroll[s]?"outer":"main",f={},g=a.handleScroll.bind(a),f[p]=g,h=function(e,o){var r,l,t,d,i;r=e.querySelector(".header")||e.querySelector(".toolbar"),r&&(o&&a.headerElem()||(l=e.querySelector(".headerContainer"),t=l.querySelector(".topBar"),d=l.querySelector(".headerBg"),i=l.querySelector(".condensedHeaderBg"),a.outerContainerElem(e),a.headerElem(r),a.headerTopBarElem(t),a.headerBg(d),a.condensedHeaderBg(i),n.animated||a.setHeight(l.clientHeight),f.outer&&a.scrollerElem(e),g()))},m=function(e,o){o||a.headerContainerElem(e)},u=function(e,o){o||f.main&&a.scrollerElem(e)},c=n.header?d(Object.assign({},n.header,a.headerConfig)):null,l=n.tag||"div",t=Object.assign({},{mode:s,"class":["header-panel",n["class"]].join(" "),config:n.config},n.animated?{animated:!0}:null,a.fixed()?{fixed:!0}:null),i=o(".outerContainer[vertical][layout]",{config:h,onscroll:f.outer},[o(".headerContainer",{config:m},[o(".bg-container",[o(".condensedHeaderBg"),o(".headerBg")]),c,"seamed"===s||a.shadow()===!1?null:o(".dropShadow")]),o(".mainContainer[flex]",{config:u,onscroll:f.main},n.content?n.content:null)]),o(l,t,e.insertContent(i,n))},{controller:function(e){var a,l,t,d,h,m,u,p,f,g,v,w,S,y,E,H,b,C,B;return e=e||{},e.mode?a=e.mode:e.header.toolbar?a=e.header.toolbar.mode:e.header.content&&(a=e.header.mode),a=a||"standard",l=r.tallMode[a]||!1,t=e.tallClass||"tall",d=e.animated||!1,h=e.fixed||!1,m=e.condenses||!1,u=e.scrollAwayTopbar||!1,p=e.noReveal||!1,f=e.keepCondensedHeader||!1,g=e.noDissolve||!1,v=void 0!==e.backgroundScrollSpeed?e.backgroundScrollSpeed:.5,w=0,S=!1,y=0,E=i,b=(e.headerHeight||s)+E,C=(e.condensedHeaderHeight||c)+E,H=b-C,B={standard:function(){},fixed:function(){var e,o;e=this.scrollerElem().scrollTop,o=0!==e,this.toggleShadow(o),S=o},animated:function(){var e,o,a;e=this.scrollerElem().scrollTop,o=0!==e,o!==S&&(a=this.headerElem(),a&&l&&a.classList[o?"remove":"add"](t),this.toggleShadow(o),S=o)},dynamicHeader:function(){var o,a,n;n=!1,a=this.scrollerElem().scrollTop,H>a?o=a:(o=Math.min(f?H:b,Math.max(0,p||f?a:w+a-y)),m&&y>=a&&a>H&&(o=Math.max(o,H))),o!==w&&this.transformHeader(o),p||r.noShadow[e.mode]||(a>o&&o>0&&(n=!0),this.toggleShadow(n)),w=o,y=Math.max(a,0)}},{view:o.prop(),scrollerElem:o.prop(),outerContainerElem:o.prop(),headerContainerElem:o.prop(),headerTopBarElem:o.prop(),headerElem:o.prop(),headerBg:o.prop(),condensedHeaderBg:o.prop(),mode:o.prop(a),fixed:o.prop(h),shadow:o.prop(void 0===e.shadow||e.shadow?!0:!1),prevScrollTop:o.prop(0),isTop:o.prop(),headerConfig:{tall:l,tallClass:t,animated:d,fixed:h},setHeight:function(o){var a;void 0===e.headerHeight&&(b=o+E,H=b-C),h||(a=this.outerContainerElem().querySelector(".mainContainer"),a.style.paddingTop=o+"px")},handleScroll:function(o){var n;"scroll"!==a&&(r.alwaysShadow[a]&&this.toggleShadow(!0),d&&(n=B.animated,n.bind(this).call()),n="standard"===a?B.standard:h?B.fixed:B.dynamicHeader,n.bind(this).call(),o&&e.scroll&&e.scroll(o))},condenseHeader:function(e){var o,a,r;o=null===e,u||this.headerTopBarElem()&&n(this.headerTopBarElem().style,Math.min(e,H)),a=this.headerBg().style,a&&(g||(a.opacity=o?"":(H-e)/H),n(a,o?null:e*v),g||(r=this.condensedHeaderBg().style,r.opacity=o?"":e/H,n(r,o?null:e*v)))},transformHeader:function(o){n(this.headerContainerElem().style,-o),m&&this.condenseHeader(o),e.transform&&e.transform({y:o,height:b,condensedHeight:C})},toggleShadow:function(e){r.alwaysShadow[a]&&(e=!0),this.outerContainerElem().classList[e?"add":"remove"]("cascaded")}}},view:function(e,o){var a=e.view();return(!a||o.refresh)&&(a=t(e,o),e.view(a)),a}}});