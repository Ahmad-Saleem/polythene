define(["polythene/polythene/polythene","mithril","polythene/toolbar/toolbar","css!./header-panel"],function(e,a,o){"use strict";var r,n,l,t,d,i=6,s=192,c=s/3;return r={shadowAfterScroll:{waterfall:1,"waterfall-tall":1},alwaysShadow:{standard:1,tall:1},noShadow:{seamed:1,cover:1,scroll:1},tallMode:{tall:!0,"waterfall-tall":!0},outerScroll:{scroll:1}},l=void 0!==document.documentElement.style.transform?function(e,a){e.transform=a}:function(e,a){e.webkitTransform=a},n=function(e,a){var o=null===a?"":"translate3d(0, "+a+"px, 0)";l(e,o)},d=function(e){var r,n;return e=e||{},r=e.tall||!1,n=e.tallClass||"",e.toolbar?(e.toolbar["class"]=[e.toolbar["class"]||null,r?n:null].join(" "),a.component(o,e.toolbar)):e.content?a([".header",e.animated?" .animate":""].join(" "),{"class":[e["class"]||null,r?n:null].join(" ")},e.content):a("div",e)},t=function(o,n){var l,t,i,s,c,h,m,u,p,f,w;return n=n||{},n.header=n.header||{},n.configs=n.configs||[],s=o.mode(),p=r.outerScroll[s]?"outer":"main",f={},w=o.handleScroll.bind(o),f[p]=w,h=function(e,a){var r,l,t,d,i;r=e.querySelector(".header")||e.querySelector(".toolbar"),r&&(a&&o.headerElem()||(l=e.querySelector(".headerContainer"),t=l.querySelector(".topBar"),d=l.querySelector(".headerBg"),i=l.querySelector(".condensedHeaderBg"),o.outerContainerElem(e),o.headerElem(r),o.headerTopBarElem(t),o.headerBg(d),o.condensedHeaderBg(i),n.animated||o.initWithHeight(l.clientHeight),f.outer&&o.scrollerElem(e),w()))},m=function(e,a){a||o.headerContainerElem(e)},u=function(e,a){a||f.main&&o.scrollerElem(e)},c=n.header?d(Object.assign({},n.header,o.headerConfig)):null,l=n.tag||"div",t=Object.assign({},{mode:s,"class":["header-panel",n["class"]].join(" "),config:n.config},n.animated?{animated:!0}:null,o.fixed()?{fixed:!0}:null),i=a(".outerContainer[vertical][layout]",{config:h,onscroll:f.outer},[a(".headerContainer",{config:m},[a(".bg-container",[a(".condensedHeaderBg"),a(".headerBg")]),c,"seamed"===s||o.shadow()===!1?null:a(".dropShadow")]),a(".mainContainer[flex]",{config:u,onscroll:f.main},n.content?n.content:null)]),a(l,t,e.insertContent(i,n))},{controller:function(e){var o,l,t,d,h,m,u,p,f,w,g,v,S,y,E,H,b,C,B;return e=e||{},e.mode?o=e.mode:e.header.toolbar?o=e.header.toolbar.mode:e.header.content&&(o=e.header.mode),o=o||"standard",l=r.tallMode[o]||!1,t=e.tallClass||"tall",d=e.animated||!1,h=e.fixed||!1,m=e.condenses||!1,u=e.scrollAwayTopbar||!1,p=e.noReveal||!1,f=e.keepCondensedHeader||!1,w=e.noDissolve||!1,g=void 0!==e.backgroundScrollSpeed?e.backgroundScrollSpeed:.5,v=0,S=!1,y=0,E=i,b=(e.headerHeight||s)+E,C=(e.condensedHeaderHeight||c)+E,H=b-C,B={standard:function(){},fixed:function(){var e,a;e=this.scrollerElem().scrollTop,a=0!==e,this.showShadow(a),S=a},animated:function(){var e,a,o;e=this.scrollerElem().scrollTop,a=0!==e,a!==S&&(o=this.headerElem(),o&&l&&o.classList[a?"remove":"add"](t),this.showShadow(a),S=a)},dynamicHeader:function(){var a,o,n;n=!1,o=this.scrollerElem().scrollTop,H>o?a=o:(a=Math.min(f?H:b,Math.max(0,p||f?o:v+o-y)),m&&y>=o&&o>H&&(a=Math.max(a,H))),a!==v&&this.transformHeader(a),r.noShadow[e.mode]||(o>a&&(n=!0),this.showShadow(n)),v=a,y=Math.max(o,0)}},{view:a.prop(),scrollerElem:a.prop(),outerContainerElem:a.prop(),headerContainerElem:a.prop(),headerTopBarElem:a.prop(),headerElem:a.prop(),headerBg:a.prop(),condensedHeaderBg:a.prop(),mode:a.prop(o),fixed:a.prop(h),shadow:a.prop(void 0===e.shadow||e.shadow?!0:!1),prevScrollTop:a.prop(0),isTop:a.prop(),headerConfig:{tall:l,tallClass:t,animated:d,fixed:h},initWithHeight:function(a){var o;void 0===e.headerHeight&&(b=a+E,H=b-C),h||(o=this.outerContainerElem().querySelector(".mainContainer"),o.style.paddingTop=a+"px"),p&&this.showShadow(!1)},handleScroll:function(a){var n;"scroll"!==o&&(r.alwaysShadow[o]&&this.showShadow(!0),d&&(n=B.animated,n.bind(this).call()),n="standard"===o?B.standard:h?B.fixed:B.dynamicHeader,n.bind(this).call(),a&&e.scroll&&e.scroll(a))},condenseHeader:function(e){var a,o,r;a=null===e,u||this.headerTopBarElem()&&n(this.headerTopBarElem().style,Math.min(e,H)),o=this.headerBg().style,o&&(w||(o.opacity=a?"":(H-e)/H),n(o,a?null:e*g),w||(r=this.condensedHeaderBg().style,r.opacity=a?"":e/H,n(r,a?null:e*g)))},transformHeader:function(a){n(this.headerContainerElem().style,-a),m&&this.condenseHeader(a),e.transform&&e.transform({y:a,height:b,condensedHeight:C})},showShadow:function(e){r.alwaysShadow[o]&&(e=!0),this.outerContainerElem().classList[e?"add":"remove"]("cascaded")}}},view:function(e,a){var o;return a=a||{},o=e.view(),o&&a.cache?o:(o=t(e,a),a.cache&&e.view(o),o)}}});