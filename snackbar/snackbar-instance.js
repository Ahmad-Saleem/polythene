"use strict";Object.defineProperty(exports,"__esModule",{value:true});function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{"default":obj}}var _mithril=require("mithril");var _mithril2=_interopRequireDefault(_mithril);var _polytheneCommonTimer=require("polythene/common/timer");var _polytheneCommonTimer2=_interopRequireDefault(_polytheneCommonTimer);var _polytheneSnackbarSnackbar=require("polythene/snackbar/snackbar");var _polytheneSnackbarSnackbar2=_interopRequireDefault(_polytheneSnackbarSnackbar);require("polythene-theme/snackbar/snackbar");var _polytheneThemeSnackbarSnackbarTransitions=require("polythene-theme/snackbar/snackbar-transitions");var _polytheneThemeSnackbarSnackbarTransitions2=_interopRequireDefault(_polytheneThemeSnackbarSnackbarTransitions);var _polytheneCommonTransition=require("polythene/common/transition");var _polytheneCommonTransition2=_interopRequireDefault(_polytheneCommonTransition);var DEFAULT_TIME_OUT=4e3;var pause=function pause(ctrl){ctrl.isPaused=true;if(ctrl.timer){ctrl.timer.pause()}};var unpause=function unpause(ctrl){ctrl.isPaused=false;if(ctrl.timer){ctrl.timer.resume()}};var stopTimer=function stopTimer(ctrl){if(ctrl.timer){ctrl.timer.stop()}};var show=function show(ctrl,opts){stopTimer(ctrl);ctrl.isTransitioning=true;return _polytheneCommonTransition2["default"].show(Object.assign({},opts,_polytheneThemeSnackbarSnackbarTransitions2["default"].show(ctrl,opts))).then(function(){ctrl.isTransitioning=false;if(opts.didShow){opts.didShow(opts.id)}var timeout=opts.timeout;if(timeout===0){}else{var timeoutMs=timeout!==undefined?timeout:DEFAULT_TIME_OUT;ctrl.timer=new _polytheneCommonTimer2["default"](function(){hide(ctrl,opts)},timeoutMs)}})};var hide=function hide(ctrl,opts){stopTimer(ctrl);ctrl.isTransitioning=true;return _polytheneCommonTransition2["default"].hide(Object.assign({},opts,_polytheneThemeSnackbarSnackbarTransitions2["default"].hide(ctrl,opts))).then(function(){_polytheneSnackbarSnackbar2["default"].remove(ctrl.instanceId);stopTimer(ctrl);ctrl.isTransitioning=false;if(opts.didHide){opts.didHide(opts.id)}_mithril2["default"].redraw()})};var createView=function createView(ctrl){var opts=arguments.length<=1||arguments[1]===undefined?{}:arguments[1];var tag=opts.tag||"div.layout.center";var props={"class":["snackbar",opts["class"]||"dark-theme"].join(" "),id:opts.id||"",config:function config(el,inited,context,vdom){if(inited)return;if(opts.config){opts.config(el,inited,context,vdom)}ctrl.el=el;ctrl.containerEl=document.querySelector("#"+opts.container);ctrl.dismissEl=opts.dismissSelector?document.querySelector(opts.dismissSelector):document.body;show(ctrl,opts)},onclick:function onclick(e){e.preventDefault()}};var titleConfig=function titleConfig(el,inited){if(inited)return;var height=el.getBoundingClientRect().height;var lineHeight=parseInt(window.getComputedStyle(el).lineHeight,10);var paddingTop=parseInt(window.getComputedStyle(el).paddingTop,10);var paddingBottom=parseInt(window.getComputedStyle(el).paddingBottom,10);if(height>lineHeight+paddingTop+paddingBottom){el.classList.add("multi-line")}};var verticalLayout=opts.layout==="vertical";var title=opts.title;var content=(0,_mithril2["default"])(verticalLayout?".layout.vertical":".layout.horizontal",{"class":"content"},[title?(0,_mithril2["default"])(verticalLayout?"div":".flex",{"class":"title",config:titleConfig},title):null,opts.action?(0,_mithril2["default"])(verticalLayout?".layout.end-justified":".layout.center",{"class":"action"},[opts.action]):null]);return(0,_mithril2["default"])(tag,props,content)};var component={controller:function controller(){var instanceData=arguments.length<=0||arguments[0]===undefined?{}:arguments[0];return{instanceId:instanceData.instanceId,el:null,containerEl:null,dismissEl:null,isTransitioning:false,timer:null,isPaused:false}},view:function view(ctrl,instanceData){var opts=typeof instanceData.opts==="function"?instanceData.opts():instanceData.opts;if(instanceData.hide&&!ctrl.isTransitioning){hide(ctrl,opts)}if(instanceData.pause&&!ctrl.isPaused){pause(ctrl,opts)}else if(instanceData.unpause&&ctrl.isPaused){unpause(ctrl,opts)}return createView(ctrl,opts)}};exports["default"]=component;module.exports=exports["default"];