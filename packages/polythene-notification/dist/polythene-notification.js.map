{"version":3,"file":"polythene-notification.js","sources":["../src/theme/vars.js","../src/theme/layout.js","../src/theme/color.js","../src/theme/index.js","../src/instance.js","../src/theme/transitions.js","../src/notification.js"],"sourcesContent":["import { vars } from \"polythene-theme\";\nconst rgba = vars.rgba;\n\nconst buttonPaddingH = 8; // padding, inner text space\n\nexport default {\n  width:                  274,\n  min_height:             80,\n  border_radius:          vars.unit_block_border_radius,\n  title_padding_h:        buttonPaddingH,\n  title_single_padding_v: 14,\n  title_multi_padding_v:  20,\n  side_padding:           24 - buttonPaddingH,\n  font_size:              14,\n  line_height:            20,\n\n  color_light_background: rgba(vars.color_light_background, .85),\n  color_light_text:       rgba(vars.color_light_foreground, vars.blend_light_dark_primary),\n\n  color_dark_background:  rgba(vars.color_dark_background),\n  color_dark_text:        rgba(vars.color_dark_foreground, vars.blend_light_text_primary)\n};\n","\nimport { vars } from \"polythene-theme\";\nimport { flex } from \"polythene-css\";\n\nexport default (selector, componentVars) => [{\n  [selector]: [\n    flex.layoutCenter,\n    {\n      width: componentVars.width + \"px\",\n      minHeight: componentVars.min_height + \"px\",\n      position: \"relative\",\n      padding: \"0 \" + componentVars.side_padding + \"px\",\n      margin: \"0 auto\",\n      borderRadius: componentVars.border_radius + \"px\",\n      pointerEvents: \"all\",\n\n      \" .pe-notification__content\": {\n        width: \"100%\"\n      },\n\n      \" .pe-notification__title\": {\n        padding: componentVars.title_single_padding_v + \"px \" + componentVars.title_padding_h + \"px\",\n        fontSize: componentVars.font_size + \"px\",\n        lineHeight: componentVars.line_height + \"px\"\n      },\n\n      \" .pe-notification__action\": {\n        \" .pe-button\": {\n          margin: 0\n        }\n      },\n\n      \"&.pe-notification--horizontal\": {\n        \" .pe-notification__content\": flex.layoutHorizontal,\n        \" .pe-notification__title\": flex.flex(),\n        \" .pe-notification__title--multi-line\": {\n          paddingTop: componentVars.title_multi_padding_v + \"px\",\n          paddingBottom: componentVars.title_multi_padding_v + \"px\"\n        },\n        \" .pe-notification__action\": flex.layoutCenter\n      },\n      \"&.pe-notification--vertical\": {\n        \" .pe-notification__content\": flex.layoutVertical,\n        \" .pe-notification__title\": {\n          paddingBottom: \"4px\"\n        },\n        \" .pe-notification__title--multi-line\": {\n          paddingTop: componentVars.title_multi_padding_v + \"px\"\n        },\n        \" .pe-notification__action\": flex.layoutEndJustified\n      }\n    }\n  ],\n  \".pe-notification__holder\": [\n    flex.layoutCenterCenter,\n    {\n      top: 0,\n      right: 0,\n      bottom: 0,\n      left: 0,\n      zIndex: vars.z_notification,\n      pointerEvents: \"none\",\n\n      \":not(.pe-notification--container)\": {\n        position: \"fixed\",\n      },\n      \".pe-notification--container\": {\n        position: \"absolute\",\n      }\n    }\n  ],\n}];\n\n","\nconst style = (scope, selector, componentVars, tint) => [{\n  [scope + selector]: {\n    color: componentVars[\"color_\" + tint + \"_text\"],\n    background: componentVars[\"color_\" + tint + \"_background\"]\n  }\n}];\n\nexport default (selector, componentVars) => [\n  style(\"\",                selector, componentVars, \"light\"),\n  style(\".pe-dark-theme\",  selector, componentVars, \"dark\" ), // has dark theme\n  style(\".pe-dark-theme \", selector, componentVars, \"dark\" ), // inside dark theme\n];\n","import { styler } from \"polythene-css\";\nimport vars from \"./vars\";\nimport layout from \"./layout\";\nimport color from \"./color\";\n\nconst fns = [layout, color];\nconst selector = \".pe-notification\";\n\nexport const customTheme = (customSelector, customVars) => \n  styler.generateStyles([customSelector, selector], {...vars, ...customVars}, fns);\n\nstyler.generateStyles([selector], vars, fns);\n","import m from \"mithril\";\nimport { show, hide, filterSupportedAttributes } from \"polythene-core\";\nimport { customTheme } from \"./theme\";\nimport { Timer } from \"polythene-utilities\";\n\nexport const classes = {\n  holder:         \"pe-notification__holder\",\n  content:        \"pe-notification__content\",\n  title:          \"pe-notification__title\",\n  multilineTitle: \"pe-notification__title--multiline\",\n  action:         \"pe-notification__action\",\n  horizontal:     \"pe-notification--horizontal\",\n  vertical:       \"pe-notification--vertical\",\n  hasContainer:   \"pe-notification--container\",\n};\n\nconst DEFAULT_TIME_OUT = 3;\n\nconst pauseInstance = state => {\n  state.isPaused = true;\n  if (state.timer) {\n    state.timer.pause();\n  }\n};\n\nconst unpauseInstance = state => {\n  state.isPaused = false;\n  if (state.timer) {\n    state.timer.resume();\n  }\n};\n\nconst stopTimer = state => {\n  if (state.timer) {\n    state.timer.stop();\n  }\n};\n\nconst prepareShow = (state, opts) => {\n  state.containerEl = state.containerEl || document.querySelector(opts.containerSelector || `.${classes.holder}`);\n  if (opts.containerSelector) {\n    const holderEl = state.containerEl.querySelector(`.${classes.holder}`);\n    holderEl.classList.add(classes.hasContainer);\n  }\n};\n\nconst showInstance = (state, opts) => {\n  prepareShow(state, opts);\n  stopTimer(state);\n  state.transitioning = true;\n  const transitions = opts.transitions || state.transitions;\n  return show(Object.assign({},\n    opts,\n    transitions.show(state.containerEl, opts)\n  )).then(() => {\n    state.transitioning = false;\n    if (state.didShow) {\n      // notify multiple\n      state.didShow(state.instanceId);\n      // this will call opts.didShow\n    }\n    // set timer to hide in a few seconds\n    const timeout = opts.timeout;\n    if (timeout === 0) {\n      // do not time out\n    } else {\n      const timeoutSeconds = timeout !== undefined\n        ? timeout\n        : DEFAULT_TIME_OUT;\n      state.timer = new Timer(() => {\n        hideInstance(state, opts);\n      }, timeoutSeconds);\n    }\n  });\n};\n\nconst hideInstance = (state, opts) => {\n  stopTimer(state);\n  const id = state.instanceId;\n  state.transitioning = true;\n  const transitions = opts.transitions || state.transitions;\n  return hide(Object.assign({},\n    opts,\n    transitions.hide(state.containerEl, opts)\n  )).then(() => {\n    stopTimer(state);\n    state.transitioning = false;\n    if (state.didHide) {\n      // notify multiple\n      state.didHide(id);\n      // this will call opts.didHide\n    }\n    m.redraw(); // removes remainder of drawn component\n  });\n};\n\nconst createView = (state, opts) => {\n  const element = opts.element || \"div\";\n  const isDarkTheme = opts.theme !== \"light\";\n  const props = Object.assign({},\n    filterSupportedAttributes(opts),\n    {\n      class: [\n        state.class,\n        opts.class,\n        isDarkTheme ? \"pe-dark-theme\" : null,\n        opts.containerSelector ? classes.hasContainer : null,\n        opts.layout === \"vertical\" ? classes.vertical : classes.horizontal,\n      ].join(\" \"),\n      oncreate: ({ dom }) => {\n        state.el = dom;\n        showInstance(state, opts);\n      },\n      onclick: e => e.preventDefault()\n    }\n  );\n\n  const content = m(\"div\",\n    {\n      class: classes.content\n    },\n    opts.content || [\n      opts.title\n        ? m(\"div\", {\n          class: classes.title,\n          oncreate: ({ dom }) => {\n            const height = dom.getBoundingClientRect().height;\n            const lineHeight = parseInt(window.getComputedStyle(dom).lineHeight, 10);\n            const paddingTop = parseInt(window.getComputedStyle(dom).paddingTop, 10);\n            const paddingBottom = parseInt(window.getComputedStyle(dom).paddingBottom, 10);\n            if (height > (lineHeight + paddingTop + paddingBottom)) {\n              dom.classList.add(classes.multilineTitle);\n            }\n          }\n        }, opts.title)\n        : null,\n      opts.action\n        ? m(\"div\", { class: classes.action }, [ opts.action ])\n        : null\n    ]\n  );\n  return m(element, props, content);\n};\n\nexport default {\n  theme: customTheme, // accepts (selector, vars)\n  oninit: vnode => {\n    const attrs = vnode.attrs;\n    vnode.state = Object.assign(\n      vnode.state,\n      attrs,\n      {\n        el:            null,\n        containerEl:   null,\n        dismissEl:     null,\n        transitioning: false,\n        timer:         null,\n        isPaused:      false\n      }\n    );\n  },\n  view: ({ state, attrs }) => {\n    // attrs contains {id, opts}\n    const opts = (typeof attrs.opts === \"function\")\n      ? attrs.opts()\n      : attrs.opts;\n    if (attrs.hide && !state.transitioning) {\n      hideInstance(state, opts);\n    }\n    if (attrs.pause && !state.isPaused) {\n      pauseInstance(state, attrs);\n    } else if (attrs.unpause && state.isPaused) {\n      unpauseInstance(state, attrs);\n    }\n    return createView(state, opts);\n  }\n};\n","\nconst show = (el, opts) => ({\n  el,\n  showDuration: opts.showDuration || .5,\n  showDelay:    opts.showDelay || 0,\n  beforeShow:   () => el.style.opacity = 0,\n  show:         () => el.style.opacity = 1,\n});\n\nconst hide = (el, opts) => ({\n  el,\n  hideDuration: opts.hideDuration || .5,\n  hideDelay:    opts.hideDelay || 0,\n  hide:         () => el.style.opacity = 0,\n});\n\nexport default {\n  show,\n  hide\n};\n","import { multiple } from \"polythene-core\";\nimport instance from \"./instance\";\nimport transitions from \"./theme/transitions\";\n\nexport default multiple({\n  instance,\n  class:         \"pe-notification\",\n  defaultId:     \"default_notification\",\n  element:       \".pe-notification__holder\",\n  placeholder:   \"span.pe-notification__placeholder\",\n  bodyShowClass: \"pe-notification--open\",\n  queue:         true,\n  transitions\n});\n"],"names":["rgba","vars","unit_block_border_radius","color_light_background","color_light_foreground","blend_light_dark_primary","color_dark_background","color_dark_foreground","blend_light_text_primary","selector","componentVars","flex","layoutCenter","width","min_height","side_padding","border_radius","title_single_padding_v","title_padding_h","font_size","line_height","layoutHorizontal","title_multi_padding_v","layoutVertical","layoutEndJustified","layoutCenterCenter","z_notification","style","scope","tint","fns","layout","color","customTheme","customSelector","customVars","styler","generateStyles","classes","pauseInstance","isPaused","state","timer","pause","unpauseInstance","resume","stopTimer","stop","prepareShow","opts","containerEl","document","querySelector","containerSelector","holder","classList","add","hasContainer","showInstance","transitioning","transitions","show","_extends","then","didShow","instanceId","timeout","timeoutSeconds","undefined","Timer","hideInstance","id","hide","didHide","redraw","createView","element","isDarkTheme","theme","m","filterSupportedAttributes","class","vertical","horizontal","join","dom","el","e","preventDefault","content","title","getBoundingClientRect","height","parseInt","window","getComputedStyle","lineHeight","paddingTop","paddingBottom","multilineTitle","action","attrs","vnode","unpause","showDuration","showDelay","opacity","hideDuration","hideDelay","multiple"],"mappings":"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"}