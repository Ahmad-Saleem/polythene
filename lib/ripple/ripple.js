"use strict";Object.defineProperty(exports,"__esModule",{value:true});function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{"default":obj}}var _polythenePolythenePolythene=require("polythene/polythene/polythene");var _polythenePolythenePolythene2=_interopRequireDefault(_polythenePolythenePolythene);var _mithril=require("mithril");var _mithril2=_interopRequireDefault(_mithril);require("polythene-theme/ripple/ripple");var DEFAULT_START_OPACITY=.2;var OPACITY_DECAY_VELOCITY=.35;var component=undefined,createView=undefined,tapStart=undefined,tapEnd=undefined,tapListeners=undefined,initTapEvents=undefined,clearTapEvents=undefined;tapListeners=[];createView=function(ctrl){var opts=arguments[1]===undefined?{}:arguments[1];var tag=undefined,props=undefined,content=undefined,initRipple=undefined,initWaves=undefined;if(opts.disabled){return(0,_mithril2["default"])("")}initRipple=function(ripple,inited,context){if(inited){return}ctrl.ripple(ripple);initTapEvents(ripple,ctrl,opts);context.onunload=function(){clearTapEvents(ripple)}};initWaves=function(waves,inited){if(inited){return}ctrl.waves(waves)};tag=opts.tag||"div[fit]";props={"class":["ripple",opts.constrained!==false?"constrained":null,opts["class"]].join(" "),config:initRipple};content=(0,_mithril2["default"])(".ripple-mask",(0,_mithril2["default"])(".ripple-waves",{config:initWaves}));return(0,_mithril2["default"])(tag,props,content)};initTapEvents=function(el,ctrl){var opts=arguments[2]===undefined?{}:arguments[2];var startType=undefined,endType=undefined;startType="mousedown";endType="mouseup";tapStart=function(e){ctrl.start(e,ctrl,opts)};tapEnd=function(e){ctrl.stop(e,ctrl,opts)};el.addEventListener(startType,tapStart,false);el.addEventListener(endType,tapEnd,false);tapListeners=[{type:startType,listener:tapStart},{type:endType,listener:tapEnd}]};clearTapEvents=function(el){tapListeners.map(function(o){el.removeEventListener(o.type,o.listener,false)});tapListeners=[]};component={controller:function controller(){return{ripple:_mithril2["default"].prop(),waves:_mithril2["default"].prop(),delegate:_mithril2["default"].prop(),start:function start(e,ctrl){var opts=arguments[2]===undefined?{}:arguments[2];var el=undefined,wavesEl=undefined,mx=undefined,my=undefined,rx=undefined,ry=undefined,rect=undefined,w=undefined,h=undefined,waveRadius=undefined,transitionEvent=undefined,duration=undefined,color=undefined,onEnd=undefined,initialOpacity=undefined,opacityDecayVelocity=undefined;el=ctrl.ripple();wavesEl=ctrl.waves();wavesEl.classList.remove("animated");w=el.offsetWidth;h=el.offsetHeight;waveRadius=Math.sqrt(w*w+h*h);wavesEl.style.width=wavesEl.style.height=waveRadius+"px";rect=el.getBoundingClientRect();if(opts.center){mx=rect.left+rect.width/2;my=rect.top+rect.height/2}else{mx=e.clientX;my=e.clientY}rx=mx-rect.left-waveRadius/2;ry=my-rect.top-waveRadius/2;wavesEl.style.top=ry+"px";wavesEl.style.left=rx+"px";initialOpacity=opts.initialOpacity!==undefined?opts.initialOpacity:DEFAULT_START_OPACITY;opacityDecayVelocity=opts.opacityDecayVelocity!==undefined?opts.opacityDecayVelocity:OPACITY_DECAY_VELOCITY;duration=1/opacityDecayVelocity*initialOpacity;wavesEl.style["animation-duration"]=wavesEl.style["-webkit-animation-duration"]=wavesEl.style["-moz-animation-duration"]=wavesEl.style["-o-animation-duration"]=duration+"s";color=window.getComputedStyle(el).color;wavesEl.style.backgroundColor=color;wavesEl.style.opacity=initialOpacity;transitionEvent=_polythenePolythenePolythene2["default"].whichTransitionEvent();onEnd=function(evt){wavesEl.classList.remove("animated");wavesEl.removeEventListener(transitionEvent,onEnd,false);if(opts.end){opts.end(evt)}};wavesEl.addEventListener(transitionEvent,onEnd,false);if(opts.start){opts.start(e)}wavesEl.classList.add("animated")},stop:function stop(){}}},view:function view(ctrl){var opts=arguments[1]===undefined?{}:arguments[1];return createView(ctrl,opts)}};exports["default"]=component;module.exports=exports["default"];
