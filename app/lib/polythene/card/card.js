define(["polythene/polythene/polythene","mithril","polythene/shadow/shadow","polythene/icon/icon","css!./card"],function(t,n,e,i){"use strict";var a,r,l,o,c,s,u,d,v;return a={landscape:16/9,square:1},r=function(t){var e,i,a;return e=t.text||{},i=["text",e["class"]].join(" "),a="div",n(a,{"class":i},n.trust(e.content))},l=function(t){var e,i,r,l,o,c;return e=t.media||{},l=e.ratio||"landscape",o=e.origin||"center",i=["media",e.type||null,l,e["class"]].join(" "),r="div",c=function(t,n){if(!n){var e=t.querySelector("img");e&&(e.onload=function(){var n,e,i,r;if(n=this.naturalWidth,e=this.naturalHeight,i=n/e,r=i<a[l]?"crop-x":"crop-y",t.className+=" "+r,"start"!==o){var c,s,u,d;if(s=t.clientWidth,c=t.clientHeight,i<a[l]){var v=s/i;u=c-v,d="center"===o?u/2:u,this.style.marginTop=d+"px"}else{var m=c*i;u=s-m,d="center"===o?u/2:u,this.style.marginLeft=d+"px"}}})}},n(r,{"class":i,config:c},[e.content,e.overlay?u(e.overlay):n(".image-dimmer")])},o=function(t){var e,a,r;return e=t.header||{},a=e.tag||(e.url?"a[layout][horizontal][center]":"div[layout][horizontal][center]"),r=Object.assign({"class":["header",e["class"]].join(" "),config:e.config},e.url?e.url:null,e.events?e.events:null),n(a,r,[e.icon?n(".content-icon",n.component(i,e.icon)):null,n(".title[flex]",[e.title?n.trust(e.title):null,e.subtitle?n(".subtitle",n.trust(e.subtitle)):null])])},c=function(t){var e,i,a,r,o,c,u,d;return e=t.primary||{},i=["primary",e.media?"has-media":null,e["class"]].join(" "),a="[layout][horizontal]",d=!1,o={title:function(t){return t.attrs?t:n(".title[flex]",[t.title?n.trust(t.title):null,t.subtitle?n(".subtitle",n.trust(t.subtitle)):null])},media:function(t){return d=!0,n("div",{"class":["primary-media",t.type].join(" ")},l({media:t}))},actions:function(t){return s({actions:t})}},r=Array.isArray(e.content)?e.content.map(function(t){return c=Object.keys(t)[0],u=t[c],o[c]?o[c](u):t}):[e.title?o.title({title:e.title,subtitle:e.subtitle}):null,e.media?o.media(e.media):null,e.actions?o.actions(e.actions):null],d&&(i+=" has-media"),n(a,{"class":i},r)},s=function(t){var e,i,a;return e=t.actions||{},i=e.tag||"[layout][horizontal][center]",a=["actions",e["class"]].join(" "),n(i,{"class":a},e.content)},u=function(t){var e,i,a,r;return t=t||{},e=t.tag||"div",i=["overlay-content",t["class"]].join(" "),a=t.content.map(function(t){return r=Object.keys(t)[0],d[r](t)}),n(".overlay",[n(e,{"class":i},a),n(".image-dimmer")])},d={text:r,media:l,header:o,primary:c,actions:s},v=function(i,a){var r,l,o,c;return a=a||{},r=a.tag||(a.url?"a":"div"),l=Object.assign({"class":["card",a["class"]].join(" "),config:a.config},a.url?a.url:null,a.events?a.events:null),o=a.content.map(function(t){return c=Object.keys(t)[0],d[c](t)}),o.unshift(n.component(e,{z:i.z(),animated:!0})),n(r,l,t.insertContent(o,a))},{controller:function(t){var e=void 0!==t.z?t.z:1;return{view:n.prop(),z:n.prop(e)}},view:function(t,n){var e;return n=n||{},e=t.view(),e&&n.cache?e:(e=v(t,n),n.cache&&t.view(e),e)}}});