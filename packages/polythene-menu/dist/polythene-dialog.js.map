{"version":3,"file":"polythene-dialog.js","sources":["../src/theme/vars.js","../src/theme/layout.js","../src/theme/color.js","../src/theme/index.js","../src/menu.js"],"sourcesContent":["import { vars } from \"polythene-theme\";\nconst rgba = vars.rgba;\n\nexport default {\n  sizes:                  [1, 1.5, 2, 3, 4, 5, 6, 7],\n  min_size:               1.5,\n  max_size_small_screen:  5,\n  size_factor:            vars.grid_unit_menu,\n  border_radius:          vars.unit_block_border_radius,\n\n  color_light_background: rgba(vars.color_light_background),\n  color_dark_background:  rgba(vars.color_dark_background)\n};\n","import { vars } from \"polythene-theme\";\n\nconst unifySize = (componentVars, size) =>\n  size < componentVars.min_size ? componentVars.min_size : size;\n\nconst widthClass = size => {\n  const sizeStr = size.toString().replace(\".\", \"-\");\n  return \"pe-menu--width-\" + sizeStr;\n};\n\nconst widthStyle = (componentVars, size) => {\n  const s = unifySize(componentVars, size);\n  return {\n    [\"&.\" + widthClass(s)]: {\n      width: componentVars.size_factor * s + \"px\",\n      \"max-width\": \"100%\"\n    }\n  };\n};\nexport default (selector, componentVars) => [{\n  [selector]: [\n    componentVars.sizes.map((size) =>\n      widthStyle(componentVars, size)\n    ),\n    {\n      transitionTimingFunction: \"ease-out\",\n      transitionProperty: \"opacity\",\n      zIndex: vars.z_menu,\n      opacity: 0,\n      position: \"absolute\",\n      width: \"100%\",\n      minWidth: vars.grid_unit_menu * componentVars.min_size + \"px\",\n\n      \"&.pe-menu--width-auto\": {\n        width: \"auto\"\n      },\n\n      \"&.pe-menu--visible\": {\n        opacity: 1\n      },\n\n      \"&.pe-menu--permanent\": {\n        position: \"relative\",\n        opacity: 1\n      },\n\n      \" .pe-menu__content\": {\n        width: \"100%\",\n        borderRadius: componentVars.border_radius + \"px\"\n      },\n\n      [\"@media (max-width: \" + vars.unit_screen_size_large + \"px)\"]: {\n        \"max-width\": componentVars.max_size_small_screen * vars.grid_unit_menu + \"px\"\n      }\n    }\n  ]\n}];\n","\nconst style = (scope, selector, componentVars, tint) => [{\n  [scope + selector]: {\n    \" .pe-menu__content\": {\n      \"background-color\": componentVars[\"color_\" + tint + \"_background\"]\n    }\n  }\n}];\n\nexport default (selector, componentVars) => [\n  style(\"\",                selector, componentVars, \"light\"),\n  style(\".pe-dark-theme\",  selector, componentVars, \"dark\" ), // has dark theme\n  style(\".pe-dark-theme \", selector, componentVars, \"dark\" ), // inside dark theme\n];\n","import { styler } from \"polythene-css\";\nimport vars from \"./vars\";\nimport layout from \"./layout\";\nimport color from \"./color\";\n\nconst fns = [layout, color];\nconst selector = \".pe-menu\";\n\nexport const customTheme = (customSelector, customVars) => \n  styler.generateStyles([customSelector, selector], {...vars, ...customVars}, fns);\n\nstyler.generateStyles([selector], vars, fns);\n","import m from \"mithril\";\nimport { shadow } from \"polythene-shadow\";\nimport { filterSupportedAttributes, subscribe, unsubscribe, show, hide } from \"polythene-core\";\nimport { customTheme } from \"./theme\";\n\nconst classes = {\n  component:   \"pe-menu\",\n  content:     \"pe-menu__content\",\n  placeholder: \"pe-menu--placeholder\",\n  visible:     \"pe-menu--visible\",\n  permanent:   \"pe-menu--permanent\",\n  target:      \"pe-menu--target\",\n  width_n:     \"pe-menu--width-\",\n  width_auto:  \"pe-menu--width-auto\",\n\n  // lookup\n  listTile:         \"pe-list-tile\",\n  selectedListTile: \"pe-list-tile--selected\"\n};\n\nconst OFFSET_V         = -8;\nconst DEFAULT_OFFSET_H = 16;\nconst MIN_SIZE         = 1.5;\n\nconst positionMenu = (state, opts) => {\n  if (!opts.target) {\n    return;\n  }\n  const targetEl = document.querySelector(\"#\" + opts.target);\n  if (!targetEl) {\n    return;\n  }\n  const offsetH = (opts.offset !== undefined) ? opts.offset : DEFAULT_OFFSET_H;\n  const menuEl = state.el;\n  if (!menuEl) {\n    return;\n  }\n  const contentEl = state.contentEl;\n  const origin = opts.origin || \"top-left\";\n  const reposition = opts.reposition === false ? false : true;\n  let positionOffset = 0;\n  if (reposition) {\n    const firstItem = contentEl.querySelectorAll(\".\" + classes.listTile)[0];\n    const selectedItem = contentEl.querySelector(\".\" + classes.selectedListTile);\n    if (firstItem && selectedItem) {\n      // calculate v position: menu should shift upward relative to the first item\n      const firstItemRect = firstItem.getBoundingClientRect();\n      const selectedItemRect = selectedItem.getBoundingClientRect();\n      positionOffset = selectedItemRect.top - firstItemRect.top;\n    }\n    // align to middle of target\n    const alignEl = selectedItem || firstItem;\n    const alignRect = alignEl.getBoundingClientRect();\n    const targetRect = targetEl.getBoundingClientRect();\n    const heightDiff = alignRect.height - targetRect.height;\n    positionOffset += heightDiff / 2;\n  }\n  const targetRect = targetEl.getBoundingClientRect();\n  const parentRect = menuEl.parentNode.getBoundingClientRect();\n  const alignLeft =   () => menuEl.style.left = targetRect.left - parentRect.left + offsetH + \"px\";\n  const alignRight =  () => menuEl.style.right = targetRect.right - parentRect.right + offsetH + \"px\";\n  const alignTop =    () => menuEl.style.top = targetRect.top - parentRect.top - positionOffset + OFFSET_V + \"px\";\n  const alignBottom = () => menuEl.style.bottom = targetRect.bottom - parentRect.bottom - positionOffset + \"px\";\n  const alignFn = {\n    \"top-left\":       () => alignTop() && alignLeft(),\n    \"top-right\":      () => alignTop() && alignRight(),\n    \"bottom-left\":    () => alignBottom() && alignLeft(),\n    \"bottom-right\":   () => alignBottom() && alignRight()\n  };\n  alignFn[origin].call();\n};\n\nconst showMenu = (state, opts) => {\n  state.isTransitioning = true;\n  return show(Object.assign({},\n    opts, {\n      el: state.el,\n      showClass: classes.visible\n    }\n  )).then(() => {\n    state.isTransitioning = false;\n    state.visible = true;\n    if (opts.didShow) {\n      opts.didShow(opts.id);\n    }\n  });\n};\n\nconst hideMenu = (state, opts) => {\n  state.isTransitioning = true;\n  return hide(Object.assign({},\n    opts, {\n      el: state.el,\n      showClass: classes.visible\n    }\n  )).then(() => {\n    state.isTransitioning = false;\n    state.visible = false;\n    if (opts.didHide) {\n      opts.didHide(opts.id);\n    }\n    m.redraw(); // removes remainder of drawn component\n  });\n};\n\nconst unifySize = (size) => {\n  return (size < MIN_SIZE) ? MIN_SIZE : size;\n};\n\nconst widthClass = (size) => {\n  const sizeStr = size.toString().replace(\".\", \"-\");\n  return classes.width_n + sizeStr;\n};\n\nconst createView = (state, opts) => {\n  const listenEl = document.body;\n\n  const activateDismissTap = () => {\n    listenEl.addEventListener(\"click\", handleDismissTap);\n  };\n\n  const deActivateDismissTap = () => {\n    listenEl.removeEventListener(\"click\", handleDismissTap);\n  };\n\n  const handleDismissTap = (e) => {\n    if (e.target === state.el) {\n      return;\n    }\n    deActivateDismissTap();\n    if (e.defaultPrevented) {\n      // clicked on .pe-menu__content\n      hideMenu(state, opts);\n    } else {\n      hideMenu(state, Object.assign({}, opts, {\n        hideDelay: 0\n      }));\n    }\n  };\n\n  const update = () => {\n    positionMenu(state, opts);\n    m.redraw();\n  };\n\n  const handleEscape = e => {\n    if (e.which === 27) {\n      hideMenu(state, Object.assign({}, opts, {\n        hideDelay: 0\n      }));\n    }\n  };\n\n  const element = opts.element || \"div\";\n  const props = Object.assign({}, \n    filterSupportedAttributes(opts),\n    {\n      class: [\n        classes.component,\n        opts.permanent ? classes.permanent : null,\n        opts.target ? classes.target : \"layout center-center\",\n        opts.size ? widthClass(unifySize(opts.size)) : null,\n        opts.class\n      ].join(\" \"),\n      oncreate: ({dom}) => {\n        state.el = dom;\n        if (!opts.permanent) {\n          subscribe(\"resize\", update);\n          subscribe(\"keydown\", handleEscape);\n          setTimeout(() => {\n            activateDismissTap();\n            showMenu(state, opts);\n          }, 0);\n        }\n        positionMenu(state, opts);\n      },\n      onremove: () => {\n        unsubscribe(\"resize\", update);\n        unsubscribe(\"keydown\", handleEscape);\n        if (!opts.permanent) {\n          deActivateDismissTap();\n        }\n      }\n    }\n  );\n  const content = m(\"div\", {\n    class: classes.content,\n    oncreate: ({dom}) => state.contentEl = dom,\n    onclick: e => e.preventDefault()\n  }, [\n    m(shadow, {\n      z: state.z,\n      animated: true\n    }),\n    opts.content ? opts.content : null\n  ]);\n  return m(element, props, [opts.before, content, opts.after]);\n};\n\nexport const menu = {\n  theme: customTheme, // accepts (selector, vars)\n  oninit: vnode => {\n    const attrs = vnode.attrs;\n    vnode.state = Object.assign(vnode.state, {\n      z: (attrs.z !== undefined) ? attrs.z : 1,\n      el: null,\n      contentEl: null,\n      isTransitioning: false,\n      visible: attrs.permanent || false\n    });\n  },\n  view: ({state, attrs}) => {\n    if (attrs.show) {\n      state.visible = true;\n    }\n    if (state.visible) {\n      return createView(state, attrs);\n    } else {\n      return m(\"span\", {\n        class: classes.placeholder\n      });\n    }\n  }\n};\n\n"],"names":["rgba","vars","grid_unit_menu","unit_block_border_radius","color_light_background","color_dark_background","unifySize","componentVars","size","min_size","widthClass","sizeStr","toString","replace","widthStyle","s","size_factor","selector","sizes","map","z_menu","border_radius","unit_screen_size_large","max_size_small_screen","style","scope","tint","fns","layout","color","customTheme","customSelector","customVars","styler","generateStyles","classes","OFFSET_V","DEFAULT_OFFSET_H","MIN_SIZE","positionMenu","state","opts","target","targetEl","document","querySelector","offsetH","undefined","offset","menuEl","el","contentEl","origin","reposition","positionOffset","firstItem","querySelectorAll","listTile","selectedItem","selectedListTile","firstItemRect","getBoundingClientRect","selectedItemRect","top","alignEl","alignRect","targetRect","heightDiff","height","parentRect","parentNode","alignLeft","left","alignRight","right","alignTop","alignBottom","bottom","alignFn","call","showMenu","isTransitioning","show","babelHelpers.extends","visible","then","didShow","id","hideMenu","hide","didHide","redraw","width_n","createView","listenEl","body","activateDismissTap","addEventListener","handleDismissTap","deActivateDismissTap","removeEventListener","e","defaultPrevented","update","handleEscape","which","element","props","filterSupportedAttributes","component","permanent","class","join","dom","content","m","preventDefault","shadow","z","before","after","menu","attrs","vnode","placeholder"],"mappings":"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"}