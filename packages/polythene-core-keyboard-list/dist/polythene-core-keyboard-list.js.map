{"version":3,"file":"polythene-core-keyboard-list.js","sources":["../src/keyboard-list.js"],"sourcesContent":["\nexport const getElement = vnode =>\n  vnode.attrs.element || \"div\";\n\nconst onSelect = (event, vnode, index) => {\n  const state = vnode.state;\n  const attrs = vnode.attrs;\n  if (attrs.onSelect) {\n    const selectedIndex = index !== undefined\n      ? index\n      : state.highlightIndex();\n    if (selectedIndex > -1) {\n      const data = {\n        event,\n        index: selectedIndex,\n        dom: state.tiles[selectedIndex].dom,\n        attrs: state.tiles[selectedIndex].attrs\n      };\n      attrs.onSelect(data);\n    }\n  }\n  if (index !== undefined) {\n    setHighlightIndex({ state, index });\n  }\n};\n\nconst setHighlightIndex = ({ state, index }) => {\n  const normalizedHighlightIndex = index === undefined || index === null\n    ? -1\n    : index;\n  const currentHighlightIndex = state.highlightIndex();\n  if (normalizedHighlightIndex !== currentHighlightIndex) {\n    // Explicitly reset to -1, or else only change when currently -1\n    if (normalizedHighlightIndex === -1) {\n      state.highlightIndex(-1);\n    } else if (currentHighlightIndex === -1) {\n      state.highlightIndex(normalizedHighlightIndex);\n    }\n  }\n};\n\nconst exitHighlight = ({ state, attrs, newIndex }) => {\n  const highlightIndex = state.highlightIndex();\n  // state.tiles[highlightIndex].dom.blur();\n  document.activeElement.blur();\n  state.highlightIndex(-1);\n  if (attrs.onHighlightExit) {\n    attrs.onHighlightExit({\n      index: newIndex,\n      dom: state.tiles[highlightIndex].dom,\n    });\n  }\n};\n\nexport const getInitialState = (vnode, createStream) => {\n  const attrs = vnode.attrs;\n  const highlightIndex = createStream(attrs.defaultHighlightIndex !== undefined && attrs.defaultHighlightIndex !== null\n    ? attrs.defaultHighlightIndex\n    : -1);\n  const registerTile = state => (index, data) => state.tiles[index] = data;\n  return {\n    tiles: [],\n    highlightIndex,\n    registerTile,\n    redrawOnUpdate: createStream.merge([highlightIndex])\n  };\n};\n\nexport const onMount = vnode => {\n  const state = vnode.state;\n  state.highlightIndex.map(index => {\n    if (state.tiles[index]) {\n      state.tiles[index].dom.focus();\n    }\n  });\n};\n\nexport const onUpdate = ({ state, attrs }) => {\n  if (!isNaN(attrs.highlightIndex)) {\n    setHighlightIndex({ state, index: attrs.highlightIndex });\n  }\n};\n\nexport const createProps = (vnode, { keys: k }) => {\n  const state = vnode.state;\n  const attrs = vnode.attrs;\n  return Object.assign(\n    {},\n    {\n      [k.onkeydown]: e => {\n        const highlightIndex = state.highlightIndex();\n        if (e.key === \"ArrowDown\" || e.key === \"ArrowRight\") {\n          e.preventDefault(); // prevent scrolling the page\n          const newIndex = highlightIndex + 1;\n          if (newIndex >= state.tiles.length) {\n            exitHighlight({ state, attrs, newIndex });\n          } else {\n            // Setting the focus on the List Tile will invoke a callback using attr `setHighlightIndex`\n            state.tiles[newIndex].dom.focus();\n          }\n        } else if (e.key === \"ArrowUp\" || e.key === \"ArrowLeft\") {\n          e.preventDefault(); // prevent scrolling the page\n          const newIndex = highlightIndex - 1;\n          if (newIndex < 0) {\n            exitHighlight({ state, attrs, newIndex });\n          } else {\n            state.tiles[newIndex].dom.focus();\n          }\n        } else if (e.key === \"Enter\") {\n          onSelect(e, vnode);\n        } else if (e.key === \"Escape\") {\n          exitHighlight({ state, attrs, newIndex: highlightIndex });\n        }\n      },\n    }\n  );\n};\n\nexport const createContent = (vnode, { renderer: h, keys: k, List, ListTile }) => {\n  const state = vnode.state;\n  const attrs = vnode.attrs;\n  let index = -1;\n  const tiles = attrs.tiles.map(tileOpts => {\n    if (!tileOpts.header) {\n      index++;\n    }\n    const tileIndex = index;\n    return tileOpts.tag !== undefined\n      ? tileOpts\n      : h(ListTile, Object.assign(\n        {},\n        attrs.all,\n        tileOpts,\n        !tileOpts.header && {\n          keyboardControl: true,\n          register: state.registerTile(state),\n          setHighlightIndex: state.highlightIndex,\n          index,\n          defaultHighlight: state.highlightIndex() === tileIndex,\n          events: Object.assign(\n            {},\n            tileOpts.events,\n            {\n              [k.onclick]: e => onSelect(e, vnode, tileIndex)\n            }\n          )\n        }\n      ));\n  });\n  return h(List, Object.assign({}, attrs, {\n    tiles\n  }));\n};\n"],"names":["getElement","vnode","attrs","element","onSelect","event","index","state","selectedIndex","undefined","highlightIndex","data","tiles","dom","setHighlightIndex","normalizedHighlightIndex","currentHighlightIndex","exitHighlight","newIndex","activeElement","blur","onHighlightExit","getInitialState","createStream","defaultHighlightIndex","merge","onMount","map","focus","onUpdate","isNaN","createProps","k","keys","_extends","onkeydown","e","key","preventDefault","length","createContent","h","renderer","List","ListTile","tileOpts","header","tileIndex","tag","all","registerTile","events","onclick"],"mappings":"4dACaA,EAAa,kBACxBC,GAAMC,MAAMC,SAAW,OAEnBC,EAAW,SAACC,EAAOJ,EAAOK,MACxBC,GAAQN,EAAMM,MACdL,EAAQD,EAAMC,SAChBA,EAAME,SAAU,IACZI,OAA0BC,KAAVH,EAClBA,EACAC,EAAMG,oBACNF,GAAiB,EAAG,IAChBG,kBAEGH,MACFD,EAAMK,MAAMJ,GAAeK,UACzBN,EAAMK,MAAMJ,GAAeN,SAE9BE,SAASO,QAGLF,KAAVH,MACkBC,QAAOD,WAIzBQ,EAAoB,eAAGP,KAAAA,MAAOD,IAAAA,MAC5BS,MAAqCN,KAAVH,GAAiC,OAAVA,GACnD,EACDA,EACEU,EAAwBT,EAAMG,gBAChCK,KAA6BC,KAEG,IAA9BD,IACIL,gBAAgB,IACc,IAA3BM,KACHN,eAAeK,KAKrBE,EAAgB,eAAGV,KAAAA,MAAOL,IAAAA,MAAOgB,IAAAA,SAC/BR,EAAiBH,EAAMG,0BAEpBS,cAAcC,SACjBV,gBAAgB,GAClBR,EAAMmB,mBACFA,uBACGH,MACFX,EAAMK,MAAMF,GAAgBG,OAK1BS,EAAkB,SAACrB,EAAOsB,MAC/BrB,GAAQD,EAAMC,MACdQ,EAAiBa,MAA6Cd,KAAhCP,EAAMsB,uBAAuE,OAAhCtB,EAAMsB,sBACnFtB,EAAMsB,uBACL,iDACgB,kBAAS,UAAClB,EAAOK,SAASJ,GAAMK,MAAMN,GAASK,mBAKlDY,EAAaE,OAAOf,MAI3BgB,EAAU,eACfnB,GAAQN,EAAMM,QACdG,eAAeiB,IAAI,YACnBpB,EAAMK,MAAMN,MACRM,MAAMN,GAAOO,IAAIe,WAKhBC,EAAW,eAAGtB,KAAAA,MAAOL,IAAAA,KAC3B4B,OAAM5B,EAAMQ,oBACKH,QAAOD,MAAOJ,EAAMQ,kBAI/BqB,EAAc,SAAC9B,QAAe+B,KAANC,KAC7B1B,EAAQN,EAAMM,MACdL,EAAQD,EAAMC,YACbgC,WAGFF,EAAEG,UAAY,eACPzB,GAAiBH,EAAMG,oBACf,cAAV0B,EAAEC,KAAiC,eAAVD,EAAEC,IAAsB,GACjDC,oBACIpB,GAAWR,EAAiB,CAC9BQ,IAAYX,EAAMK,MAAM2B,UACVhC,QAAOL,QAAOgB,eAGxBN,MAAMM,GAAUL,IAAIe,YAEvB,IAAc,YAAVQ,EAAEC,KAA+B,cAAVD,EAAEC,IAAqB,GACrDC,oBACIpB,GAAWR,EAAiB,CAC9BQ,GAAW,KACGX,QAAOL,QAAOgB,eAExBN,MAAMM,GAAUL,IAAIe,YAET,UAAVQ,EAAEC,MACFD,EAAGnC,GACO,WAAVmC,EAAEC,QACK9B,QAAOL,QAAOgB,SAAUR,QAOrC8B,EAAgB,SAACvC,QAAmBwC,KAAVC,SAAmBV,IAANC,KAASU,IAAAA,KAAMC,IAAAA,SAC3DrC,EAAQN,EAAMM,MACdL,EAAQD,EAAMC,MAChBI,GAAS,EACPM,EAAQV,EAAMU,MAAMe,IAAI,YACvBkB,EAASC,eAGRC,GAAYzC,aACMG,KAAjBoC,EAASG,IACZH,EACAJ,EAAEG,EAAUV,KAEZhC,EAAM+C,IACNJ,GACCA,EAASC,0BACS,WACPvC,EAAM2C,aAAa3C,qBACVA,EAAMG,wCAEPH,EAAMG,mBAAqBqC,SACrCb,KAENW,EAASM,YAENnB,EAAEoB,QAAU,kBAAKhD,GAASgC,EAAGnC,EAAO8C,iBAM1CN,GAAEE,EAAMT,KAAkBhC"}