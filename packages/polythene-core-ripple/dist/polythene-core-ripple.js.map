{"version":3,"file":"polythene-core-ripple.js","sources":["../src/classes.js","../src/theme/vars.js","../src/theme/layout.js","../src/theme/color.js","../src/theme/index.js","../src/theme/animation.js","../src/ripple.js"],"sourcesContent":["\nexport default {\n  component:      \"pe-ripple\",\n\n  // elements\n  mask:           \"pe-ripple__mask\",\n  waves:          \"pe-ripple__waves\",\n\n  // states\n  constrained:    \"pe-ripple--constrained\",\n  wavesAnimating: \"pe-ripple__waves--animating\",\n};\n","export default {\n  color:         \"inherit\" // only specify this variable to get both states\n  // color_light:   \"inherit\",\n  // color_dark:    \"inherit\"\n};","import { mixin } from \"polythene-core-css\";\n\nexport default selector => [{\n  [selector]: [\n    mixin.fit(), {\n      color: \"inherit\",\n      borderRadius: \"inherit\",\n      pointerEvents: \"none\",\n      \n      \".pe-ripple--constrained\": {\n        borderRadius: \"inherit\",\n\n        \" .pe-ripple__mask\": {\n          overflow: \"hidden\",\n          borderRadius: \"inherit\"\n        }\n      },\n      \" .pe-ripple__mask\": [\n        mixin.fit(),\n        {\n          transform: \"translate3d(0,0,0)\"\n        }\n      ],\n\n      \" .pe-ripple__waves\": {\n        outline: \"1px solid transparent\", // for IE10\n        position: \"absolute\",\n        borderRadius: \"50%\",\n        pointerEvents: \"none\",\n        display: \"none\"\n      },\n      \" .pe-ripple__waves--animating\": {\n        display: \"block\"\n      }\n    }\n  ]\n}];\n","\nconst style = (scopes, selector, componentVars, tint) => [{\n  [scopes.map(s => s + selector).join(\",\")]: {\n    color: componentVars[\"color_\" + tint] || componentVars[\"color\"] || \"inherit\"\n  }\n}];\n\nexport default (selector, componentVars) => [\n  style([\".pe-dark-tone\", \".pe-dark-tone \"], selector, componentVars, \"dark\"), // has/inside dark tone\n  style([\"\", \".pe-light-tone\", \".pe-light-tone \"], selector, componentVars, \"light\"), // normal, has/inside light tone\n];\n","import { styler } from \"polythene-core-css\";\nimport classes from \"../classes\";\nimport vars from \"./vars\";\nimport layout from \"./layout\";\nimport color from \"./color\";\n\nconst fns = [layout, color];\nconst selector = `.${classes.component}`;\n\nexport const customTheme = (customSelector, customVars) => \n  styler.generateStyles([customSelector, selector], {...vars, ...customVars}, fns);\n\nstyler.generateStyles([selector], vars, fns);\n","import { isTouch, animationEndEvent } from \"polythene-core\";\nimport { styler } from \"polythene-core-css\";\nimport { vars } from \"polythene-theme\";\n\nconst ANIMATION_END_EVENT =    animationEndEvent;\nconst DEFAULT_START_OPACITY =  0.2;\nconst DEFAULT_END_OPACITY =    0.0;\nconst DEFAULT_START_SCALE =    0.1;\nconst DEFAULT_END_SCALE =      2.0;\nconst OPACITY_DECAY_VELOCITY = 0.35;\n\nexport default ({ e, el, attrs, classes, onEndCallback }) => {\n  const container = document.createElement(\"div\");\n  container.setAttribute(\"class\", classes.mask);\n  el.appendChild(container);\n  const waves = document.createElement(\"div\");\n  waves.setAttribute(\"class\", classes.waves);\n  container.appendChild(waves);\n  const rect = el.getBoundingClientRect();\n  const x = (isTouch && e.touches) ? e.touches[0].pageX : e.clientX;\n  const y = (isTouch && e.touches) ? e.touches[0].pageY : e.clientY;  \n  const w = el.offsetWidth;\n  const h = el.offsetHeight;\n  const waveRadius = Math.sqrt(w * w + h * h);\n  const mx = (attrs.center) ? (rect.left + rect.width / 2) : x;\n  const my = (attrs.center) ? (rect.top + rect.height / 2) : y;\n  const rx = mx - rect.left - waveRadius / 2;\n  const ry = my - rect.top - waveRadius / 2;\n  const startOpacity = attrs.startOpacity !== undefined\n    ? attrs.startOpacity\n    : DEFAULT_START_OPACITY;\n  const opacityDecayVelocity = attrs.opacityDecayVelocity !== undefined\n    ? attrs.opacityDecayVelocity\n    : OPACITY_DECAY_VELOCITY;\n  const endOpacity = attrs.endOpacity || DEFAULT_END_OPACITY;\n  const startScale = attrs.startScale || DEFAULT_START_SCALE;\n  const endScale = attrs.endScale || DEFAULT_END_SCALE;\n  const duration = attrs.duration\n    ? attrs.duration\n    : 1 / opacityDecayVelocity * 0.2;\n  const color = window.getComputedStyle(el).color;\n  const animationId = `ripple_animation_${new Date().getTime()}`;\n  const style = waves.style;\n  style.width = style.height = waveRadius + \"px\";\n  style.top = ry + \"px\";\n  style.left = rx + \"px\";\n  style[\"animation-duration\"] =\n    style[\"-webkit-animation-duration\"] =\n    style[\"-moz-animation-duration\"] =\n    style[\"-o-animation-duration\"] = duration + \"s\";\n  style.backgroundColor = color;\n  style.opacity = startOpacity;\n  style.animationName = animationId;\n  style.animationTimingFunction = attrs.animationTimingFunction || vars.animation_curve_default;\n\n  const keyframeStyle = [{\n    [`@keyframes ${animationId}`]: {\n      \" 0%\": {\n        transform: \"scale(\" + startScale + \")\",\n        \"opacity\": startOpacity\n      },\n      \" 100%\": {\n        transform: \"scale(\" + endScale + \")\",\n        \"opacity\": endOpacity\n      }\n    }\n  }];\n  styler.add(animationId, keyframeStyle);\n\n  const cleanup = () => {\n    waves.classList.remove(classes.wavesAnimating);\n    container.removeChild(waves);\n    el.removeChild(container);\n  };\n\n  const onEnd = evt => {\n    styler.remove(animationId);\n    waves.removeEventListener(ANIMATION_END_EVENT, onEnd, false);\n    if (attrs.end) {\n      attrs.end(evt);\n    }\n    if (attrs.persistent) {\n      style.opacity = endOpacity;\n      style.transform = \"scale(\" + endScale + \")\";\n    } else {\n      onEndCallback();\n      cleanup();\n    }\n  };\n\n  waves.addEventListener(ANIMATION_END_EVENT, onEnd, false);\n  if (attrs.start) {\n    attrs.start(e);\n  }\n  waves.classList.add(classes.wavesAnimating);\n};\n","import { touchEndEvent, filterSupportedAttributes } from \"polythene-core\";\nimport { customTheme } from \"./theme\";\nimport animation from \"./theme/animation\";\nimport classes from \"./classes\";\n\nexport const element = \"div\";\n\nexport const theme = customTheme;\n\nexport const getInitialState = (vnode, createStream) => {\n  const animating = createStream(false);\n  const removeEventListeners = createStream(false);\n  return {\n    animating,\n    removeEventListeners\n  };\n};\n\nexport const createProps = (vnode, { keys: k }) => {\n  const attrs = vnode.attrs;\n  return Object.assign(\n    {},\n    filterSupportedAttributes(attrs),\n    {\n      className: [\n        classes.component,\n        attrs.constrained !== false ? classes.constrained : null,\n        attrs.tone === \"dark\" ? \"pe-dark-tone\" : null,\n        attrs.tone === \"light\" ? \"pe-light-tone\" : null,\n        attrs.className || attrs[k.class],\n      ].join(\" \")\n    }\n  );\n};\n\nexport const onMount = vnode => {\n  if (!vnode.dom) {\n    return;\n  }\n  const state = vnode.state;\n  const attrs = vnode.attrs;\n  const rippleEl = vnode.dom;\n\n  const tap = e => {\n    if (attrs.disabled) {\n      return;\n    }\n    if (state.animating() && !attrs.multi) {\n      return;\n    }\n    animation({ e, el: rippleEl, attrs, classes, onEndCallback: () => state.animating(false) });\n    state.animating(true);\n  };\n  const triggerEl = attrs.target\n    ? attrs.target()\n    : vnode.dom && vnode.dom.parentElement;\n  triggerEl.addEventListener(touchEndEvent, tap, false);\n  state.removeEventListeners(() =>\n    triggerEl.removeEventListener(touchEndEvent, tap, false));\n};\n\nexport const onUnmount = ({ state }) =>\n  state.removeEventListeners()();\n\n"],"names":["selector","mixin","fit","style","scopes","componentVars","tint","map","s","join","fns","layout","color","classes","component","customTheme","customSelector","customVars","styler","generateStyles","vars","ANIMATION_END_EVENT","animationEndEvent","e","el","attrs","onEndCallback","container","document","createElement","setAttribute","mask","appendChild","waves","rect","getBoundingClientRect","x","isTouch","touches","pageX","clientX","y","pageY","clientY","w","offsetWidth","h","offsetHeight","waveRadius","Math","sqrt","mx","center","left","width","my","top","height","rx","ry","startOpacity","undefined","opacityDecayVelocity","endOpacity","startScale","endScale","duration","window","getComputedStyle","animationId","Date","getTime","backgroundColor","opacity","animationName","animationTimingFunction","animation_curve_default","keyframeStyle","add","cleanup","classList","remove","wavesAnimating","removeChild","onEnd","removeEventListener","end","evt","persistent","transform","addEventListener","start","theme","getInitialState","vnode","createStream","createProps","k","keys","_extends","filterSupportedAttributes","constrained","tone","className","class","onMount","dom","state","rippleEl","tap","disabled","animating","multi","triggerEl","target","parentElement","touchEndEvent","removeEventListeners","onUnmount"],"mappings":"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"}