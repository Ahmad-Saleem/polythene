"use strict";Object.defineProperty(exports,"__esModule",{value:true});function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{"default":obj}}var _polythenePolythenePolythene=require("polythene/polythene/polythene");var _polythenePolythenePolythene2=_interopRequireDefault(_polythenePolythenePolythene);var _mithril=require("mithril");var _mithril2=_interopRequireDefault(_mithril);var _polytheneButtonButton=require("polythene/button/button");var _polytheneButtonButton2=_interopRequireDefault(_polytheneButtonButton);require("polythene-theme/tabs/tabs");var SLIDE_DURATION=.2;var setSelectedTab=function setSelectedTab(index,animate,ctrl){ctrl.selectedTab(index);var selectedTabEl=ctrl.tabsEl.querySelector(".js-tab-index-"+index);if(selectedTabEl&&ctrl.tabIndicatorEl&&ctrl.tabsEl){var parentRect=ctrl.tabsEl.getBoundingClientRect();var rect=selectedTabEl.getBoundingClientRect();var style=ctrl.tabIndicatorEl.style;var scaleX=1/parentRect.width*rect.width;var translateX=(rect.left-parentRect.left+ctrl.tabsEl.scrollLeft)/scaleX;var transformCmd="scaleX("+scaleX+") translate("+translateX+"px)";var duration=animate?SLIDE_DURATION:0;style["transition-duration"]=style["-webkit-transition-duration"]=style["-moz-transition-duration"]=style["-o-transition-duration"]=duration+"s";style.transform=style["-webkit-transform"]=style["-moz-transform"]=style["-o-transform"]=transformCmd}};var createTab=function createTab(index,opts,tabsOpts,ctrl){var autofit=tabsOpts.scrollable||tabsOpts.centered?false:tabsOpts.autofit?true:false;var tabButtonOptions=Object.assign({},{content:(0,_mithril2["default"])(".layout.vertical",[(0,_mithril2["default"])(".flex"),(0,_mithril2["default"])(".label",opts.label),(0,_mithril2["default"])(".flex")]),"class":["tab",autofit?"flex":"flex none","js-tab-index-"+index,opts["class"]].join(" "),wash:false,events:{onclick:function onclick(){return setSelectedTab(index,tabsOpts.noIndicatorSlide?false:true,ctrl)}}},opts);return _mithril2["default"].component(_polytheneButtonButton2["default"],tabButtonOptions)};var createView=function createView(ctrl){var opts=arguments[1]===undefined?{}:arguments[1];var tag=opts.tag||"div";var props={"class":["tabs",opts["class"]].join(" "),config:function config(el,inited,context){if(opts.config){opts.config(el,inited,context)}if(inited){return}ctrl.tabsEl=el;setSelectedTab(opts.selectedTab||0,false,ctrl);_polythenePolythenePolythene2["default"].addListener("resize",function(){setSelectedTab(ctrl.selectedTab(),false,ctrl);_mithril2["default"].redraw()})}};var tabRow=opts.buttons.map(function(buttonOpts,index){buttonOpts=Object.assign(buttonOpts,{selected:index===ctrl.selectedTab()});return createTab(index,buttonOpts,opts,ctrl)});var content=(0,_mithril2["default"])("div",{"class":["tabRow layout horizontal",opts.scrollable?"indent":null].join(" ")},[opts.centered?(0,_mithril2["default"])(".flex"):null,tabRow,opts.hideIndicator?null:(0,_mithril2["default"])(".tabIndicator",{config:function config(el,inited){if(inited){return}ctrl.tabIndicatorEl=el}}),opts.centered?(0,_mithril2["default"])(".flex"):null]);return(0,_mithril2["default"])(tag,props,_polythenePolythenePolythene2["default"].insertContent(content,opts))};var component={controller:function controller(){return{tabsEl:null,tabIndicatorEl:null,selectedTab:_mithril2["default"].prop(0)}},view:function view(ctrl){var opts=arguments[1]===undefined?{}:arguments[1];return createView(ctrl,opts)}};exports["default"]=component;module.exports=exports["default"];