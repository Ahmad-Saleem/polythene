!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("mithril"),require("polythene-shadow"),require("polythene-core"),require("polythene-css"),require("polythene-theme")):"function"==typeof define&&define.amd?define(["exports","mithril","polythene-shadow","polythene-core","polythene-css","polythene-theme"],t):t(e.polythene=e.polythene||{},e.m,e["polythene-shadow"],e["polythene-core"],e["polythene-css"],e["polythene-theme"])}(this,function(e,t,n,i,r,o){"use strict";function u(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function a(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}t="default"in t?t.default:t,n="default"in n?n.default:n;var l=o.vars.rgba,s={sizes:[1,1.5,2,3,4,5,6,7],min_size:1.5,max_size_small_screen:5,size_factor:o.vars.grid_unit_menu,border_radius:o.vars.unit_block_border_radius,color_light_background:l(o.vars.color_light_background),color_dark_background:l(o.vars.color_dark_background)},c=function(e,t){return t<e.min_size?e.min_size:t},d=function(e){return"pe-menu--width-"+e.toString().replace(".","-")},p=function(e,t){var n=c(e,t);return u({},"&."+d(n),{width:e.size_factor*n+"px","max-width":"100%"})},f=function(e,t){return[u({},e,[t.sizes.map(function(e){return p(t,e)}),u({transitionTimingFunction:"ease-out",transitionProperty:"opacity",zIndex:o.vars.z_menu,opacity:0,position:"absolute",width:"100%",minWidth:o.vars.grid_unit_menu*t.min_size+"px","&.pe-menu--width-auto":{width:"auto"},"&.pe-menu--visible":{opacity:1},"&.pe-menu--permanent":{position:"relative",opacity:1,zIndex:0}," .pe-menu__content":{width:"100%",borderRadius:t.border_radius+"px"}},"@media (max-width: "+o.vars.unit_screen_size_large+"px)",{"max-width":t.max_size_small_screen*o.vars.grid_unit_menu+"px"})])]},h=function(e,t,n,i){return[a({},e.map(function(e){return e+t}).join(","),{" .pe-menu__content":{"background-color":n["color_"+i+"_background"]}})]},m=function(e,t){return[h([".pe-dark-theme",".pe-dark-theme "],e,t,"dark"),h(["",".pe-light-theme",".pe-light-theme "],e,t,"light")]},g=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(e[i]=n[i])}return e},v=[f,m],b=function(e,t){return r.styler.generateStyles([e,".pe-menu"],g({},s,t),v)};r.styler.generateStyles([".pe-menu"],s,v);var _=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(e[i]=n[i])}return e},y={component:"pe-menu",content:"pe-menu__content",placeholder:"pe-menu__placeholder",target:"pe-menu__target",visible:"pe-menu--visible",permanent:"pe-menu--permanent",width_n:"pe-menu--width-",width_auto:"pe-menu--width-auto",listTile:"pe-list-tile",selectedListTile:"pe-list-tile--selected"},w=function(e,t){if(t.target){var n=document.querySelector("#"+t.target);if(n){var i=void 0!==t.offset?t.offset:16,r=e.el;if(r){var o=e.el.querySelector("."+y.content),u=t.origin||"top-left",a=t.reposition!==!1,l=0;if(a){var s=o.querySelectorAll("."+y.listTile)[0],c=o.querySelector("."+y.selectedListTile);if(s&&c){var d=s.getBoundingClientRect();l=c.getBoundingClientRect().top-d.top}var p=c||s,f=p.getBoundingClientRect(),h=n.getBoundingClientRect();l+=(f.height-h.height)/2}var m=n.getBoundingClientRect();if(r.parentNode){var g=r.parentNode.getBoundingClientRect(),v=function(){return r.style.left=m.left-g.left+i+"px"},b=function(){return r.style.right=m.right-g.right+i+"px"},_=function(){return r.style.top=m.top-g.top-l-8+"px"},w=function(){return r.style.bottom=m.bottom-g.bottom-l+"px"};({"top-left":function(){return _()&&v()},"top-right":function(){return _()&&b()},"bottom-left":function(){return w()&&v()},"bottom-right":function(){return w()&&b()}})[u].call()}}}}},z=function(e,t){return e.isTransitioning=!0,i.show(_({},t,{el:e.el,showClass:y.visible})).then(function(){e.isTransitioning=!1,e.visible=!0,t.didShow&&t.didShow(t.id)})},x=function(e,n){return e.isTransitioning=!0,i.hide(_({},n,{el:e.el,showClass:y.visible})).then(function(){e.isTransitioning=!1,e.visible=!1,n.didHide&&n.didHide(n.id),t.redraw()})},k=function(e){return e<1.5?1.5:e},S=function(e){return y.width_n+e.toString().replace(".","-")},T=function(e){var r=e.attrs,o=e.state,u=document.body,a=function(){u.addEventListener("click",s)},l=function(){u.removeEventListener("click",s)},s=function(e){e.target!==o.el&&(l(),e.defaultPrevented?x(o,r):x(o,_({},r,{hideDelay:0})))},c=function(){w(o,r),t.redraw()},d=function(e){27===e.which&&x(o,_({},r,{hideDelay:0}))},p=r.element||"div",f=_({},i.filterSupportedAttributes(r),{class:[y.component,r.permanent?y.permanent:null,r.target?y.target:null,r.size?S(k(r.size)):null,r.class].join(" "),oncreate:function(e){var t=e.dom;o.el=t,r.permanent||(i.subscribe("resize",c),i.subscribe("keydown",d),setTimeout(function(){a(),z(o,r)},0)),w(o,r)},onremove:function(){i.unsubscribe("resize",c),i.unsubscribe("keydown",d),r.permanent||l()}}),h=t("div",{class:y.content,onclick:function(e){return e.preventDefault()}},[o.z>0&&t(n,{z:o.z,animated:!0}),r.content?r.content:e.children]);return t(p,f,[r.before,h,r.after])},j={theme:b,oninit:function(e){var t=e.attrs;e.state=_(e.state,{z:void 0!==t.z?t.z:1,el:null,isTransitioning:!1,visible:t.permanent||!1})},view:function(e){return e.attrs.show&&(e.state.visible=!0),e.state.visible?T(e):t("span",{class:y.placeholder})}};e.default=j,e.classes=y,e.vars=s,Object.defineProperty(e,"__esModule",{value:!0})});
//# sourceMappingURL=polythene-menu.js.map
