{"version":3,"file":"polythene-core-dialog.js","sources":["../src/classes.js","../src/theme/vars.js","../src/theme/layout.js","../src/theme/color.js","../src/theme/index.js","../src/dialog-instance.js","../src/theme/transitions.js"],"sourcesContent":["import { classes as coreMenuClasses } from \"polythene-core-menu\";\n\nexport default {\n  component:         \"pe-dialog\",\n\n  // elements\n  placeholder:       \"pe-dialog__placeholder\",\n  holder:            \"pe-dialog__holder\",\n  content:           \"pe-dialog__content\",\n\n  // states\n  fullscreen:        \"pe-dialog--fullscreen\",\n  backdrop:          \"pe-dialog--backdrop\",\n  open:              \"pe-dialog--open\",\n\n  // lookup\n  menuContent:       coreMenuClasses.content,\n};\n","import { vars } from \"polythene-theme\";\nimport { rgba } from \"polythene-core-css\";\n\nexport default {\n  border_radius:                   vars.unit_block_border_radius,\n\n  color_light_backdrop_background: \"rgba(0, 0, 0, .4)\",\n  color_dark_backdrop_background:  \"rgba(0, 0, 0, .5)\",\n\n  color_light_background:          rgba(vars.color_light_background),\n  color_dark_background:           rgba(vars.color_dark_background),\n\n  color_light_text:                rgba(vars.color_light_foreground, vars.blend_light_text_regular),\n  color_dark_text:                 rgba(vars.color_dark_foreground, vars.blend_dark_text_regular),\n};\n","import { vars } from \"polythene-theme\";\nimport { flex } from \"polythene-core-css\";\n\nexport default (selector, componentVars) => [{\n  [selector]: [\n    flex.layoutCenterCenter,\n    {\n      position: \"fixed\",\n      top: 0,\n      left: 0,\n      right: 0,\n      bottom: 0,\n      zIndex: vars.z_dialog,\n      height: \"100%\", // 100vh would make the dialog go beneath Mobile Safari toolbar\n      padding: componentVars.padding + \"px 40px\",\n      \n      \".pe-dialog--fullscreen\": {\n        padding: 0,\n\n        // dialog-content styles: see dialog pane\n      },\n\n      \" .pe-dialog__content\": {\n        position: \"relative\",\n        borderRadius: componentVars.border_radius + \"px\",\n      }\n    }\n  ],\n  // \" body.pe-dialog--open\": {\n  //   overflow: \"hidden\",\n  //   left: 0,\n  //   \"-webkit-overflow-scrolling\": \"touch\",\n  //   top: 0,\n  //   width: \"100%\"\n  // }\n}];\n","\nconst style = (scopes, selector, componentVars, tint) => [{\n  [scopes.map(s => s + selector).join(\",\")]: {\n    \" .pe-dialog__content\": {\n      backgroundColor: componentVars[\"color_\" + tint + \"_background\"],\n      color: componentVars[\"color_\" + tint + \"_text\"],\n    },\n    \"&.pe-dialog--backdrop\": {\n      backgroundColor: componentVars[\"color_\" + tint + \"_backdrop_background\"]\n    }\n  }\n}];\n\nexport default (selector, componentVars) => [\n  style([\".pe-dark-tone\", \".pe-dark-tone \"], selector, componentVars, \"dark\"), // has/inside dark tone\n  style([\"\", \".pe-light-tone\", \".pe-light-tone \"], selector, componentVars, \"light\"), // normal, has/inside light tone\n];\n","import { styler } from \"polythene-core-css\";\nimport classes from \"../classes\";\nimport vars from \"./vars\";\nimport layout from \"./layout\";\nimport color from \"./color\";\n\nconst fns = [layout, color];\nconst selector = `.${classes.component}`;\n\nexport const customTheme = (customSelector, customVars) => \n  styler.generateStyles([customSelector, selector], {...vars, ...customVars}, fns);\n\nstyler.generateStyles([selector], vars, fns);\n","import { filterSupportedAttributes, subscribe, unsubscribe, show, hide } from \"polythene-core\";\nimport { customTheme } from \"./theme\";\nimport classes from \"./classes\";\n\nexport const getElement = vnode =>\n  vnode.attrs.element || \"div\";\n\nexport const theme = customTheme;\n\nconst DEFAULT_Z = 3;\n\nexport const getInitialState = (vnode, createStream) => {\n  const transitioning = createStream(false);\n  return {\n    cleanUp: undefined,\n    el:      undefined,\n    transitioning\n  };\n};\n\nconst showDialog = (state, attrs) => {\n  if (state.transitioning()) {\n    return Promise.resolve();\n  }\n  const id = state.instanceId;\n  state.transitioning(true);\n  const transitions = attrs.transitions;\n  return show(Object.assign({},\n    attrs,\n    transitions.show({ el: state.el, showDuration: attrs.showDuration, showDelay: attrs.showDelay })\n  )).then(() => {\n    if (attrs.multipleDidShow) {\n      attrs.multipleDidShow(id); // this will call attrs.didShow\n    }\n    state.transitioning(false);\n  });\n};\n\nconst hideDialog = (state, attrs) => {\n  if (state.transitioning()) {\n    return Promise.resolve();\n  }\n  const id = state.instanceId;\n  state.transitioning(true);\n  const transitions = attrs.transitions;\n  return hide(Object.assign({},\n    attrs,\n    transitions.hide({ el: state.el, hideDuration: attrs.hideDuration, hideDelay: attrs.hideDelay })\n  )).then(() => {\n    if (attrs.multipleDidHide) {\n      attrs.multipleDidHide(id); // this will call attrs.didHide\n    }\n    state.transitioning(false);\n  });\n};\n\nexport const onMount = vnode => {\n  if (!vnode.dom) {\n    return;\n  }\n  const state = vnode.state;\n  const attrs = vnode.attrs;\n  state.el = vnode.dom;\n \n  const handleEscape = e => {\n    if (attrs.fullscreen || attrs.modal) return;\n    if (e.key === \"Escape\") {\n      hideDialog(state, Object.assign({}, attrs, {\n        hideDelay: 0\n      }));\n    }\n  };\n  \n  state.cleanUp = () => (\n    unsubscribe(\"keydown\", handleEscape)\n  );\n\n  subscribe(\"keydown\", handleEscape);\n\n  if (attrs.showInstance) {\n    showDialog(state, attrs);\n  }\n};\n\nexport const onUnMount = vnode => (\n  vnode.state.cleanUp()\n);\n\nexport const createProps = (vnode, { keys: k }) => {\n  const state = vnode.state;\n  const attrs = vnode.attrs;\n  return Object.assign(\n    {},\n    filterSupportedAttributes(attrs, { remove: [\"style\"] }), // style set in content, and set by show/hide transition\n    {\n      className: [\n        classes.component,\n        attrs.fullscreen ? classes.fullscreen : null,\n        attrs.backdrop ? classes.backdrop : null,\n        attrs.tone === \"dark\" ? \"pe-dark-tone\" : null,\n        attrs.tone === \"light\" ? \"pe-light-tone\" : null,\n        attrs.className || attrs[k.class],\n      ].join(\" \"),\n      // click backdrop: close dialog\n      [k.onclick]: e => {\n        if (e.target !== state.el) {\n          return;\n        }\n        if (attrs.modal) {\n          // not allowed\n          return;\n        }\n        hideDialog(state, Object.assign({}, attrs, {\n          hideDelay: 0\n        }));\n      }\n    },\n    attrs.formOptions ? attrs.formOptions : null\n  );\n};\n\nexport const createContent = (vnode, { renderer: h, Shadow, DialogPane }) => {\n  const state = vnode.state;\n  const attrs = vnode.attrs;\n  if (attrs.hideInstance) {\n    hideDialog(state, attrs);\n  }\n  const pane = attrs.panes && attrs.panes.length\n    ? attrs.panes[0]\n    : h(DialogPane, {\n      title: attrs.title,\n      body: attrs.content || attrs.body || attrs.menu,\n      footer: attrs.footer,\n      className: attrs.className,\n      style: attrs.style\n    });\n  return h(\"div\",\n    {\n      className: [\n        classes.content,\n        attrs.menu ? classes.menuContent : null\n      ].join(\" \"),\n      style: attrs.style\n    },\n    [\n      attrs.fullscreen\n        ? null\n        : h(Shadow, {\n          z: attrs.z !== undefined ? attrs.z : DEFAULT_Z,\n          animated: true\n        }),\n      pane\n    ]\n  );\n};\n","const ANIMATION_DURATION = .220;\n\nconst show = ({ el, showDuration, showDelay }) => ({\n  el,\n  showDuration: showDuration || ANIMATION_DURATION,\n  showDelay:    showDelay || 0,\n  beforeShow:   () => el.style.opacity = 0,\n  show:         () => el.style.opacity = 1,\n});\n\nconst hide = ({ el, hideDuration, hideDelay }) => ({\n  el,\n  hideDuration: hideDuration || ANIMATION_DURATION,\n  hideDelay:    hideDelay || 0,\n  hide:         () => el.style.opacity = 0\n});\n\nexport default {\n  show,\n  hide\n};\n"],"names":["coreMenuClasses","content","vars","unit_block_border_radius","rgba","color_light_background","color_dark_background","color_light_foreground","blend_light_text_regular","color_dark_foreground","blend_dark_text_regular","selector","componentVars","flex","layoutCenterCenter","z_dialog","padding","border_radius","style","scopes","tint","map","s","join","fns","layout","color","classes","component","customTheme","customSelector","customVars","styler","generateStyles","getElement","vnode","attrs","element","theme","getInitialState","createStream","undefined","showDialog","state","transitioning","Promise","resolve","id","instanceId","transitions","show","_extends","el","showDuration","showDelay","then","multipleDidShow","hideDialog","hide","hideDuration","hideDelay","multipleDidHide","onMount","dom","handleEscape","fullscreen","modal","e","key","cleanUp","unsubscribe","showInstance","onUnMount","createProps","k","keys","filterSupportedAttributes","remove","backdrop","tone","className","class","onclick","target","formOptions","createContent","h","renderer","Shadow","DialogPane","hideInstance","pane","panes","length","title","body","menu","footer","menuContent","z","opacity"],"mappings":"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"}